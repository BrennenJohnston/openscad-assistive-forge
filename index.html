<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta
      name="description"
      content="Web-based OpenSCAD customizer - customize and generate 3D printable STL files directly in your browser"
    />
    <title>OpenSCAD Assistive Forge</title>
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <!-- Theme colors -->
    <meta
      name="theme-color"
      content="#f4c400"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#0b0b0b"
      media="(prefers-color-scheme: dark)"
    />
    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta
      name="apple-mobile-web-app-title"
      content="OpenSCAD Assistive Forge"
    />
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/icons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/icons/favicon-16x16.png"
    />
    <link rel="shortcut icon" href="/favicon.ico" />
    <!-- Microsoft -->
    <meta name="msapplication-TileColor" content="#f4c400" />
    <meta name="msapplication-config" content="/browserconfig.xml" />
  </head>
  <body>
    <!-- Skip to content link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div id="app">
      <header class="app-header">
        <div class="header-content">
          <div class="header-branding">
            <img
              class="header-logo"
              src="/icons/logo.png"
              alt="OpenSCAD Assistive Web Forge logo"
              width="44"
            />
            <div class="header-branding-text">
              <h1>
                <span class="title-full">OpenSCAD Assistive Forge</span>
                <span class="title-short" aria-hidden="true">OpenSCAD AF</span>
              </h1>
              <p class="app-tagline">
                Customize 3D models directly in your browser
              </p>
            </div>
          </div>
          <div class="header-controls">
            <!-- Memory Status Badge (Milestone 0: graceful degradation) -->
            <span
              id="memoryStatusBadge"
              class="memory-status-badge hidden"
              role="status"
              aria-live="polite"
              data-state="normal"
            >
              <svg
                class="memory-badge-icon"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
                <rect x="8" y="8" width="8" height="8" rx="1" ry="1"></rect>
                <line x1="4" y1="10" x2="1" y2="10"></line>
                <line x1="4" y1="14" x2="1" y2="14"></line>
                <line x1="23" y1="10" x2="20" y2="10"></line>
                <line x1="23" y1="14" x2="20" y2="14"></line>
              </svg>
              <span id="memoryStatusText" class="memory-badge-text">--</span>
            </span>
            <a
              href="https://github.com/BrennenJohnston/openscad-assistive-forge"
              class="btn btn-sm btn-secondary github-link"
              target="_blank"
              rel="noopener noreferrer"
              aria-label="View source code on GitHub (opens in new tab)"
              title="View on GitHub"
            >
              <svg
                class="github-icon"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                />
              </svg>
              <span class="github-label">GitHub</span>
            </a>
            <button
              id="shortcutsToggle"
              class="btn btn-sm btn-secondary shortcuts-toggle"
              aria-label="Keyboard shortcuts"
              title="Keyboard shortcuts"
            >
              <svg
                class="shortcuts-icon"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect>
                <line x1="6" y1="8" x2="6" y2="8"></line>
                <line x1="10" y1="8" x2="10" y2="8"></line>
                <line x1="14" y1="8" x2="14" y2="8"></line>
                <line x1="18" y1="8" x2="18" y2="8"></line>
                <line x1="6" y1="12" x2="6" y2="12"></line>
                <line x1="10" y1="12" x2="10" y2="12"></line>
                <line x1="14" y1="12" x2="14" y2="12"></line>
                <line x1="18" y1="12" x2="18" y2="12"></line>
                <line x1="8" y1="16" x2="16" y2="16"></line>
              </svg>
              <span class="shortcuts-label">Keys</span>
            </button>
            <button
              id="contrastToggle"
              class="btn btn-sm btn-secondary contrast-toggle"
              aria-label="Toggle high contrast"
              title="Toggle high contrast mode"
              data-tutorial-target="contrast-toggle"
            >
              <svg
                class="contrast-icon"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 2 L12 22"></path>
                <path
                  d="M12 2 A10 10 0 0 1 12 22"
                  fill="currentColor"
                  opacity="0.5"
                ></path>
              </svg>
              <span class="contrast-label">HC</span>
            </button>
            <button
              id="themeToggle"
              class="btn btn-sm btn-secondary theme-toggle"
              aria-label="Toggle theme"
              title="Toggle light/dark theme"
              data-tutorial-target="theme-toggle"
            >
              <svg
                class="theme-icon theme-icon-sun"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <svg
                class="theme-icon theme-icon-moon"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <path
                  d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </header>
      <div
        id="updateBanner"
        class="update-banner hidden"
        role="region"
        aria-live="polite"
        aria-label="Update available"
      >
        <div class="update-banner-content">
          <span class="update-banner-text"
            >Update available. Refresh to get the latest version.</span
          >
          <div class="update-banner-actions">
            <button id="updateBannerRefresh" class="btn btn-sm btn-primary">
              Refresh
            </button>
            <button id="updateBannerDismiss" class="btn btn-sm btn-secondary">
              Dismiss
            </button>
          </div>
        </div>
      </div>
      <!-- Memory Warning Banner (Milestone 0: graceful degradation) -->
      <div
        id="memoryBanner"
        class="memory-banner"
        role="alert"
        aria-live="assertive"
        data-visible="false"
        data-state="normal"
      >
        <svg
          class="memory-banner-icon"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          aria-hidden="true"
        >
          <path
            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
          ></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <span id="memoryBannerText" class="memory-banner-text">
          High memory usage detected. Consider saving your work.
        </span>
        <div class="memory-banner-actions">
          <!-- Critical state actions -->
          <button
            id="memoryBannerReduceFn"
            class="memory-banner-btn memory-action-critical"
            type="button"
            title="Lower quality settings to reduce memory usage"
          >
            Reduce Quality
          </button>
          <button
            id="memoryBannerDisableAuto"
            class="memory-banner-btn memory-action-critical"
            type="button"
            title="Disable automatic preview updates"
          >
            Disable Auto-Preview
          </button>
          <button id="memoryBannerSave" class="memory-banner-btn" type="button">
            Save Project
          </button>
          <!-- Emergency state actions -->
          <button
            id="memoryBannerExport"
            class="memory-banner-btn memory-action-emergency"
            type="button"
            title="Export STL to preserve your work"
          >
            Export STL
          </button>
          <button
            id="memoryBannerReload"
            class="memory-banner-btn memory-action-emergency"
            type="button"
            title="Reload page in recovery mode (your work will be saved)"
          >
            Reload (Safe)
          </button>
          <button
            id="memoryBannerDismiss"
            class="memory-banner-btn memory-action-dismissable"
            type="button"
            aria-label="Dismiss memory warning"
          >
            Dismiss
          </button>
        </div>
      </div>
      <div id="toolbarSlot">
        <!-- Workflow Progress Indicator (C3: COGA breadcrumbs) - Moved here to prevent header overlap -->
        <!-- #toolbarMenuBar is a flex sibling of .workflow-steps inside this container so that
             in Advanced mode the toolbar buttons share the same row as the action buttons,
             exactly replacing the breadcrumb steps. -->
        <div
          class="workflow-progress hidden"
          id="workflowProgress"
          role="navigation"
          aria-label="Workflow progress"
        >
          <div
            id="toolbarMenuBar"
            class="toolbar-menu-bar hidden"
            aria-label="Application menu"
          >
            <button
              class="toolbar-menu-btn btn"
              id="fileMenuBtn"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              File</button
            ><button
              class="toolbar-menu-btn btn"
              id="editMenuBtn"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              Edit</button
            ><button
              class="toolbar-menu-btn btn"
              id="designMenuBtn"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              Design</button
            ><button
              class="toolbar-menu-btn btn"
              id="viewMenuBtn"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              View</button
            ><button
              class="toolbar-menu-btn btn"
              id="windowMenuBtn"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              Window</button
            ><button
              class="toolbar-menu-btn btn"
              id="helpMenuBtn"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              Help
            </button>
          </div>
          <ol class="workflow-steps">
            <li class="workflow-step" data-step="upload" aria-current="false">
              <span class="workflow-step-number">1</span>
              <span class="workflow-step-label">Upload</span>
            </li>
            <li
              class="workflow-step"
              data-step="customize"
              aria-current="false"
            >
              <span class="workflow-step-number">2</span>
              <span class="workflow-step-label">Customize</span>
            </li>
            <li class="workflow-step" data-step="render" aria-current="false">
              <span class="workflow-step-number">3</span>
              <span class="workflow-step-label">Generate</span>
            </li>
            <li class="workflow-step" data-step="download" aria-current="false">
              <span class="workflow-step-number">4</span>
              <span class="workflow-step-label">Download</span>
            </li>
          </ol>
          <div class="workflow-actions">
            <button
              id="uiModeToggle"
              class="ui-mode-toggle hidden"
              role="switch"
              aria-checked="true"
              aria-label="Interface mode: Advanced. Click to switch to Basic mode"
              title="Switch between Basic and Advanced interface modes"
            >
              <span
                class="ui-mode-option ui-mode-option--basic"
                aria-hidden="true"
                >Basic</span
              >
              <span
                class="ui-mode-option ui-mode-option--advanced"
                aria-hidden="true"
                >Advanced</span
              >
              <span class="ui-mode-slider" aria-hidden="true"></span>
            </button>
            <button
              id="focusModeBtn"
              class="btn btn-sm btn-outline"
              aria-pressed="false"
              aria-label="Enter focus mode"
              title="Focus mode (maximize preview)"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <path
                  d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
                ></path>
              </svg>
              <span class="btn-text">Full Screen</span>
            </button>
            <button
              id="featuresGuideBtn"
              class="btn btn-sm btn-outline btn-with-icon"
              aria-label="Open features guide and examples"
              title="Help & Examples"
              data-tutorial-target="features-guide"
            >
              <svg
                class="btn-icon-svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="square"
                stroke-linejoin="miter"
                aria-hidden="true"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="11" x2="12" y2="16"></line>
                <circle
                  cx="12"
                  cy="7.5"
                  r="1"
                  fill="currentColor"
                  stroke="none"
                ></circle>
              </svg>
              <span class="btn-text">Help</span>
            </button>
            <button
              id="clearFileBtn"
              class="btn btn-sm btn-outline"
              aria-label="Go back to welcome screen. Warning: unsaved changes will be lost"
              title="Back to welcome screen (unsaved changes will be lost)"
              data-tutorial-target="clear-file"
            >
              ← Back
            </button>
          </div>
        </div>
      </div>
      <main class="app-main" id="main-content" tabindex="-1">
        <div class="welcome-screen" id="welcomeScreen">
          <div class="welcome-content">
            <div
              class="features-overview"
              role="region"
              aria-labelledby="features-heading"
            >
              <h3 id="features-heading">Discover Features</h3>
              <div class="role-paths-grid">
                <!-- Beginners Start Here (only visible tutorial for now) -->
                <div class="role-path-card">
                  <h4 class="role-path-title">Beginners Start Here</h4>
                  <p class="role-path-meta">Guided tour • about 3 minutes</p>
                  <p class="role-path-description">
                    Load a simple example, change a few parameters, and generate
                    your first file.
                  </p>
                  <details class="role-path-details">
                    <summary>What you’ll learn</summary>
                    <ul class="role-path-tips" aria-label="What you'll learn">
                      <li>Where parameters live and how Preview updates</li>
                      <li>Presets and key actions (Generate / Download)</li>
                      <li>Camera controls and keyboard basics</li>
                    </ul>
                  </details>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-primary btn-role-try"
                      data-example="simple-box"
                      data-role="beginners"
                      data-tutorial="intro"
                    >
                      Start Tutorial
                    </button>
                    <button
                      class="btn btn-link btn-role-learn"
                      data-feature-tab="workflow"
                      aria-label="Open Help: Workflow"
                    >
                      Open Help
                    </button>
                  </div>
                </div>
                <div class="role-path-card">
                  <h4 class="role-path-title">Explore Features</h4>
                  <p class="role-path-description">
                    Prefer to browse? Open Help for examples and deeper
                    guidance.
                  </p>
                  <details class="role-path-details">
                    <summary>Common tasks</summary>
                    <ul class="role-path-tips" aria-label="Common tasks">
                      <li>Enable libraries and resolve dependencies</li>
                      <li>Save and reuse presets for repeatable settings</li>
                      <li>Export files and work with ZIP projects</li>
                    </ul>
                  </details>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-outline btn-role-learn"
                      data-feature-tab="libraries"
                      aria-label="Open Help: Libraries"
                    >
                      Open Help & Examples
                    </button>
                  </div>
                </div>
                <!-- Other tutorials are temporarily hidden (we'll re-enable later) -->
                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Advanced Makers</h4>
                  <p class="role-path-description">
                    Work with multi-file projects, libraries, and advanced
                    OpenSCAD features
                  </p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Upload ZIP files with dependencies</li>
                    <li>Enable MCAD, BOSL2, and other libraries</li>
                    <li>Export in multiple formats (STL, OBJ, 3MF)</li>
                  </ul>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-primary btn-role-try"
                      data-example="library-test"
                      data-role="makers"
                      data-tutorial="makers"
                    >
                      Start Tutorial
                    </button>
                    <button
                      class="btn btn-link btn-role-learn"
                      data-feature-tab="libraries"
                      aria-label="Open Features Guide: Libraries"
                    >
                      Learn More
                    </button>
                  </div>
                </div>
                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Keyboard-Only Users</h4>
                  <p class="role-path-description">
                    Complete the full workflow without a mouse using predictable
                    keyboard controls
                  </p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Tab through parameters logically</li>
                    <li>Undo/Redo with Ctrl+Z / Ctrl+Shift+Z</li>
                    <li>Skip to main content (screen top)</li>
                  </ul>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-primary btn-role-try"
                      data-example="cylinder"
                      data-role="keyboard-only"
                      data-tutorial="keyboard-only"
                    >
                      Start Tutorial
                    </button>
                    <button
                      class="btn btn-link btn-role-learn"
                      data-doc="KEYGUARD_WORKFLOW_GUIDE"
                      aria-label="Learn about keyboard navigation"
                    >
                      Learn More
                    </button>
                  </div>
                </div>
                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Low Vision Users</h4>
                  <p class="role-path-description">
                    Use high contrast themes, large touch targets, and visible
                    focus indicators
                  </p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Toggle HC button (high contrast mode)</li>
                    <li>Switch light/dark theme</li>
                    <li>All buttons meet 44×44px touch target</li>
                  </ul>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-primary btn-role-try"
                      data-example="simple-box"
                      data-role="low-vision"
                      data-tutorial="low-vision"
                    >
                      Start Tutorial
                    </button>
                    <button
                      class="btn btn-link btn-role-learn"
                      data-doc="ACCESSIBILITY_GUIDE"
                      data-feature-tab="accessibility"
                      aria-label="Learn about visual accessibility features"
                    >
                      Learn More
                    </button>
                  </div>
                </div>
                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Voice Input Users</h4>
                  <p class="role-path-description">
                    Control the app with voice commands using stable, speakable
                    names
                  </p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Say button labels: "Click Generate"</li>
                    <li>Navigate: "Click Help", "Click Reset"</li>
                    <li>All controls have unique, speakable names</li>
                  </ul>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-primary btn-role-try"
                      data-example="simple-box"
                      data-role="voice-input"
                      data-tutorial="voice-input"
                    >
                      Start Tutorial
                    </button>
                    <button
                      class="btn btn-link btn-role-learn"
                      data-doc="ACCESSIBILITY_GUIDE"
                      data-feature-tab="accessibility"
                      aria-label="Learn about voice input and accessible control names"
                    >
                      Learn More
                    </button>
                  </div>
                </div>
                <div class="role-path-card" hidden aria-hidden="true">
                  <h4 class="role-path-title">Screen Reader Users</h4>
                  <p class="role-path-description">
                    Customize models with clear status announcements and
                    keyboard-only workflow
                  </p>
                  <ul class="role-path-tips" aria-label="What you'll learn">
                    <li>Status area announces all changes</li>
                    <li>ARIA landmarks for quick navigation</li>
                    <li>Plain-language error messages</li>
                  </ul>
                  <div class="role-path-actions">
                    <button
                      class="btn btn-primary btn-role-try"
                      data-example="simple-box"
                      data-role="screen-reader"
                      data-tutorial="screen-reader"
                    >
                      Start Tutorial
                    </button>
                    <button
                      class="btn btn-link btn-role-learn"
                      data-doc="ACCESSIBILITY_GUIDE"
                      data-feature-tab="accessibility"
                      aria-label="Learn about screen reader accessibility features"
                    >
                      Learn More
                    </button>
                  </div>
                </div>
              </div>
              <!-- Accessibility Spotlights -->
              <details
                class="accessibility-spotlights"
                id="accessibilitySpotlights"
              >
                <summary class="spotlights-summary">
                  <span class="spotlights-summary-title"
                    >Accessibility Highlights</span
                  >
                  <span class="sr-only"
                    >Expand to learn more about accessibility features</span
                  >
                </summary>
                <div
                  class="spotlights-body"
                  role="group"
                  aria-label="Accessibility highlights details"
                >
                  <p class="spotlights-intro">
                    Built around accessibility patterns commonly seen in open
                    source tools like VS Code and JupyterLab: predictable
                    keyboard navigation, strong focus visibility, and clear
                    status messaging.
                  </p>
                  <ul
                    class="spotlights-list"
                    aria-label="Accessibility highlights"
                  >
                    <li>
                      <a
                        href="#"
                        class="spotlight-link"
                        data-doc="KEYGUARD_WORKFLOW_GUIDE"
                        data-feature-tab="accessibility"
                      >
                        <span class="spotlight-title"
                          >Keyboard-first workflow (no required drag
                          gestures)</span
                        >
                        <span class="spotlight-detail">
                          Tab through controls, activate with Enter/Space, and
                          adjust sliders/number fields without dragging.
                          Step-by-step workflow guidance is available.
                        </span>
                      </a>
                    </li>
                    <li>
                      <a
                        href="#"
                        class="spotlight-link"
                        data-doc="ACCESSIBILITY_GUIDE"
                        data-feature-tab="accessibility"
                      >
                        <span class="spotlight-title"
                          >High contrast, dark mode, and Windows forced-colors
                          support</span
                        >
                        <span class="spotlight-detail">
                          Theme controls plus OS-enforced contrast modes keep
                          borders, focus rings, and text readable.
                        </span>
                      </a>
                    </li>
                    <li>
                      <a
                        href="#"
                        class="spotlight-link"
                        data-doc="ACCESSIBILITY_GUIDE"
                        data-feature-tab="accessibility"
                      >
                        <span class="spotlight-title"
                          >Screen reader-friendly status updates and focus-safe
                          dialogs</span
                        >
                        <span class="spotlight-detail">
                          Key actions announce status changes, and dialogs use
                          focus trapping + focus restoration.
                        </span>
                      </a>
                    </li>
                    <li>
                      <a
                        href="#"
                        class="spotlight-link"
                        data-doc="ACCESSIBILITY_GUIDE"
                        data-feature-tab="accessibility"
                      >
                        <span class="spotlight-title"
                          >Plain-language errors and guidance (not cryptic
                          console logs)</span
                        >
                        <span class="spotlight-detail">
                          Errors are translated into actionable messages so you
                          can recover quickly.
                        </span>
                      </a>
                    </li>
                  </ul>
                </div>
              </details>
            </div>
            <!-- Saved Designs Section (v2 with folder tree) -->
            <section
              class="saved-projects-panel"
              id="savedProjectsPanel"
              aria-labelledby="saved-projects-heading"
            >
              <div class="saved-projects-header">
                <h3 id="saved-projects-heading">Saved Designs</h3>
                <div class="saved-projects-actions">
                  <button
                    type="button"
                    class="btn btn-sm btn-outline"
                    id="exportAllProjectsBtn"
                    aria-label="Export all projects as backup"
                    title="Export Backup"
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path
                        d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                      ></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <span class="btn-text">Export</span>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline"
                    id="importProjectsBtn"
                    aria-label="Import projects from backup"
                    title="Import Backup"
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path
                        d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                      ></path>
                      <polyline points="17 8 12 3 7 8"></polyline>
                      <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span class="btn-text">Import</span>
                  </button>
                </div>
              </div>
              <p class="saved-projects-description">
                Your projects organized in folders (stored in this browser)
              </p>
              <!-- Breadcrumb navigation for folder path -->
              <nav
                class="folder-breadcrumbs hidden"
                id="folderBreadcrumbs"
                aria-label="Folder navigation"
              >
                <ol class="breadcrumb-list" id="breadcrumbList">
                  <!-- Dynamically populated -->
                </ol>
              </nav>
              <!-- Folder tree and projects container -->
              <div class="saved-projects-container" id="savedProjectsContainer">
                <div
                  class="folder-tree"
                  id="folderTree"
                  role="tree"
                  aria-label="Folder tree"
                >
                  <!-- Dynamically populated with folders -->
                </div>
                <div
                  class="saved-projects-list"
                  id="savedProjectsList"
                  role="list"
                  aria-label="Saved designs"
                >
                  <!-- Dynamically populated with projects -->
                </div>
              </div>
              <p class="saved-projects-empty hidden" id="savedProjectsEmpty">
                No saved designs yet. Upload a file and choose to save it.
              </p>
              <!-- Hidden file input for import -->
              <input
                type="file"
                id="importBackupInput"
                accept=".zip,.json"
                class="hidden"
                aria-hidden="true"
              />
            </section>
            <section
              class="upload-panel"
              aria-labelledby="upload-panel-heading"
            >
              <h3 id="upload-panel-heading">Get Started</h3>
              <p>
                Upload an OpenSCAD (.scad) file to customize its parameters and
                generate STL files
              </p>
              <!-- Primary actions: Upload existing file OR start new -->
              <div class="welcome-actions">
                <label
                  class="upload-zone"
                  id="uploadZone"
                  for="fileInput"
                  tabindex="0"
                >
                  <svg
                    class="upload-icon"
                    width="48"
                    height="48"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                  </svg>
                  <span class="upload-text"
                    >Drop .scad or .zip file here or click to browse</span
                  >
                  <input
                    type="file"
                    id="fileInput"
                    accept=".scad,.zip"
                    class="file-input"
                  />
                </label>
                <div class="welcome-divider"><span>or</span></div>
                <button
                  type="button"
                  class="btn btn-lg btn-outline start-new-btn"
                  id="startNewProjectBtn"
                  aria-label="Start a new OpenSCAD project from scratch"
                >
                  <svg
                    class="btn-icon-svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <path
                      d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                    ></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                  </svg>
                  <span>Start New Project</span>
                </button>
              </div>
            </section>
            <!-- Storage Panel -->
            <section class="storage-panel" aria-labelledby="storage-heading">
              <h3 id="storage-heading">Storage Usage</h3>
              <p class="storage-description">
                Persistent storage for cached files, presets, and settings
              </p>
              <div
                class="storage-meter"
                role="progressbar"
                aria-valuemin="0"
                aria-valuemax="100"
                aria-valuenow="0"
                aria-label="Storage usage percentage"
              >
                <div class="storage-meter-fill"></div>
              </div>
              <div class="storage-info">
                <span id="storage-used">-- used</span>
              </div>
              <button
                type="button"
                class="btn btn-secondary"
                id="clearStorageBtn"
                aria-describedby="storage-heading"
              >
                Clear Cache
              </button>
              <p class="storage-not-supported hidden" id="storageNotSupported">
                Storage information not available in this browser.
              </p>
            </section>
          </div>
        </div>
        <div class="main-interface hidden" id="mainInterface">
          <div
            class="param-panel"
            id="paramPanel"
            role="region"
            aria-labelledby="parameters-heading"
          >
            <!-- WCAG 2.2 SC 3.2.6 Consistent Help: Help mechanisms (Features Guide button)                  appear in consistent relative order across panels (top-right area) -->
            <div class="panel-header">
              <!-- Row 1: Title + close/collapse controls -->
              <div class="panel-header-title-row">
                <h2 id="parameters-heading">Parameters</h2>
                <!-- Mobile close button for drawer -->
                <button
                  id="drawerCloseBtn"
                  class="btn btn-sm btn-icon mobile-only drawer-close-btn forge-control"
                  aria-label="Close parameters panel"
                  title="Close"
                  style="display: none"
                  data-tutorial-target="mobile-drawer-close"
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              <!-- Row 2: Action toolbar -->
              <div class="param-header-actions">
                <button
                  id="undoBtn"
                  class="btn btn-sm btn-icon"
                  aria-label="Undo last parameter change"
                  disabled
                >
                  <svg
                    class="btn-icon-svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <polyline points="1 4 1 10 7 10"></polyline>
                    <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                  </svg>
                </button>
                <button
                  id="redoBtn"
                  class="btn btn-sm btn-icon"
                  aria-label="Redo last parameter change"
                  disabled
                >
                  <svg
                    class="btn-icon-svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"></path>
                  </svg>
                </button>
                <button
                  id="resetBtn"
                  class="btn btn-sm"
                  aria-label="Reset all parameters to default values"
                >
                  Reset
                </button>
                <!-- Expert Mode toggle (M2) - hidden until feature flag enabled -->
                <button
                  id="expertModeToggle"
                  class="mode-toggle-btn hidden"
                  aria-pressed="false"
                  aria-label="Toggle Expert Mode - code editor"
                  title="Expert Mode: Edit OpenSCAD code directly"
                  data-tutorial-target="expert-mode-toggle"
                >
                  <span class="mode-icon" aria-hidden="true">{ }</span>
                  <span class="btn-text">Code</span>
                </button>
                <button
                  id="collapseParamPanelBtn"
                  class="btn btn-sm btn-icon btn-collapse-panel forge-control"
                  aria-expanded="true"
                  aria-controls="paramPanelBody"
                  aria-label="Collapse parameters panel"
                  title="Collapse panel"
                  data-tutorial-target="collapse-param-panel"
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <polyline points="11 18 5 12 11 6"></polyline>
                    <line
                      x1="17"
                      y1="4"
                      x2="17"
                      y2="20"
                      stroke-width="2"
                    ></line>
                  </svg>
                </button>
              </div>
            </div>
            <!-- Manifest project info banner (hidden until a manifest project loads) -->
            <div
              class="manifest-info-banner hidden"
              id="manifestInfoBanner"
              role="status"
              aria-live="polite"
            >
              <span class="manifest-info-icon" aria-hidden="true"
                >&#128279;</span
              >
              <span class="manifest-info-text" id="manifestInfoText"
                >Shared project</span
              >
              <button
                type="button"
                id="manifestSaveCopyBtn"
                class="btn btn-sm btn-primary"
                aria-label="Save a local copy of this shared project to browser storage"
              >
                Save My Copy
              </button>
              <button
                type="button"
                id="manifestDownloadZipBtn"
                class="btn btn-sm btn-outline"
                aria-label="Download this project as a ZIP file for offline use"
              >
                Download ZIP
              </button>
              <button
                type="button"
                id="manifestResetBtn"
                class="btn btn-sm btn-outline"
                aria-label="Reload original project from shared link"
              >
                Reset to Original
              </button>
              <button
                type="button"
                id="manifestDismissBanner"
                class="btn-icon"
                aria-label="Dismiss project info banner"
                title="Dismiss"
              >
                &#10005;
              </button>
            </div>
            <div class="param-panel-body" id="paramPanelBody">
              <!-- Console Output Panel -- Displays ECHO, WARNING, ERROR messages from OpenSCAD -->
              <details
                class="console-panel forge-disclosure"
                id="consolePanel"
                role="region"
                aria-label="OpenSCAD console output"
              >
                <summary class="console-summary">
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="square"
                    stroke-linejoin="miter"
                    aria-hidden="true"
                  >
                    <polyline points="4 17 10 11 4 5"></polyline>
                    <line x1="12" y1="19" x2="20" y2="19"></line>
                  </svg>
                  <span class="console-title forge-disclosure-title"
                    >Console Output</span
                  >
                  <span
                    id="console-badge"
                    class="console-badge hidden"
                    aria-hidden="true"
                    >0</span
                  >
                </summary>
                <div class="console-content">
                  <div class="console-controls">
                    <label class="console-filter">
                      <input type="checkbox" id="console-filter-echo" checked />
                      <span>ECHO</span>
                    </label>
                    <label class="console-filter">
                      <input type="checkbox" id="console-filter-warn" checked />
                      <span>Warnings</span>
                    </label>
                    <label class="console-filter">
                      <input
                        type="checkbox"
                        id="console-filter-error"
                        checked
                      />
                      <span>Errors</span>
                    </label>
                    <div class="console-actions">
                      <button
                        id="console-copy-btn"
                        class="btn btn-sm btn-icon"
                        aria-label="Copy console output to clipboard"
                        title="Copy to clipboard"
                      >
                        📋
                      </button>
                      <button
                        id="console-download-btn"
                        class="btn btn-sm btn-icon"
                        aria-label="Download console log"
                        title="Download log"
                      >
                        ⬇️
                      </button>
                      <button
                        id="console-clear-btn"
                        class="btn btn-sm btn-icon"
                        aria-label="Clear console"
                        title="Clear"
                      >
                        🗑️
                      </button>
                    </div>
                  </div>
                  <div
                    id="console-output"
                    class="console-output"
                    role="log"
                    aria-label="Console messages"
                    aria-live="polite"
                    aria-relevant="additions"
                  >
                    <div class="console-empty">
                      No console output yet. ECHO, WARNING, and ERROR messages
                      will appear here.
                    </div>
                  </div>
                </div>
              </details>
              <!-- File Actions Panel -->
              <!-- File Actions panel removed: all features now in File toolbar menu -->
              <!-- Error Log Panel -->
              <details
                class="error-log-panel forge-disclosure"
                id="errorLogPanel"
                role="region"
                aria-label="Error log"
              >
                <summary class="error-log-summary">
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <path
                      d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
                    ></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                  <span class="error-log-title forge-disclosure-title"
                    >Error Log</span
                  >
                  <span
                    id="error-log-badge"
                    class="error-log-badge hidden"
                    aria-hidden="true"
                    >0</span
                  >
                </summary>
                <div class="error-log-content">
                  <div class="error-log-controls">
                    <label class="error-log-filter">
                      <input
                        type="checkbox"
                        id="error-log-filter-error"
                        checked
                      />
                      <span>Errors</span>
                    </label>
                    <label class="error-log-filter">
                      <input
                        type="checkbox"
                        id="error-log-filter-warn"
                        checked
                      />
                      <span>Warnings</span>
                    </label>
                    <label class="error-log-filter">
                      <input
                        type="checkbox"
                        id="error-log-filter-deprecated"
                        checked
                      />
                      <span>Deprecated</span>
                    </label>
                    <label class="error-log-filter">
                      <input type="checkbox" id="error-log-filter-trace" />
                      <span>Trace</span>
                    </label>
                    <div class="error-log-actions">
                      <button
                        id="error-log-copy-btn"
                        class="btn btn-sm btn-icon"
                        aria-label="Copy error log to clipboard"
                        title="Copy to clipboard"
                      >
                        📋
                      </button>
                      <button
                        id="error-log-clear-btn"
                        class="btn btn-sm btn-icon"
                        aria-label="Clear error log"
                        title="Clear"
                      >
                        🗑️
                      </button>
                    </div>
                  </div>
                  <div
                    id="error-log-output"
                    class="error-log-output"
                    role="log"
                    aria-label="Error log entries"
                    aria-live="polite"
                  >
                    <div class="error-log-empty">
                      No errors. Compile or render to check for issues.
                    </div>
                  </div>
                </div>
              </details>
              <!-- Measurement and Overlay group -->
              <div
                class="tool-group"
                role="group"
                aria-labelledby="measureOverlayGroupLabel"
              >
                <h3
                  id="measureOverlayGroupLabel"
                  class="tool-group-label"
                >
                  Measurement and Overlay
                </h3>
              <!-- Image Measurement Tool -->
              <details
                class="measure-details forge-disclosure"
                id="measureSection"
                role="region"
                aria-label="Image measurement tool"
              >
                <summary class="measure-summary">
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="square"
                    stroke-linejoin="miter"
                    aria-hidden="true"
                  >
                    <path d="M2 12h5l2-7 3 14 2-7h5"></path>
                    <line x1="22" y1="12" x2="22" y2="12"></line>
                  </svg>
                  <span class="forge-disclosure-title">Image Measurement</span>
                </summary>
                <div class="measure-controls">
                  <!-- Source image selection -->
                  <div class="measure-control measure-source-row">
                    <select
                      id="measureImageSelect"
                      class="measure-image-select"
                      aria-label="Select from previously uploaded screenshots"
                    >
                      <option value="">-- No screenshots --</option>
                    </select>
                    <label
                      class="btn btn-sm btn-outline measure-upload-btn"
                      for="measureFileInput"
                      title="Upload an image (PNG, JPG, WebP, GIF)"
                    >
                      &#x1F4E4; Browse
                      <input
                        type="file"
                        id="measureFileInput"
                        accept="image/png,image/jpeg,image/webp,image/gif,.png,.jpg,.jpeg,.webp,.gif"
                        class="sr-only"
                        aria-label="Upload reference image for measurement"
                      />
                    </label>
                  </div>
                  <!-- Toolbar: mode toggle + zoom/view controls -->
                  <div class="measure-toolbar">
                    <div
                      class="measure-mode-row"
                      role="radiogroup"
                      aria-label="Measurement mode"
                    >
                      <button
                        type="button"
                        id="measureModePoint"
                        class="btn btn-sm btn-outline measure-mode-btn active"
                        role="radio"
                        aria-checked="true"
                        tabindex="0"
                      >
                        Point
                      </button>
                      <button
                        type="button"
                        id="measureModeRuler"
                        class="btn btn-sm btn-outline measure-mode-btn"
                        role="radio"
                        aria-checked="false"
                        tabindex="-1"
                      >
                        Ruler
                      </button>
                      <button
                        type="button"
                        id="measureModeCalibrate"
                        class="btn btn-sm btn-outline measure-mode-btn"
                        role="radio"
                        aria-checked="false"
                        tabindex="-1"
                      >
                        Calibrate
                      </button>
                    </div>
                    <div class="measure-zoom-row">
                      <button
                        type="button"
                        id="measureZoomOut"
                        class="btn btn-sm btn-icon measure-zoom-btn"
                        aria-label="Zoom out"
                        title="Zoom out"
                      >
                        &minus;
                      </button>
                      <input
                        type="number"
                        id="measureZoomLevel"
                        class="measure-zoom-input"
                        value="100"
                        min="10"
                        max="1000"
                        step="10"
                        aria-label="Zoom percentage"
                        title="Enter zoom percentage"
                      />
                      <button
                        type="button"
                        id="measureZoomIn"
                        class="btn btn-sm btn-icon measure-zoom-btn"
                        aria-label="Zoom in"
                        title="Zoom in"
                      >
                        +
                      </button>
                      <button
                        type="button"
                        id="measureZoomReset"
                        class="btn btn-sm btn-outline"
                        aria-label="Reset zoom to fit"
                        title="Fit to view"
                      >
                        Fit
                      </button>
                      <button
                        type="button"
                        id="measureExpandBtn"
                        class="btn btn-sm btn-icon"
                        aria-label="Open image measurement in fullscreen"
                        title="Full Screen"
                      >
                        &#x26F6;
                      </button>
                    </div>
                  </div>
                  <!-- Canvas container -->
                  <div class="measure-canvas-container">
                    <canvas
                      id="measureCanvas"
                      class="measure-canvas"
                      aria-label="Image measurement canvas. Drop an image or click Browse."
                    ></canvas>
                    <button
                      type="button"
                      id="measureFullscreenClose"
                      class="btn btn-sm btn-icon measure-fullscreen-close hidden"
                      aria-label="Exit fullscreen measurement view"
                    >
                      &#10005;
                    </button>
                  </div>
                  <!-- Coordinate readout -->
                  <div class="measure-coord-row">
                    <div class="measure-coord-pair">
                      <label class="measure-coord-label" for="measureCoordX"
                        >X</label
                      >
                      <output
                        id="measureCoordX"
                        class="measure-coord-value"
                        aria-label="X coordinate"
                        >0</output
                      >
                      <button
                        type="button"
                        id="measureCopyX"
                        class="btn btn-sm btn-outline measure-copy-btn"
                        aria-label="Copy X coordinate"
                        title="Copy X"
                      >
                        Copy X
                      </button>
                    </div>
                    <div class="measure-coord-pair">
                      <label class="measure-coord-label" for="measureCoordY"
                        >Y</label
                      >
                      <output
                        id="measureCoordY"
                        class="measure-coord-value"
                        aria-label="Y coordinate"
                        >0</output
                      >
                      <button
                        type="button"
                        id="measureCopyY"
                        class="btn btn-sm btn-outline measure-copy-btn"
                        aria-label="Copy Y coordinate"
                        title="Copy Y"
                      >
                        Copy Y
                      </button>
                    </div>
                    <span
                      id="measurePinIndicator"
                      class="measure-pin-indicator"
                      hidden
                      aria-live="polite"
                      >Pinned</span
                    >
                    <button
                      type="button"
                      id="measureUnpinBtn"
                      class="btn btn-sm btn-outline"
                      aria-label="Unpin crosshair and resume tracking"
                      hidden
                    >
                      Unpin
                    </button>
                  </div>
                  <!-- Distance readout (Ruler mode) -->
                  <div id="measureDistRow" class="measure-dist-row hidden">
                    <label for="measureDistValue">Distance</label>
                    <output id="measureDistValue">--</output>
                    <button
                      type="button"
                      id="measureCopyDist"
                      class="btn btn-sm btn-outline"
                      aria-label="Copy distance value"
                    >
                      Copy
                    </button>
                    <button
                      type="button"
                      id="measureClearRuler"
                      class="btn btn-sm btn-outline"
                      aria-label="Clear ruler points"
                    >
                      Clear
                    </button>
                  </div>
                  <!-- Calibration input (Calibrate mode) -->
                  <div id="measureCalibRow" class="measure-calib-row hidden">
                    <span id="measureCalibPixels">0 px</span>
                    <span aria-hidden="true">=</span>
                    <input
                      type="number"
                      id="measureCalibMm"
                      min="0.1"
                      step="0.1"
                      placeholder="mm"
                      aria-label="Known distance in millimeters"
                    />
                    <button
                      type="button"
                      id="measureCalibApply"
                      class="btn btn-sm btn-primary"
                      aria-label="Apply calibration to set scale factor"
                    >
                      Apply
                    </button>
                    <span
                      id="measureCalibError"
                      class="measure-calib-error hidden"
                      role="alert"
                    ></span>
                  </div>
                  <!-- Scale &amp; unit settings (below canvas for cleaner layout) -->
                  <div class="measure-scale-section">
                    <div class="measure-info-row">
                      <span class="measure-dim-display" id="measureDimensions"
                        >&mdash;</span
                      >
                      <select
                        id="measureUnitSelect"
                        class="measure-unit-select"
                        aria-label="Coordinate display unit"
                      >
                        <option value="px" selected>px</option>
                        <option value="mm">mm</option>
                      </select>
                    </div>
                    <div class="measure-scale-row" id="measureScaleRow">
                      <label for="measureScaleInput" class="measure-scale-label"
                        >Scale (px/mm)</label
                      >
                      <input
                        type="number"
                        id="measureScaleInput"
                        class="measure-scale-input"
                        min="0.01"
                        step="0.01"
                        placeholder="10.39"
                        aria-label="Scale factor: pixels per millimeter"
                        title="Pixels per millimeter. Default: iPad 264 PPI (10.39 px/mm)"
                      />
                      <span class="measure-scale-hint" id="measureScaleHint"
                        >Default: iPad 264 PPI &mdash; or use Calibrate</span
                      >
                    </div>
                  </div>
                  <!-- Screen reader live region for coordinate announcements -->
                  <div
                    id="measureLiveRegion"
                    class="sr-only"
                    aria-live="polite"
                    role="status"
                  ></div>
                  <p class="measure-help-text" aria-live="polite">
                    Click to pin crosshair. Double-click or Escape to unpin.
                    Arrow keys move crosshair; Shift+arrows for 10 px steps.
                    Enter/Space toggles pin. Scroll to zoom.
                  </p>
                </div>
              </details>
              <!-- Edit Tools panel removed: all features now in Edit toolbar menu -->
              <div
                id="measureFullscreenBackdrop"
                class="measure-fullscreen-backdrop hidden"
                aria-hidden="true"
              ></div>
              <!-- Reference Overlay Controls -->
              <details
                class="overlay-details forge-disclosure"
                id="overlaySection"
                role="region"
                aria-label="Reference overlay controls"
              >
                <summary class="overlay-summary">
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="square"
                    stroke-linejoin="miter"
                    aria-hidden="true"
                  >
                    <rect x="3" y="3" width="18" height="18" rx="0"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                  <span class="overlay-summary-text forge-disclosure-title"
                    >Reference Overlay</span
                  >
                  <span class="overlay-status" id="overlayStatus">Off</span>
                </summary>
                <div class="overlay-controls">
                  <div class="overlay-control overlay-upload-control">
                    <label class="overlay-control-label"> Source image </label>
                    <div class="overlay-source-row">
                      <select
                        id="overlaySourceSelect"
                        class="overlay-select"
                        aria-describedby="overlaySourceHelp"
                      >
                        <option value="">-- No image --</option>
                      </select>
                      <label
                        class="btn btn-sm btn-outline overlay-upload-btn"
                        for="overlayFileInput"
                        title="Upload an image file (SVG, PNG, JPG)"
                      >
                        📤 Upload
                        <input
                          type="file"
                          id="overlayFileInput"
                          accept=".svg,.png,.jpg,.jpeg,image/svg+xml,image/png,image/jpeg"
                          class="sr-only"
                          aria-label="Upload overlay image file"
                        />
                      </label>
                    </div>
                    <span id="overlaySourceHelp" class="sr-only"
                      >Select an SVG, PNG, or JPG file to use as a reference
                      overlay, or upload a new one</span
                    >
                  </div>
                  <label class="overlay-enable-toggle">
                    <input
                      type="checkbox"
                      id="overlayToggle"
                      aria-describedby="overlayToggleHelp"
                    />
                    <span>Show overlay</span>
                  </label>
                  <span id="overlayToggleHelp" class="sr-only"
                    >Toggle visibility of the reference image overlay in the 3D
                    preview</span
                  >
                  <label class="overlay-measurements-toggle">
                    <input
                      type="checkbox"
                      id="overlayMeasurementsToggle"
                      aria-describedby="overlayMeasurementsHelp"
                    />
                    <span>Show overlay measurements</span>
                  </label>
                  <span id="overlayMeasurementsHelp" class="sr-only"
                    >Toggle dimension measurements and outline on the overlay
                    image</span
                  >
                  <div class="overlay-control overlay-opacity-control">
                    <label
                      class="overlay-control-label"
                      for="overlayOpacityInput"
                      id="overlayOpacityLabel"
                    >
                      Opacity
                    </label>
                    <div class="slider-container">
                      <input
                        type="range"
                        id="overlayOpacityInput"
                        min="0"
                        max="100"
                        step="5"
                        value="100"
                        aria-labelledby="overlayOpacityLabel"
                        aria-describedby="overlayOpacityHelp"
                        aria-valuemin="0"
                        aria-valuemax="100"
                        aria-valuenow="100"
                      />
                      <span class="slider-value" id="overlayOpacityValue"
                        >100%</span
                      >
                    </div>
                  </div>
                  <span id="overlayOpacityHelp" class="sr-only"
                    >Adjust reference overlay transparency from 0 to 100
                    percent</span
                  >
                  <div class="overlay-control overlay-color-control">
                    <label
                      class="overlay-control-label"
                      for="overlayColorInput"
                      id="overlayColorLabel"
                    >
                      SVG Color
                    </label>
                    <div class="overlay-color-row">
                      <input
                        type="color"
                        id="overlayColorInput"
                        value="#000000"
                        aria-labelledby="overlayColorLabel"
                        aria-describedby="overlayColorHelp"
                      />
                      <label class="overlay-auto-color-toggle">
                        <input
                          type="checkbox"
                          id="overlayAutoColorToggle"
                          checked
                        />
                        <span>Auto (match theme)</span>
                      </label>
                    </div>
                  </div>
                  <span id="overlayColorHelp" class="sr-only"
                    >Choose the color applied to SVG overlay strokes and fills.
                    Auto mode picks a visible color for the current
                    theme.</span
                  >
                  <div class="overlay-control overlay-fit-buttons">
                    <button
                      type="button"
                      id="overlayFitModelBtn"
                      class="btn btn-sm btn-outline"
                      aria-label="Fit overlay to model XY bounds"
                    >
                      Fit to model
                    </button>
                    <button
                      type="button"
                      id="overlayCenterBtn"
                      class="btn btn-sm btn-outline"
                      aria-label="Center overlay under model"
                    >
                      Center
                    </button>
                  </div>
                  <!-- Unit toggle + Scale factor -->
                  <div class="overlay-control overlay-unit-row">
                    <label class="overlay-control-label" for="overlayUnitSelect"
                      >Unit</label
                    >
                    <select
                      id="overlayUnitSelect"
                      class="overlay-unit-select"
                      aria-label="Overlay dimension unit"
                    >
                      <option value="px">px</option>
                      <option value="mm" selected>mm</option>
                    </select>
                    <label class="overlay-scale-label" for="scaleFactorInput"
                      >Scale</label
                    >
                    <input
                      type="number"
                      id="scaleFactorInput"
                      class="overlay-scale-input"
                      min="0.01"
                      step="0.01"
                      placeholder="px/mm"
                      aria-label="Scale factor: pixels per millimeter"
                    />
                  </div>
                  <!-- Overlay Dimensions Display -->
                  <div
                    class="overlay-control overlay-dimensions-display"
                    id="overlayDimensionsDisplay"
                  >
                    <span class="overlay-control-label">Overlay size:</span>
                    <span
                      class="overlay-dimensions-value"
                      id="overlayDimensionsValue"
                      >-- &times; -- mm</span
                    >
                  </div>
                  <!-- Size Controls -->
                  <div class="overlay-control overlay-size-inputs">
                    <label class="overlay-control-label" id="overlaySizeLabel"
                      >Size (<span id="overlaySizeUnit">mm</span>)</label
                    >
                    <div class="overlay-size-row">
                      <label class="overlay-size-field">
                        <span class="sr-only">Width</span>
                        <input
                          type="number"
                          id="overlayWidthInput"
                          min="1"
                          max="1000"
                          step="1"
                          value="200"
                          aria-label="Overlay width in millimeters"
                        />
                        <span aria-hidden="true">W</span>
                      </label>
                      <button
                        type="button"
                        id="overlayAspectLockBtn"
                        class="btn-icon overlay-aspect-lock"
                        aria-pressed="true"
                        aria-label="Lock aspect ratio"
                        title="Lock aspect ratio"
                      >
                        🔗
                      </button>
                      <label class="overlay-size-field">
                        <span class="sr-only">Height</span>
                        <input
                          type="number"
                          id="overlayHeightInput"
                          min="1"
                          max="1000"
                          step="1"
                          value="150"
                          aria-label="Overlay height in millimeters"
                        />
                        <span aria-hidden="true">H</span>
                      </label>
                    </div>
                  </div>
                  <!-- Offset Controls -->
                  <div class="overlay-control overlay-offset-inputs">
                    <label class="overlay-control-label" id="overlayOffsetLabel"
                      >Offset (<span id="overlayOffsetUnit">mm</span>)</label
                    >
                    <div class="overlay-offset-row">
                      <label class="overlay-offset-field">
                        <span class="sr-only">X offset</span>
                        <input
                          type="number"
                          id="overlayOffsetXInput"
                          min="-500"
                          max="500"
                          step="1"
                          value="0"
                          aria-label="Overlay X offset in millimeters"
                        />
                        <span aria-hidden="true">X</span>
                      </label>
                      <label class="overlay-offset-field">
                        <span class="sr-only">Y offset</span>
                        <input
                          type="number"
                          id="overlayOffsetYInput"
                          min="-500"
                          max="500"
                          step="1"
                          value="0"
                          aria-label="Overlay Y offset in millimeters"
                        />
                        <span aria-hidden="true">Y</span>
                      </label>
                    </div>
                  </div>
                  <details class="overlay-advanced-details">
                    <summary class="overlay-advanced-summary">
                      More options
                    </summary>
                    <div class="overlay-advanced-controls">
                      <div class="overlay-control overlay-rotation-control">
                        <label
                          class="overlay-control-label"
                          for="overlayRotationInput"
                          id="overlayRotationLabel"
                        >
                          Rotation
                        </label>
                        <div class="slider-container">
                          <input
                            type="range"
                            id="overlayRotationInput"
                            min="-180"
                            max="180"
                            step="1"
                            value="0"
                            aria-labelledby="overlayRotationLabel"
                          />
                          <span class="slider-value" id="overlayRotationValue"
                            >0°</span
                          >
                        </div>
                      </div>
                    </div>
                  </details>
                </div>
              </details>
              </div><!-- end .tool-group (Measurement and Overlay) -->
              <!-- Design Tools panel removed: all features now in Design toolbar menu -->
              <!-- Display Options panel removed: toggles now in View toolbar menu -->
              <!-- Animation controls kept as standalone panel -->
              <details
                class="animation-panel forge-disclosure"
                id="animationPanel"
                role="region"
                aria-label="Animation controls"
              >
                <summary>
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    aria-hidden="true"
                  >
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                  <span class="forge-disclosure-title">Animation ($t)</span>
                </summary>
                <div class="animation-panel-body forge-disclosure-body">
                  <div class="anim-controls">
                    <div class="anim-controls-row">
                      <button
                        type="button"
                        class="btn btn-sm btn-outline anim-btn"
                        id="anim-play-btn"
                        aria-label="Play animation"
                      >
                        Play
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline anim-btn"
                        id="anim-step-btn"
                        aria-label="Step animation forward"
                      >
                        Step
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline anim-btn"
                        id="anim-reset-btn"
                        aria-label="Reset animation to start"
                      >
                        Reset
                      </button>
                    </div>
                    <div class="anim-controls-row">
                      <label for="anim-fps" class="anim-label">FPS</label>
                      <input
                        type="number"
                        id="anim-fps"
                        class="anim-input"
                        min="1"
                        max="30"
                        value="10"
                        aria-label="Animation frames per second"
                      />
                      <label for="anim-steps" class="anim-label">Steps</label>
                      <input
                        type="number"
                        id="anim-steps"
                        class="anim-input"
                        min="2"
                        max="1000"
                        value="100"
                        aria-label="Total animation steps"
                      />
                    </div>
                    <span
                      id="anim-t-value"
                      class="anim-t-display"
                      aria-live="off"
                      >$t = 0.000</span
                    >
                  </div>
                </div>
              </details>
              <!-- Library Controls -->
              <div
                class="library-controls hidden"
                id="libraryControls"
                role="region"
                aria-label="OpenSCAD library bundles"
                data-tutorial-target="library-controls"
              >
                <details class="library-details forge-disclosure">
                  <summary class="library-summary">
                    <svg
                      class="btn-icon-svg forge-disclosure-icon"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="square"
                      stroke-linejoin="miter"
                      aria-hidden="true"
                    >
                      <rect x="4" y="4" width="16" height="5" rx="0"></rect>
                      <rect x="4" y="10" width="16" height="5" rx="0"></rect>
                      <rect x="4" y="16" width="16" height="4" rx="0"></rect>
                    </svg>
                    <span class="forge-disclosure-title">Libraries</span>
                    <span class="library-badge" id="libraryBadge">0</span>
                  </summary>
                  <div class="library-content">
                    <p class="library-help">
                      Enable libraries used by this model:
                    </p>
                    <div class="library-list" id="libraryList">
                      <!-- Library checkboxes will be dynamically generated here -->
                    </div>
                    <div class="library-footer">
                      <button
                        id="libraryHelpBtn"
                        class="btn-link btn-link-with-icon"
                        aria-label="Learn more about libraries"
                      >
                        <svg
                          class="btn-icon-svg"
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="square"
                          stroke-linejoin="miter"
                          aria-hidden="true"
                        >
                          <circle cx="12" cy="12" r="10"></circle>
                          <line x1="12" y1="11" x2="12" y2="16"></line>
                          <circle
                            cx="12"
                            cy="7.5"
                            r="1"
                            fill="currentColor"
                            stroke="none"
                          ></circle>
                        </svg>
                        What are libraries?
                      </button>
                    </div>
                  </div>
                </details>
              </div>
              <!-- Companion Files Manager (for multi-file projects) -->
              <div
                class="project-files-controls hidden"
                id="projectFilesControls"
                role="region"
                aria-label="Companion files for this design"
              >
                <details class="project-files-details forge-disclosure">
                  <summary
                    class="project-files-summary"
                    data-tutorial-target="companion-files"
                  >
                    <svg
                      class="btn-icon-svg forge-disclosure-icon"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="square"
                      stroke-linejoin="miter"
                      aria-hidden="true"
                    >
                      <path
                        d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"
                      ></path>
                      <polyline points="14 2 14 8 20 8"></polyline>
                      <line x1="12" y1="18" x2="12" y2="12"></line>
                      <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    <span class="forge-disclosure-title">Companion Files</span>
                    <span class="project-files-badge" id="projectFilesBadge"
                      >0</span
                    >
                  </summary>
                  <div class="project-files-content">
                    <p class="project-files-help" id="projectFilesHelp">
                      Manage companion files used by this design:
                    </p>
                    <!-- Empty state shown when no companion files are present -->
                    <div class="companion-empty-state" id="companionEmptyState">
                      <p>
                        No companion files yet. Use <strong>Add File</strong> to
                        include <code>.txt</code>, <code>.svg</code>, or other
                        files your design needs.
                      </p>
                    </div>
                    <!-- Missing files warning with action button (dependency preflight check) -->
                    <div
                      class="project-files-warning hidden"
                      id="projectFilesWarning"
                      role="alert"
                    >
                      <div class="warning-content">
                        <span class="warning-icon" aria-hidden="true">⚠️</span>
                        <span class="warning-text" id="projectFilesWarningText"
                          >Some required files are missing</span
                        >
                      </div>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline btn-warning-action"
                        id="addMissingFilesBtn"
                        aria-label="Add the missing files to this project"
                      >
                        Add Missing Files...
                      </button>
                    </div>
                    <!-- File list -->
                    <div
                      class="project-files-list"
                      id="projectFilesList"
                      role="list"
                      aria-label="Project files"
                    >
                      <!-- Dynamically populated -->
                    </div>
                    <!-- Add file controls -->
                    <div class="project-files-actions">
                      <label
                        class="btn btn-sm btn-outline project-files-add-btn"
                        for="addCompanionFileInput"
                      >
                        <svg
                          class="btn-icon-svg"
                          width="14"
                          height="14"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add File
                        <input
                          type="file"
                          id="addCompanionFileInput"
                          class="sr-only"
                          accept=".txt,.scad,.svg,.json,.csv"
                          multiple
                        />
                      </label>
                    </div>
                    <div class="project-files-footer">
                      <p class="project-files-hint">
                        Add .txt, .scad, .svg, or other files referenced by your
                        model
                      </p>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline companion-save-btn hidden"
                        id="companionSaveBtn"
                        aria-label="Save companion files to this project"
                      >
                        Save as Project
                      </button>
                    </div>
                  </div>
                </details>
              </div>
              <!-- Advanced Menu -->
              <details class="advanced-menu forge-disclosure" id="advancedMenu">
                <summary class="advanced-menu-summary">
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="square"
                    stroke-linejoin="miter"
                    aria-hidden="true"
                  >
                    <line x1="4" y1="6" x2="20" y2="6"></line>
                    <line x1="4" y1="12" x2="20" y2="12"></line>
                    <line x1="4" y1="18" x2="20" y2="18"></line>
                    <rect x="8" y="4" width="4" height="4" rx="0"></rect>
                    <rect x="12" y="10" width="4" height="4" rx="0"></rect>
                    <rect x="6" y="16" width="4" height="4" rx="0"></rect>
                  </svg>
                  <span class="forge-disclosure-title">Advanced</span>
                </summary>
                <div class="advanced-menu-content">
                  <!-- View SCAD Source -->
                  <div class="advanced-section">
                    <button
                      id="viewSourceBtn"
                      class="btn btn-sm btn-outline advanced-btn"
                      aria-label="View OpenSCAD source code"
                    >
                      📄 View Source
                    </button>
                    <button
                      id="copySourceBtn"
                      class="btn btn-sm btn-outline advanced-btn"
                      aria-label="Copy source code to clipboard"
                    >
                      📋 Copy Source
                    </button>
                  </div>
                  <!-- Parameter Limits Override -->
                  <div class="advanced-section">
                    <label class="advanced-toggle">
                      <input type="checkbox" id="unlockLimitsToggle" />
                      <span>🔓 Unlock Parameter Limits</span>
                    </label>
                    <p class="advanced-hint">
                      Allow values outside parsed min/max ranges
                    </p>
                  </div>
                  <!-- Reset Tools -->
                  <div class="advanced-section">
                    <h4 class="advanced-section-title">Reset Tools</h4>
                    <div class="reset-tools">
                      <button
                        id="resetGroupBtn"
                        class="btn btn-sm btn-outline"
                        aria-label="Reset current group to defaults"
                      >
                        📁 Reset Group
                      </button>
                    </div>
                    <div
                      class="reset-group-selector hidden"
                      id="resetGroupSelector"
                    >
                      <label for="resetGroupSelect">Select group:</label>
                      <select id="resetGroupSelect" class="reset-group-select">
                        <!-- Groups will be populated dynamically -->
                      </select>
                      <button
                        id="confirmResetGroupBtn"
                        class="btn btn-sm btn-primary"
                      >
                        Reset
                      </button>
                    </div>
                  </div>
                  <!-- Raw Parameter JSON -->
                  <div class="advanced-section">
                    <button
                      id="viewParamsJsonBtn"
                      class="btn btn-sm btn-outline advanced-btn"
                      aria-label="View current parameters as JSON"
                    >
                      { } View Params JSON
                    </button>
                  </div>
                  <!-- Export Changed Settings (troubleshooting support) -->
                  <div class="advanced-section">
                    <h4 class="advanced-section-title">Troubleshooting</h4>
                    <button
                      id="exportChangedBtn"
                      class="btn btn-sm btn-outline advanced-btn"
                      aria-label="Export only changed parameters for troubleshooting"
                    >
                      📋 Export Changed Settings
                    </button>
                    <p class="advanced-hint">
                      Download only non-default parameters (useful for support
                      requests)
                    </p>
                  </div>
                  <div
                    id="uiPrefsPanel"
                    class="advanced-section ui-prefs-panel"
                  ></div>
                </div>
              </details>
              <!-- Preset Controls -->
              <details
                class="preset-controls forge-disclosure"
                id="presetControls"
                role="region"
                aria-label="Parameter presets"
                data-tutorial-target="preset-controls"
              >
                <summary class="preset-summary">
                  <svg
                    class="btn-icon-svg forge-disclosure-icon"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="square"
                    stroke-linejoin="miter"
                    aria-hidden="true"
                  >
                    <rect x="4" y="4" width="16" height="16" rx="0"></rect>
                    <rect x="7" y="4" width="10" height="6" rx="0"></rect>
                    <rect x="8" y="14" width="8" height="6" rx="0"></rect>
                    <line x1="16" y1="7" x2="16" y2="9"></line>
                  </svg>
                  <span class="forge-disclosure-title">Presets</span>
                </summary>
                <div class="preset-content">
                  <!-- Legacy: search input (hidden when searchable_combobox flag is on) -->
                  <div class="preset-search" id="presetSearchLegacy">
                    <label for="presetSearchInput" class="sr-only"
                      >Search presets</label
                    ><input
                      type="text"
                      id="presetSearchInput"
                      class="preset-search-input"
                      placeholder="Search presets..."
                      aria-describedby="presetSearchStatus"
                    /><button
                      id="presetSearchClear"
                      class="btn-icon btn-icon-sm preset-search-clear"
                      aria-label="Clear search"
                      hidden
                    >
                      &times;
                    </button>
                    <div
                      id="presetSearchStatus"
                      class="sr-only"
                      role="status"
                      aria-live="polite"
                    ></div>
                  </div>
                  <div class="preset-sort-toolbar" id="presetSortToolbar">
                    <label for="presetDropdownSort" class="preset-sort-label"
                      >Sort</label
                    >
                    <select
                      id="presetDropdownSort"
                      class="preset-sort-select"
                      aria-label="Sort presets by"
                    >
                      <option value="name-asc">Name (A–Z)</option>
                      <option value="name-desc">Name (Z–A)</option>
                      <option value="date-created">Date created</option>
                      <option value="date-modified">Date modified</option>
                    </select>
                  </div>
                  <!-- Searchable combobox (shown when searchable_combobox flag is on) -->
                  <div
                    id="presetComboboxContainer"
                    class="preset-combobox-container"
                    hidden
                  >
                    <label for="presetComboboxInput" class="sr-only"
                      >Select preset</label
                    >
                    <!-- initSearchableCombobox() populates this container -->
                  </div>
                  <!-- Legacy: native select (hidden when searchable_combobox flag is on) -->
                  <div class="preset-selector" id="presetSelector">
                    <label for="presetSelect" class="preset-label sr-only"
                      >Select preset</label
                    >
                    <select
                      id="presetSelect"
                      class="preset-select"
                      aria-label="Select a saved preset to load"
                    >
                      <option value="">-- Select Preset --</option>
                    </select>
                    <!-- OpenSCAD Customizer-style preset controls: Save, Add, Delete -->
                  </div>
                  <div class="preset-actions-row">
                    <div
                      class="preset-actions-group"
                      role="group"
                      aria-label="Preset management"
                    >
                      <button
                        id="savePresetBtn"
                        class="btn btn-sm btn-icon"
                        aria-label="Save Preset — overwrites current preset"
                        title="Save Preset — overwrites current preset"
                        disabled
                      >
                        💾
                      </button>
                      <button
                        id="addPresetBtn"
                        class="btn btn-sm btn-icon"
                        aria-label="Add Preset"
                        title="Add Preset"
                      >
                        +
                      </button>
                      <button
                        id="deletePresetBtn"
                        class="btn btn-sm btn-icon btn-danger-icon"
                        aria-label="Delete current preset"
                        title="Delete current preset"
                        disabled
                      >
                        −
                      </button>
                    </div>
                    <button
                      id="managePresetsBtn"
                      class="btn btn-sm btn-outline"
                      aria-label="Import and export presets"
                      title="Import and export presets"
                    >
                      📋 Import / Export
                    </button>
                  </div>
                </div>
              </details>
              <div class="customizer-header-row">
                <label class="customizer-header-control" for="autoPreviewToggle"
                  ><input type="checkbox" id="autoPreviewToggle" /> Automatic
                  Preview</label
                ><label for="paramDetailLevel" class="sr-only"
                  >Show Details</label
                ><select
                  id="paramDetailLevel"
                  class="customizer-header-select"
                  aria-label="Parameter detail level"
                >
                  <option value="show">Show Details</option>
                  <option value="inline">Inline Details</option>
                  <option value="hide" selected>Hide Details</option>
                  <option value="desc-only">Description Only</option></select
                ><button
                  id="resetAllBtn"
                  class="btn btn-sm btn-outline"
                  aria-label="Reset all parameters to defaults"
                  title="Reset all parameters to defaults"
                >
                  Reset All
                </button>
              </div>
              <!-- Parameter Search and Navigation (C2: Cognitive load reduction) -->
              <div class="param-search-section" id="paramSearchSection">
                <div class="param-search-row">
                  <div class="param-search-input-wrapper">
                    <label for="paramSearchInput" class="sr-only"
                      >Search parameters</label
                    >
                    <input
                      type="search"
                      id="paramSearchInput"
                      class="param-search-input"
                      placeholder="Search parameters..."
                      aria-label="Search parameters by name or description"
                      autocomplete="off"
                    />
                    <button
                      type="button"
                      id="clearParamSearchBtn"
                      class="param-search-clear hidden"
                      aria-label="Clear search"
                    >
                      ×
                    </button>
                  </div>
                  <div class="param-jump-wrapper">
                    <label for="paramJumpSelect" class="sr-only"
                      >Jump to group</label
                    >
                    <select
                      id="paramJumpSelect"
                      class="param-jump-select"
                      aria-label="Jump to parameter group"
                    >
                      <option value="">Jump to group...</option>
                    </select>
                  </div>
                </div>
                <div
                  class="param-filter-stats hidden"
                  id="paramFilterStats"
                  aria-live="polite"
                >
                  <span id="paramFilterCount">0</span> parameters shown
                  <button type="button" id="showAllParamsBtn" class="btn-link">
                    Show all
                  </button>
                </div>
              </div>
              <div
                id="parametersContainer"
                class="parameters-container"
                aria-labelledby="parameters-heading"
                data-tutorial-target="parameters-container"
              >
                <!-- Parameters will be dynamically generated here -->
              </div>
              <!-- Output Format Selector -->
              <div
                class="output-format-section"
                aria-label="Output format selection"
              >
                <label for="outputFormat" class="output-format-label"
                  >Output:</label
                >
                <select
                  id="outputFormat"
                  class="output-format-select"
                  aria-label="Select output file format"
                  data-tutorial-target="output-format"
                >
                  <optgroup label="3D Printing">
                    <option value="stl" selected>
                      STL - 3D Printing (Binary)
                    </option>
                    <option value="obj">OBJ - Wavefront (Text)</option>
                    <option value="off">OFF - Object File Format</option>
                    <option value="amf">AMF - Additive Manufacturing</option>
                    <option value="3mf">3MF - 3D Manufacturing</option>
                  </optgroup>
                  <optgroup label="Laser Cutting / 2D">
                    <option value="svg">SVG - Vector Graphics</option>
                    <option value="dxf">DXF - CAD / Laser</option>
                  </optgroup>
                </select>
                <span
                  class="output-format-info"
                  id="formatInfo"
                  aria-live="polite"
                >
                  Most common format for 3D printing
                </span>
                <!-- 2D Format Guidance (shown when SVG/DXF selected) -->
                <div
                  class="format-2d-guidance hidden"
                  id="format2dGuidance"
                  role="alert"
                  aria-live="polite"
                >
                  <p class="guidance-title">📐 2D Export Guidance</p>
                  <p class="guidance-text">
                    For laser cutting, ensure your model uses
                    <code>projection()</code> or set the
                    <code>generate</code> parameter to
                    <strong>"first layer for SVG/DXF file"</strong>.
                  </p>
                  <details class="guidance-details">
                    <summary>More info for laser-cut keyguard users</summary>
                    <ul>
                      <li>
                        Set <code>type_of_keyguard</code> to
                        <strong>"Laser-Cut"</strong>
                      </li>
                      <li>
                        Set <code>generate</code> to
                        <strong>"first layer for SVG/DXF file"</strong>
                      </li>
                      <li>Not all 3D models support 2D export</li>
                    </ul>
                  </details>
                </div>
              </div>
            </div>
            <!-- Expert Mode Panel (M2) - Code editor interface -->
            <div
              class="expert-mode-panel"
              id="expertModePanel"
              role="region"
              aria-label="OpenSCAD code editor"
              aria-live="polite"
            >
              <div class="expert-mode-header">
                <span class="expert-mode-title">
                  <span aria-hidden="true">{ }</span> OpenSCAD Code
                  <span
                    class="editor-dirty-indicator"
                    id="editorDirtyIndicator"
                    aria-label="Unsaved changes"
                  ></span>
                </span>
                <div class="expert-mode-actions">
                  <button
                    id="expertRunPreviewBtn"
                    class="btn btn-sm btn-primary"
                    aria-label="Run preview (Ctrl+Enter)"
                    title="Preview (Ctrl+Enter)"
                  >
                    ▶ Preview
                  </button>
                  <button
                    id="expertModeCloseBtn"
                    class="btn btn-sm btn-outline"
                    aria-label="Exit Expert Mode"
                  >
                    Exit Code Mode
                  </button>
                </div>
              </div>
              <div class="expert-mode-body" id="expertModeBody">
                <!-- Editor will be inserted here by JavaScript (Monaco or Textarea) -->
              </div>
            </div>
          </div>
          <div
            class="preview-panel"
            id="previewPanel"
            role="region"
            aria-label="3D preview and actions"
          >
            <!-- Scrollable content wrapper with vertical split -->
            <div class="preview-content" id="previewContent">
              <!-- Top section: Preview settings, status, stats, dimensions -->
              <div class="preview-info-section" id="previewInfoSection">
                <!-- Drawer toggle header with mobile params button -->
                <div class="preview-drawer-header">
                  <div class="preview-drawer-header-left">
                    <!-- Parameters button FIRST (left position) -->
                    <button
                      id="mobileDrawerToggle"
                      class="btn btn-sm btn-icon mobile-only"
                      aria-expanded="false"
                      aria-controls="paramPanel"
                      aria-label="Open parameters panel"
                      title="Parameters"
                      data-tutorial-target="mobile-drawer-toggle"
                    >
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        aria-hidden="true"
                      >
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                      </svg>
                      <span class="btn-label">Params</span>
                    </button>
                    <!-- Preview Settings button SECOND (right of Parameters) -->
                    <button
                      id="previewDrawerToggle"
                      class="btn btn-sm btn-icon btn-collapse-panel preview-drawer-toggle-btn forge-control"
                      aria-expanded="false"
                      aria-controls="previewInfoContent"
                      aria-label="Expand preview settings and model info"
                      title="Preview Settings &amp; Info"
                      data-tutorial-target="preview-drawer-toggle"
                    >
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        aria-hidden="true"
                      >
                        <polyline points="13 6 7 12 13 18"></polyline>
                        <line
                          x1="17"
                          y1="4"
                          x2="17"
                          y2="20"
                          stroke-width="2"
                        ></line>
                      </svg>
                    </button>
                    <h2
                      class="preview-drawer-title"
                      id="preview-settings-heading"
                    >
                      Preview Settings &amp; Info
                    </h2>
                  </div>
                  <div class="preview-drawer-header-right">
                    <!-- Empty or future controls -->
                  </div>
                </div>
                <!-- Collapsible content -->
                <div
                  class="preview-info-content"
                  id="previewInfoContent"
                  role="region"
                  aria-labelledby="preview-settings-heading"
                >
                  <div
                    class="status-area"
                    id="statusArea"
                    role="status"
                    aria-live="polite"
                    aria-label="Application status"
                  >
                    Ready
                  </div>
                  <!-- Dedicated screen reader announcer (separate from visible status) -->
                  <div
                    id="srAnnouncer"
                    class="sr-only"
                    aria-live="polite"
                    aria-atomic="true"
                  ></div>
                  <!-- Assertive announcer for errors and critical warnings -->
                  <div
                    id="srAnnouncerAssertive"
                    class="sr-only"
                    aria-live="assertive"
                    aria-atomic="true"
                  ></div>
                  <div
                    class="preview-settings-panel"
                    aria-label="Preview settings"
                  >
                    <div class="preview-settings-header">
                      <span class="settings-icon" aria-hidden="true">
                        <svg
                          class="btn-icon-svg"
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="square"
                          stroke-linejoin="miter"
                        >
                          <line x1="4" y1="6" x2="20" y2="6"></line>
                          <line x1="4" y1="12" x2="20" y2="12"></line>
                          <line x1="4" y1="18" x2="20" y2="18"></line>
                          <rect x="8" y="4" width="4" height="4" rx="0"></rect>
                          <rect
                            x="12"
                            y="10"
                            width="4"
                            height="4"
                            rx="0"
                          ></rect>
                          <rect x="6" y="16" width="4" height="4" rx="0"></rect>
                        </svg>
                      </span>
                      <span>Preview Settings</span>
                    </div>
                    <div class="preview-settings">
                      <label class="preview-setting">
                        <input
                          type="checkbox"
                          id="measurementsToggle"
                          aria-describedby="measurementsHelp"
                        />
                        <span>Show measurements</span>
                      </label>
                      <span id="measurementsHelp" class="sr-only"
                        >Toggle dimension measurements and bounding box overlay
                        on 3D preview</span
                      >
                      <label class="preview-setting">
                        <input
                          type="checkbox"
                          id="gridToggle"
                          checked
                          aria-describedby="gridHelp"
                        />
                        <span>Show grid</span>
                      </label>
                      <span id="gridHelp" class="sr-only"
                        >Toggle grid plane visibility in 3D preview</span
                      >
                      <label class="preview-setting">
                        <input
                          type="checkbox"
                          id="autoBedToggle"
                          checked
                          aria-describedby="autoBedHelp"
                        />
                        <span>Auto-bed (Z=0)</span>
                      </label>
                      <span id="autoBedHelp" class="sr-only"
                        >Automatically place models on the build plate at Z
                        equals zero</span
                      >
                      <div
                        class="preview-setting-group"
                        role="group"
                        aria-labelledby="gridSizeLabel"
                      >
                        <span
                          id="gridSizeLabel"
                          class="preview-setting-group-label"
                          >Grid size</span
                        >
                        <label class="preview-setting-inline">
                          <span>Preset</span>
                          <select
                            id="gridPresetSelect"
                            aria-label="Printer bed preset"
                          >
                            <option value="220x220">
                              220 x 220 mm (Ender 3)
                            </option>
                            <option value="256x256">
                              256 x 256 mm (Prusa MK4)
                            </option>
                            <option value="235x235">
                              235 x 235 mm (Ender 3 V2)
                            </option>
                            <option value="300x300">
                              300 x 300 mm (CR-10)
                            </option>
                            <option value="350x350">
                              350 x 350 mm (Large format)
                            </option>
                            <option value="custom">Custom...</option>
                          </select>
                        </label>
                        <label class="preview-setting-inline">
                          <span>Width (mm)</span>
                          <input
                            type="number"
                            id="gridWidthInput"
                            min="50"
                            max="500"
                            value="220"
                            aria-describedby="gridSizeHelp"
                          />
                        </label>
                        <label class="preview-setting-inline">
                          <span>Height (mm)</span>
                          <input
                            type="number"
                            id="gridHeightInput"
                            min="50"
                            max="500"
                            value="220"
                          />
                        </label>
                        <span id="gridSizeHelp" class="sr-only"
                          >Enter printer bed dimensions in millimetres to set
                          the grid size</span
                        >
                        <!-- Save custom grid preset row -->
                        <div
                          class="grid-preset-save-row"
                          id="gridPresetSaveRow"
                          hidden
                        >
                          <label for="gridPresetNameInput" class="sr-only"
                            >Custom preset name</label
                          >
                          <input
                            type="text"
                            id="gridPresetNameInput"
                            class="grid-preset-name-input"
                            placeholder="Preset name…"
                            maxlength="80"
                            aria-describedby="gridPresetSaveError"
                          />
                          <button
                            type="button"
                            id="saveGridPresetBtn"
                            class="btn btn-sm btn-primary"
                            aria-label="Save custom grid size preset"
                          >
                            Save
                          </button>
                          <span
                            id="gridPresetSaveError"
                            class="grid-preset-error"
                            role="alert"
                            aria-live="polite"
                          ></span>
                        </div>
                        <!-- User custom grid presets delete toolbar (shown when user presets exist) -->
                        <div
                          class="grid-preset-delete-row"
                          id="gridPresetDeleteRow"
                          hidden
                        >
                          <button
                            type="button"
                            id="deleteGridPresetBtn"
                            class="btn btn-sm btn-outline btn-danger-outline"
                            aria-label="Delete selected custom grid preset"
                          >
                            Delete preset
                          </button>
                        </div>
                      </div>
                      <label class="preview-setting">
                        <input
                          type="checkbox"
                          id="statusBarToggle"
                          checked
                          aria-describedby="statusBarHelp"
                        />
                        <span>Show status bar</span>
                      </label>
                      <span id="statusBarHelp" class="sr-only"
                        >Toggle status and render info overlay on preview</span
                      >
                      <!-- Engine Toggle (Manifold vs CGAL) -->
                      <div
                        class="preview-setting-divider"
                        aria-hidden="true"
                      ></div>
                      <label class="preview-setting">
                        <input
                          type="checkbox"
                          id="manifoldEngineToggle"
                          checked
                          aria-describedby="manifoldEngineHelp"
                        />
                        <span>Fast engine (Manifold)</span>
                      </label>
                      <span id="manifoldEngineHelp" class="sr-only"
                        >Use Manifold geometry engine for faster rendering.
                        Disable if you encounter issues with complex
                        models.</span
                      >
                      <p class="preview-setting-hint" id="manifoldEngineHint">
                        5-30× faster. Disable if models fail to render.
                      </p>
                      <div class="preview-setting rotation-speed-setting">
                        <label
                          class="preview-setting-label"
                          for="rotationSpeedInput"
                          id="rotationSpeedLabel"
                          >Auto-rotate speed</label
                        >
                        <div class="slider-container">
                          <input
                            type="range"
                            id="rotationSpeedInput"
                            min="0.1"
                            max="3"
                            step="0.1"
                            value="0.5"
                            aria-labelledby="rotationSpeedLabel"
                            aria-describedby="rotationSpeedHelp"
                            aria-valuemin="0.1"
                            aria-valuemax="3"
                            aria-valuenow="0.5"
                          />
                          <span class="slider-value" id="rotationSpeedValue"
                            >0.5°/s</span
                          >
                        </div>
                      </div>
                      <span id="rotationSpeedHelp" class="sr-only"
                        >Set the speed of automatic model rotation when
                        auto-rotate is enabled, from 0.1 to 3 degrees per
                        second</span
                      >
                      <label class="preview-setting" for="previewQualitySelect">
                        <span class="preview-setting-label"
                          >Preview quality</span
                        >
                        <select
                          id="previewQualitySelect"
                          aria-label="Select preview quality"
                        >
                          <option value="auto">Auto (adaptive)</option>
                          <option value="fidelity">Fidelity (slower)</option>
                          <option value="balanced" selected>
                            Balanced (~50%)
                          </option>
                          <option value="fast">Fast (lower resolution)</option>
                        </select>
                      </label>
                      <label class="preview-setting" for="exportQualitySelect">
                        <span class="preview-setting-label"
                          >Export quality</span
                        >
                        <select
                          id="exportQualitySelect"
                          aria-label="Select export quality"
                        >
                          <option value="model" selected>Model default</option>
                          <option value="low">Low (fast)</option>
                          <option value="medium">Medium (balanced)</option>
                          <option value="high">High (smooth)</option>
                        </select>
                      </label>
                      <div class="preview-setting cache-tools">
                        <span class="preview-setting-label">App cache</span>
                        <button
                          id="clearCacheBtn"
                          class="btn btn-sm btn-outline"
                          aria-label="Clear cached files and reload the app"
                        >
                          Clear cache &amp; reload
                        </button>
                      </div>
                      <div
                        class="preview-setting complexity-indicator"
                        id="complexityIndicator"
                        title="Detected model complexity tier"
                      >
                        <span class="preview-setting-label">Complexity:</span>
                        <span
                          id="complexityTierLabel"
                          class="complexity-tier-label"
                          >Analyzing...</span
                        >
                      </div>
                      <div class="preview-setting model-color-setting">
                        <span class="preview-setting-label">Model Color</span>
                        <div class="model-color-picker">
                          <input
                            type="color"
                            id="modelColorPicker"
                            value="#2196F3"
                            aria-label="Choose model display color"
                          />
                          <button
                            id="modelColorReset"
                            class="btn-icon"
                            title="Reset to theme default"
                            aria-label="Reset color to theme default"
                          >
                            ↺
                          </button>
                        </div>
                      </div>
                      <div
                        class="preview-setting-divider"
                        aria-hidden="true"
                      ></div>
                      <span
                        class="preview-settings-subheading"
                        id="modelAppearanceHeading"
                        >Model Appearance</span
                      >
                      <!-- Model Opacity -->
                      <div class="preview-setting model-opacity-setting">
                        <label for="modelOpacityInput" id="modelOpacityLabel"
                          >Model opacity</label
                        >
                        <div class="slider-container">
                          <input
                            type="range"
                            id="modelOpacityInput"
                            min="10"
                            max="100"
                            step="5"
                            value="100"
                            aria-labelledby="modelOpacityLabel"
                            aria-describedby="modelOpacityHelp"
                          />
                          <span class="slider-value" id="modelOpacityValue"
                            >100%</span
                          >
                        </div>
                      </div>
                      <span id="modelOpacityHelp" class="sr-only"
                        >Reduce model opacity to see the reference overlay image
                        behind the 3D model. Useful for alignment.</span
                      >
                      <!-- Brightness -->
                      <div class="preview-setting brightness-setting">
                        <label for="brightnessInput" id="brightnessLabel"
                          >Brightness</label
                        >
                        <div class="slider-container">
                          <input
                            type="range"
                            id="brightnessInput"
                            min="20"
                            max="200"
                            step="5"
                            value="100"
                            aria-labelledby="brightnessLabel"
                            aria-describedby="brightnessHelp"
                          />
                          <span class="slider-value" id="brightnessValue"
                            >100%</span
                          >
                        </div>
                      </div>
                      <span id="brightnessHelp" class="sr-only"
                        >Adjust overall scene brightness from 20 to 200
                        percent</span
                      >
                      <!-- Contrast -->
                      <div class="preview-setting contrast-setting">
                        <label for="contrastInput" id="contrastLabel"
                          >Contrast</label
                        >
                        <div class="slider-container">
                          <input
                            type="range"
                            id="contrastInput"
                            min="20"
                            max="200"
                            step="5"
                            value="100"
                            aria-labelledby="contrastLabel"
                            aria-describedby="contrastHelp"
                          />
                          <span class="slider-value" id="contrastValue"
                            >100%</span
                          >
                        </div>
                      </div>
                      <span id="contrastHelp" class="sr-only"
                        >Adjust lighting contrast from flat to dramatic, 20 to
                        200 percent</span
                      >
                      <!-- Reset button -->
                      <div class="preview-setting">
                        <button
                          type="button"
                          id="resetAppearanceBtn"
                          class="btn btn-sm btn-outline"
                          aria-label="Reset model opacity, brightness, and contrast to defaults"
                        >
                          Reset appearance
                        </button>
                      </div>
                    </div>
                  </div>
                  <div
                    class="stats"
                    id="stats"
                    role="status"
                    aria-live="polite"
                  ></div>
                  <div
                    class="dimensions-display hidden"
                    id="dimensionsDisplay"
                    role="region"
                    aria-label="Model dimensions"
                  >
                    <h3 class="dimensions-heading">Dimensions</h3>
                    <dl class="dimensions-list">
                      <div class="dimension-item">
                        <dt>Width (X):</dt>
                        <dd id="dimX">--</dd>
                      </div>
                      <div class="dimension-item">
                        <dt>Depth (Y):</dt>
                        <dd id="dimY">--</dd>
                      </div>
                      <div class="dimension-item">
                        <dt>Height (Z):</dt>
                        <dd id="dimZ">--</dd>
                      </div>
                      <div class="dimension-item">
                        <dt>Volume:</dt>
                        <dd id="dimVolume">--</dd>
                      </div>
                    </dl>
                  </div>
                </div>
              </div>
              <!-- Bottom section: 3D preview canvas -->
              <div class="preview-canvas-section" id="previewCanvasSection">
                <div
                  class="preview-container"
                  id="previewContainer"
                  role="group"
                  aria-label="3D model preview and controls"
                  aria-describedby="previewModelSummary"
                  tabindex="0"
                  data-tutorial-target="preview-container"
                >
                  <!-- 3D preview or placeholder -->
                  <div class="preview-placeholder">
                    <p>3D preview will appear here after generating STL</p>
                  </div>
                  <!-- Screen reader accessible model summary (WCAG 2.2 non-visual content) -->
                  <div
                    id="previewModelSummary"
                    class="sr-only"
                    aria-live="polite"
                    aria-atomic="true"
                  >
                    No model loaded. Upload an OpenSCAD file and generate an STL
                    to see the 3D preview.
                  </div>
                </div>
                <!-- Status bar overlay at bottom of preview -->
                <div
                  class="preview-status-bar idle no-stats"
                  id="previewStatusBar"
                  role="status"
                  aria-live="polite"
                >
                  <span class="preview-status-text" id="previewStatusText"
                    >Ready</span
                  >
                  <span
                    class="preview-status-divider"
                    aria-hidden="true"
                  ></span>
                  <span
                    class="preview-status-stats"
                    id="previewStatusStats"
                  ></span>
                  <!-- Memory usage indicator -->
                  <span
                    class="memory-indicator hidden"
                    id="memoryIndicator"
                    role="status"
                    aria-live="polite"
                  >
                    <span class="memory-icon" aria-hidden="true">💾</span>
                    <span class="memory-text" id="memoryText">--</span>
                    <span
                      class="memory-bar"
                      id="memoryBar"
                      role="progressbar"
                      aria-valuemin="0"
                      aria-valuemax="100"
                      aria-valuenow="0"
                    >
                      <span class="memory-bar-fill" id="memoryBarFill"></span>
                    </span>
                  </span>
                  <!-- Alt adjust info (visible only in mono variant when alt view is enabled) -->
                  <span
                    class="preview-status-alt-adjust"
                    id="previewStatusAltAdjust"
                  ></span>
                </div>
                <!-- ECHO message drawer (console output display) -->
                <div class="echo-drawer collapsed" id="echoDrawer">
                  <button
                    class="echo-drawer-toggle forge-control--sm"
                    id="echoDrawerToggle"
                    type="button"
                    aria-expanded="false"
                    aria-controls="echoDrawerContent"
                    aria-label="Toggle echo messages panel"
                  >
                    <span class="echo-drawer-label" id="echoDrawerLabel"
                      >No echo messages</span
                    >
                    <svg
                      class="echo-drawer-arrow"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                  <div
                    class="echo-drawer-content"
                    id="echoDrawerContent"
                    role="region"
                    aria-label="Messages from OpenSCAD"
                  >
                    <pre class="echo-messages" id="echoMessages"></pre>
                    <button
                      class="echo-view-console btn btn-sm btn-secondary"
                      id="echoViewConsoleBtn"
                      type="button"
                    >
                      View Full Console
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <!-- Actions bar with collapsible drawer and fixed primary action -->
            <div
              class="actions-bar"
              id="actionsBar"
              role="toolbar"
              aria-label="Model actions"
            >
              <!-- Actions Drawer (collapsible, left side) -->
              <div
                class="actions-drawer collapsed"
                id="actionsDrawer"
                role="region"
                aria-labelledby="actions-drawer-title"
              >
                <!-- Drawer header with toggle button and title -->
                <div
                  class="actions-drawer-header"
                  data-tutorial-target="actions-drawer-toggle"
                >
                  <button
                    id="actionsDrawerToggle"
                    class="btn btn-sm btn-icon btn-collapse-panel actions-drawer-toggle-btn forge-control"
                    aria-expanded="false"
                    aria-controls="actionsDrawerBody"
                    aria-label="Expand actions menu"
                    title="More Actions"
                  >
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polyline points="13 6 7 12 13 18"></polyline>
                      <line
                        x1="17"
                        y1="4"
                        x2="17"
                        y2="20"
                        stroke-width="2"
                      ></line>
                    </svg>
                  </button>
                  <h2 class="actions-drawer-title" id="actions-drawer-title">
                    Actions
                  </h2>
                </div>
                <!-- Drawer body (expandable content) -->
                <div class="actions-drawer-body" id="actionsDrawerBody">
                  <button
                    id="addToComparisonBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="Add current configuration to comparison"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <rect x="3" y="3" width="7" height="18" rx="1"></rect>
                      <rect x="14" y="3" width="7" height="18" rx="1"></rect>
                    </svg>
                    <span class="btn-text">Compare</span>
                  </button>
                  <span
                    class="actions-drawer-divider"
                    aria-hidden="true"
                  ></span>
                  <button
                    id="addToQueueBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="Add current configuration to render queue"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                      <path d="M12 8v8"></path>
                      <path d="M8 12h8"></path>
                    </svg>
                    <span class="btn-text">Add to Queue</span>
                  </button>
                  <button
                    id="viewQueueBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="View and manage render queue"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path d="M4 6h16"></path>
                      <path d="M4 12h16"></path>
                      <path d="M4 18h16"></path>
                    </svg>
                    <span class="btn-text">Queue</span>
                    <span class="queue-badge" id="queueBadge">0</span>
                  </button>
                  <span
                    class="actions-drawer-divider"
                    aria-hidden="true"
                  ></span>
                  <button
                    id="shareBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="Copy shareable link with current parameters"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path
                        d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"
                      ></path>
                      <path
                        d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                      ></path>
                    </svg>
                    <span class="btn-text">Share Link</span>
                  </button>
                  <button
                    id="exportParamsBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="Download parameters as JSON file"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path
                        d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"
                      ></path>
                      <polyline points="7 10 12 15 17 10"></polyline>
                      <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <span class="btn-text">Export Params</span>
                  </button>
                  <button
                    id="publishProjectBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="Generate a shareable manifest for hosting this project externally"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <circle cx="18" cy="5" r="3"></circle>
                      <circle cx="6" cy="12" r="3"></circle>
                      <circle cx="18" cy="19" r="3"></circle>
                      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    <span class="btn-text">Publish</span>
                  </button>
                  <span
                    class="actions-drawer-divider"
                    aria-hidden="true"
                  ></span>
                  <button
                    id="viewConsoleBtn"
                    class="btn btn-sm btn-secondary actions-drawer-btn"
                    aria-label="View OpenSCAD console output including echo statements"
                  >
                    <svg
                      class="btn-icon-svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <rect x="2" y="3" width="20" height="18" rx="2"></rect>
                      <line x1="6" y1="8" x2="6" y2="8"></line>
                      <line x1="10" y1="8" x2="18" y2="8"></line>
                      <line x1="6" y1="12" x2="6" y2="12"></line>
                      <line x1="10" y1="12" x2="18" y2="12"></line>
                      <line x1="6" y1="16" x2="6" y2="16"></line>
                      <line x1="10" y1="16" x2="14" y2="16"></line>
                    </svg>
                    <span class="btn-text">Console</span>
                    <span
                      class="console-badge hidden"
                      id="consoleBadge"
                      aria-label="New console output available"
                      >!</span
                    >
                  </button>
                </div>
              </div>
              <!-- Primary actions (always visible, right side) -->
              <div class="actions-primary">
                <button
                  id="cancelRenderBtn"
                  class="btn btn-outline hidden"
                  aria-label="Cancel current render operation"
                >
                  <svg
                    class="btn-icon-svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <rect x="3" y="3" width="18" height="18" rx="2"></rect>
                  </svg>
                  <span>Cancel</span>
                </button>
                <button
                  id="primaryActionBtn"
                  class="btn btn-primary btn-large"
                  aria-label="Generate output file from current parameters"
                  data-action="generate"
                  data-tutorial-target="primary-action"
                >
                  Generate
                </button>
                <a
                  id="downloadFallbackLink"
                  href="#"
                  class="btn btn-sm btn-outline hidden"
                  aria-label="Download previously generated file"
                >
                  <svg
                    class="btn-icon-svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  <span>Download last file</span>
                </a>
              </div>
              <!-- Mobile Camera Controls Drawer (visible only on mobile) -->
              <div
                class="camera-drawer collapsed"
                id="cameraDrawer"
                role="region"
                aria-label="Camera controls"
              >
                <!-- Drawer toggle button -->
                <button
                  id="cameraDrawerToggle"
                  class="btn btn-sm camera-drawer-toggle-btn forge-control"
                  aria-expanded="false"
                  aria-controls="cameraDrawerBody"
                  aria-label="Expand camera controls"
                  title="Camera Controls"
                  data-tutorial-target="mobile-camera-drawer-toggle"
                >
                  <svg
                    class="camera-drawer-icon"
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <polyline
                      class="drawer-chevron"
                      points="6 9 12 15 18 9"
                    ></polyline>
                  </svg>
                  <span class="camera-drawer-label">Camera</span>
                </button>
                <!-- Drawer body (expandable content - game controller layout) -->
                <div class="camera-drawer-body" id="cameraDrawerBody">
                  <!-- Left: Rotate View D-pad with auto-rotate toggle in center -->
                  <div class="camera-drawer-section camera-drawer-rotate">
                    <div
                      class="camera-drawer-dpad"
                      role="group"
                      aria-label="Rotation controls"
                    >
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-up"
                        id="mobileCameraRotateUp"
                        aria-label="Rotate view up"
                        title="Rotate up"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <polyline points="18 15 12 9 6 15"></polyline>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-left"
                        id="mobileCameraRotateLeft"
                        aria-label="Rotate view left"
                        title="Rotate left"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn auto-rotate-toggle dpad-center"
                        id="mobileAutoRotateToggle"
                        aria-pressed="false"
                        aria-label="Toggle auto rotation"
                        title="Auto rotate"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <path
                            d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"
                          ></path>
                          <polyline points="21 3 21 8 16 8"></polyline>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-right"
                        id="mobileCameraRotateRight"
                        aria-label="Rotate view right"
                        title="Rotate right"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-down"
                        id="mobileCameraRotateDown"
                        aria-label="Rotate view down"
                        title="Rotate down"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <!-- Center: Zoom + Reset -->
                  <div class="camera-drawer-section camera-drawer-zoom">
                    <h3 class="camera-drawer-section-title">Zoom</h3>
                    <div
                      class="camera-drawer-zoom-controls"
                      role="group"
                      aria-label="Zoom controls"
                    >
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn"
                        id="mobileCameraZoomIn"
                        aria-label="Zoom in"
                        title="Zoom in"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <circle cx="11" cy="11" r="8"></circle>
                          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                          <line x1="11" y1="8" x2="11" y2="14"></line>
                          <line x1="8" y1="11" x2="14" y2="11"></line>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn"
                        id="mobileCameraZoomOut"
                        aria-label="Zoom out"
                        title="Zoom out"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <circle cx="11" cy="11" r="8"></circle>
                          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                          <line x1="8" y1="11" x2="14" y2="11"></line>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm camera-drawer-btn camera-drawer-reset-btn"
                        id="mobileCameraResetView"
                        aria-label="Reset camera to default view"
                        title="Reset view"
                      >
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <path
                            d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"
                          ></path>
                          <path d="M3 3v5h5"></path>
                        </svg>
                        <span>Reset</span>
                      </button>
                    </div>
                  </div>
                  <!-- Right: Pan View D-pad with label in center -->
                  <div class="camera-drawer-section camera-drawer-pan">
                    <div
                      class="camera-drawer-dpad"
                      role="group"
                      aria-label="Pan controls"
                    >
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-up"
                        id="mobileCameraPanUp"
                        aria-label="Pan view up"
                        title="Pan up"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <line x1="12" y1="19" x2="12" y2="5"></line>
                          <polyline points="5 12 12 5 19 12"></polyline>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-left"
                        id="mobileCameraPanLeft"
                        aria-label="Pan view left"
                        title="Pan left"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <line x1="19" y1="12" x2="5" y2="12"></line>
                          <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                      </button>
                      <span class="camera-drawer-dpad-label">Pan</span>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-right"
                        id="mobileCameraPanRight"
                        aria-label="Pan view right"
                        title="Pan right"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <line x1="5" y1="12" x2="19" y2="12"></line>
                          <polyline points="12 5 19 12 12 19"></polyline>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-icon camera-drawer-btn dpad-down"
                        id="mobileCameraPanDown"
                        aria-label="Pan view down"
                        title="Pan down"
                      >
                        <svg
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          aria-hidden="true"
                        >
                          <line x1="12" y1="5" x2="12" y2="19"></line>
                          <polyline points="19 12 12 19 5 12"></polyline>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <!-- Standard Views (mobile - scrollable row) -->
                  <div class="camera-drawer-section camera-drawer-views">
                    <h3 class="camera-drawer-section-title">Standard Views</h3>
                    <div
                      class="camera-drawer-views-grid"
                      role="group"
                      aria-label="Standard camera views"
                    >
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="top"
                        aria-label="Top view"
                        title="Top view"
                      >
                        Top
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="front"
                        aria-label="Front view"
                        title="Front view"
                      >
                        Front
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="right"
                        aria-label="Right side view"
                        title="Right side view"
                      >
                        Right
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="left"
                        aria-label="Left side view"
                        title="Left side view"
                      >
                        Left
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="back"
                        aria-label="Back view"
                        title="Back view"
                      >
                        Back
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="bottom"
                        aria-label="Bottom view"
                        title="Bottom view"
                      >
                        Bottom
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline camera-view-btn"
                        data-view="diagonal"
                        aria-label="Diagonal isometric view"
                        title="Diagonal isometric view"
                      >
                        Diagonal
                      </button>
                    </div>
                  </div>
                  <!-- Projection Toggle (mobile) -->
                  <div class="camera-drawer-section camera-drawer-projection">
                    <button
                      type="button"
                      class="btn btn-sm btn-outline camera-drawer-projection-btn"
                      id="mobileProjectionToggle"
                      aria-pressed="false"
                      aria-label="Toggle perspective/orthographic projection"
                      title="Switch to Orthographic"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        aria-hidden="true"
                      >
                        <rect
                          x="3"
                          y="3"
                          width="18"
                          height="18"
                          rx="2"
                          ry="2"
                        ></rect>
                        <line x1="3" y1="9" x2="21" y2="9"></line>
                        <line x1="9" y1="21" x2="9" y2="9"></line>
                      </svg>
                      <span>Perspective</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Camera Controls Panel (Right Side Drawer) -->
          <div
            class="camera-panel collapsed"
            id="cameraPanel"
            role="region"
            aria-labelledby="camera-controls-heading"
          >
            <div class="panel-header camera-panel-header">
              <!-- Row 1: Title -->
              <div class="camera-header-title-row">
                <h2 id="camera-controls-heading">Camera</h2>
              </div>
              <!-- Row 2: Collapse button -->
              <div class="camera-header-actions">
                <button
                  id="cameraPanelToggle"
                  class="btn btn-sm btn-icon btn-collapse-panel forge-control"
                  aria-expanded="false"
                  aria-controls="cameraPanelBody"
                  aria-label="Expand camera controls panel"
                  title="Camera Controls"
                  data-tutorial-target="camera-panel-toggle"
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <polyline points="13 6 19 12 13 18"></polyline>
                    <line x1="7" y1="4" x2="7" y2="20" stroke-width="2"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div class="camera-panel-body" id="cameraPanelBody">
              <!-- Rotation Controls - D-pad layout -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Rotate View</h3>
                <div
                  class="camera-control-dpad"
                  role="group"
                  aria-label="Rotation controls"
                >
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-up"
                    id="cameraRotateUp"
                    aria-label="Rotate view up"
                    title="Rotate up (Arrow Up)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polyline points="18 15 12 9 6 15"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-left"
                    id="cameraRotateLeft"
                    aria-label="Rotate view left"
                    title="Rotate left (Arrow Left)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn auto-rotate-toggle dpad-center"
                    id="autoRotateToggle"
                    aria-pressed="false"
                    aria-label="Toggle auto rotation"
                    title="Auto rotate"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <path
                        d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"
                      ></path>
                      <polyline points="21 3 21 8 16 8"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-right"
                    id="cameraRotateRight"
                    aria-label="Rotate view right"
                    title="Rotate right (Arrow Right)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-down"
                    id="cameraRotateDown"
                    aria-label="Rotate view down"
                    title="Rotate down (Arrow Down)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </button>
                </div>
              </div>
              <!-- Pan Controls - D-pad layout -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Pan View</h3>
                <div
                  class="camera-control-dpad"
                  role="group"
                  aria-label="Pan controls"
                >
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-up"
                    id="cameraPanUp"
                    aria-label="Pan view up"
                    title="Pan up (Shift + Arrow Up)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <line x1="12" y1="19" x2="12" y2="5"></line>
                      <polyline points="5 12 12 5 19 12"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-left"
                    id="cameraPanLeft"
                    aria-label="Pan view left"
                    title="Pan left (Shift + Arrow Left)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <line x1="19" y1="12" x2="5" y2="12"></line>
                      <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-right"
                    id="cameraPanRight"
                    aria-label="Pan view right"
                    title="Pan right (Shift + Arrow Right)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                      <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-icon camera-btn dpad-down"
                    id="cameraPanDown"
                    aria-label="Pan view down"
                    title="Pan down (Shift + Arrow Down)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <polyline points="19 12 12 19 5 12"></polyline>
                    </svg>
                  </button>
                </div>
              </div>
              <!-- Zoom Controls -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Zoom</h3>
                <div class="camera-control-row">
                  <button
                    type="button"
                    class="btn btn-sm camera-btn-wide"
                    id="cameraZoomIn"
                    aria-label="Zoom in"
                    title="Zoom in (+)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <circle cx="11" cy="11" r="8"></circle>
                      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                      <line x1="11" y1="8" x2="11" y2="14"></line>
                      <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                    <span>Zoom In</span>
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm camera-btn-wide"
                    id="cameraZoomOut"
                    aria-label="Zoom out"
                    title="Zoom out (-)"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <circle cx="11" cy="11" r="8"></circle>
                      <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                      <line x1="8" y1="11" x2="14" y2="11"></line>
                    </svg>
                    <span>Zoom Out</span>
                  </button>
                </div>
              </div>
              <!-- Standard Views (consistent camera angles) -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Standard Views</h3>
                <div
                  class="camera-standard-views"
                  role="group"
                  aria-label="Standard camera views"
                >
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="top"
                    aria-label="Top view (Ctrl+5)"
                    title="Top view (Ctrl+5)"
                  >
                    Top
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="front"
                    aria-label="Front view (Ctrl+8)"
                    title="Front view (Ctrl+8)"
                  >
                    Front
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="right"
                    aria-label="Right side view (Ctrl+6)"
                    title="Right side view (Ctrl+6)"
                  >
                    Right
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="left"
                    aria-label="Left side view (Ctrl+4)"
                    title="Left side view (Ctrl+4)"
                  >
                    Left
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="back"
                    aria-label="Back view (Ctrl+2)"
                    title="Back view (Ctrl+2)"
                  >
                    Back
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="bottom"
                    aria-label="Bottom view (Ctrl+0)"
                    title="Bottom view (Ctrl+0)"
                  >
                    Bottom
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-view-btn"
                    data-view="diagonal"
                    aria-label="Diagonal isometric view (Ctrl+1)"
                    title="Diagonal isometric view (Ctrl+1)"
                  >
                    Diagonal
                  </button>
                </div>
              </div>
              <!-- Reset View -->
              <div class="camera-control-section">
                <button
                  type="button"
                  class="btn btn-sm btn-outline camera-btn-full"
                  id="cameraResetView"
                  aria-label="Reset camera to default view"
                  title="Reset view (Home)"
                >
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <path
                      d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
                    ></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                  </svg>
                  <span>Reset View</span>
                </button>
              </div>
              <!-- Projection Toggle -->
              <div class="camera-control-section">
                <button
                  type="button"
                  class="btn btn-sm btn-outline camera-btn-full"
                  id="projectionToggle"
                  aria-pressed="false"
                  aria-label="Toggle perspective/orthographic projection (P)"
                  title="Switch to Orthographic (P)"
                >
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    aria-hidden="true"
                  >
                    <rect
                      x="3"
                      y="3"
                      width="18"
                      height="18"
                      rx="2"
                      ry="2"
                    ></rect>
                    <line x1="3" y1="9" x2="21" y2="9"></line>
                    <line x1="9" y1="21" x2="9" y2="9"></line>
                  </svg>
                  <span>Perspective</span>
                </button>
              </div>
              <!-- Copy Camera Values -->
              <div class="camera-control-section">
                <h3 class="camera-control-section-title">Copy Camera Values</h3>
                <div
                  class="camera-copy-values"
                  role="group"
                  aria-label="Copy camera values to clipboard"
                >
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-btn-full"
                    id="edit-copy-translation-btn"
                    aria-label="Copy camera translation"
                  >
                    Translation
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-btn-full"
                    id="edit-copy-rotation-btn"
                    aria-label="Copy camera rotation"
                  >
                    Rotation
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-btn-full"
                    id="edit-copy-distance-btn"
                    aria-label="Copy camera distance"
                  >
                    Distance
                  </button>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline camera-btn-full"
                    id="edit-copy-fov-btn"
                    aria-label="Copy camera field of view"
                  >
                    FOV
                  </button>
                </div>
              </div>
              <!-- Keyboard Shortcuts Help -->
              <div class="camera-shortcuts-help">
                <details class="camera-shortcuts-details">
                  <summary
                    class="camera-shortcuts-summary"
                    aria-label="Keyboard shortcuts"
                  >
                    <span class="camera-shortcuts-icon" aria-hidden="true">
                      <svg
                        class="btn-icon-svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="square"
                        stroke-linejoin="miter"
                      >
                        <rect x="3" y="7" width="18" height="10" rx="0"></rect>
                        <line x1="6" y1="10" x2="8" y2="10"></line>
                        <line x1="9.5" y1="10" x2="11.5" y2="10"></line>
                        <line x1="13" y1="10" x2="15" y2="10"></line>
                        <line x1="16.5" y1="10" x2="18.5" y2="10"></line>
                        <line x1="6" y1="13.5" x2="10" y2="13.5"></line>
                        <line x1="11.5" y1="13.5" x2="18.5" y2="13.5"></line>
                      </svg>
                    </span>
                    <span class="camera-shortcuts-label"
                      >Keyboard Shortcuts</span
                    >
                  </summary>
                  <dl class="camera-shortcuts-list">
                    <div class="camera-shortcut-item">
                      <dt>Arrow Keys</dt>
                      <dd>Rotate view</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>Shift + Arrows</dt>
                      <dd>Pan view</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>+ / -</dt>
                      <dd>Zoom in/out</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>Mouse Drag</dt>
                      <dd>Orbit camera</dd>
                    </div>
                    <div class="camera-shortcut-item">
                      <dt>Scroll Wheel</dt>
                      <dd>Zoom</dd>
                    </div>
                  </dl>
                </details>
              </div>
            </div>
          </div>
        </div>
        <!-- Comparison View (hidden by default) -->
        <div
          class="comparison-view hidden"
          id="comparisonView"
          role="region"
          aria-label="Comparison view"
        >
          <!-- Comparison UI will be dynamically generated here -->
        </div>
      </main>
      <div
        class="error-message hidden"
        id="errorMessage"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      ></div>
    </div>
    <!-- Render Queue Modal -->
    <div
      class="modal hidden"
      id="renderQueueModal"
      role="dialog"
      aria-labelledby="queueModalTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="queueModalOverlay"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2 id="queueModalTitle">Render Queue</h2>
          <button
            class="modal-close"
            id="queueModalClose"
            aria-label="Close render queue"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body" id="queueModalBody">
          <!-- Queue controls -->
          <div class="queue-controls">
            <button
              id="processQueueBtn"
              class="btn btn-primary"
              aria-label="Process all queued jobs"
            >
              ▶️ Process Queue
            </button>
            <button
              id="stopQueueBtn"
              class="btn btn-outline hidden"
              aria-label="Stop processing queue"
            >
              ⏸️ Stop
            </button>
            <button
              id="clearCompletedBtn"
              class="btn btn-outline"
              aria-label="Clear completed jobs"
            >
              🗑️ Clear Completed
            </button>
            <button
              id="clearQueueBtn"
              class="btn btn-outline"
              aria-label="Clear all jobs"
            >
              🗑️ Clear All
            </button>
            <button
              id="exportQueueBtn"
              class="btn btn-outline"
              aria-label="Export queue as JSON"
            >
              💾 Export Queue
            </button>
            <button
              id="importQueueBtn"
              class="btn btn-outline"
              aria-label="Import queue from JSON"
            >
              📂 Import Queue
            </button>
          </div>
          <!-- Queue statistics -->
          <div class="queue-stats" id="queueStats" aria-live="polite">
            <span class="queue-stat"
              >Total: <strong id="queueStatsTotal">0</strong></span
            >
            <span class="queue-stat"
              >Queued: <strong id="queueStatsQueued">0</strong></span
            >
            <span class="queue-stat"
              >Rendering: <strong id="queueStatsRendering">0</strong></span
            >
            <span class="queue-stat"
              >Complete: <strong id="queueStatsComplete">0</strong></span
            >
            <span class="queue-stat"
              >Error: <strong id="queueStatsError">0</strong></span
            >
          </div>
          <!-- Queue list -->
          <div class="queue-list" id="queueList" role="list">
            <!-- Queue items will be dynamically generated here -->
            <div class="queue-empty" id="queueEmpty" role="listitem">
              <p>No jobs in queue</p>
              <p class="queue-empty-hint">Click "Add to Queue" to add jobs</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Hidden file input for queue import -->
    <input
      type="file"
      id="queueImportInput"
      accept=".json"
      style="display: none"
      aria-hidden="true"
    />
    <!-- Source Code Viewer Modal -->
    <div
      class="modal hidden"
      id="sourceViewerModal"
      role="dialog"
      aria-labelledby="sourceViewerTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="sourceViewerOverlay"></div>
      <div class="modal-content modal-large modal-source">
        <div class="modal-header">
          <h2 id="sourceViewerTitle">OpenSCAD Source</h2>
          <div class="source-viewer-actions">
            <button
              class="btn btn-sm btn-outline"
              id="sourceViewerCopy"
              aria-label="Copy source code"
            >
              📋 Copy
            </button>
            <button
              class="modal-close"
              id="sourceViewerClose"
              aria-label="Close source viewer"
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        <div class="modal-body source-viewer-body">
          <textarea
            id="sourceViewerContent"
            class="source-viewer-textarea"
            readonly
            aria-label="OpenSCAD source code"
            spellcheck="false"
          ></textarea>
          <div class="source-viewer-info" id="sourceViewerInfo">
            <!-- File info will be displayed here -->
          </div>
        </div>
      </div>
    </div>
    <!-- Parameters JSON Viewer Modal -->
    <div
      class="modal hidden"
      id="paramsJsonModal"
      role="dialog"
      aria-labelledby="paramsJsonTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="paramsJsonOverlay"></div>
      <div class="modal-content modal-medium">
        <div class="modal-header">
          <h2 id="paramsJsonTitle">Current Parameters (JSON)</h2>
          <div class="params-json-actions">
            <button
              class="btn btn-sm btn-outline"
              id="paramsJsonCopy"
              aria-label="Copy parameters JSON"
            >
              📋 Copy
            </button>
            <button
              class="modal-close"
              id="paramsJsonClose"
              aria-label="Close parameters viewer"
            >
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
        <div class="modal-body">
          <textarea
            id="paramsJsonContent"
            class="params-json-textarea"
            readonly
            aria-label="Parameters JSON"
            spellcheck="false"
          ></textarea>
        </div>
      </div>
    </div>
    <!-- Features Guide Modal -->
    <div
      class="modal hidden"
      id="featuresGuideModal"
      role="dialog"
      aria-labelledby="featuresGuideTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="featuresGuideOverlay"></div>
      <div
        class="modal-content modal-large"
        data-tutorial-target="features-guide-modal"
      >
        <div class="modal-header">
          <h2 id="featuresGuideTitle">Features Guide</h2>
          <button
            class="modal-close"
            id="featuresGuideClose"
            aria-label="Close features guide"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body features-guide-body">
          <!-- Tab navigation for feature sections -->
          <div
            class="features-tabs"
            role="tablist"
            aria-label="Feature sections"
          >
            <button
              class="features-tab"
              role="tab"
              aria-selected="true"
              aria-controls="featuresPanelLibraries"
              id="tab-libraries"
              tabindex="0"
            >
              Libraries
            </button>
            <button
              class="features-tab"
              role="tab"
              aria-selected="false"
              aria-controls="featuresPanelColors"
              id="tab-colors"
              tabindex="-1"
            >
              Color Parameters
            </button>
            <button
              class="features-tab"
              role="tab"
              aria-selected="false"
              aria-controls="featuresPanelPresets"
              id="tab-presets"
              tabindex="-1"
            >
              Presets
            </button>
            <button
              class="features-tab"
              role="tab"
              aria-selected="false"
              aria-controls="featuresPanelAdvanced"
              id="tab-advanced"
              tabindex="-1"
            >
              Advanced
            </button>
            <button
              class="features-tab"
              role="tab"
              aria-selected="false"
              aria-controls="featuresPanelWorkflow"
              id="tab-workflow"
              tabindex="-1"
            >
              Workflow
            </button>
            <button
              class="features-tab"
              role="tab"
              aria-selected="false"
              aria-controls="featuresPanelAccessibility"
              id="tab-accessibility"
              tabindex="-1"
            >
              Accessibility
            </button>
            <button
              class="features-tab"
              role="tab"
              aria-selected="false"
              aria-controls="featuresPanelAltView"
              id="tab-altview"
              tabindex="-1"
              hidden
              data-hfm-gated
            >
              Alt View
            </button>
          </div>
          <!-- Libraries Panel -->
          <div
            class="features-panel"
            id="featuresPanelLibraries"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-libraries"
          >
            <h3>OpenSCAD Library Bundles</h3>
            <p>
              This customizer includes popular OpenSCAD library bundles that
              provide reusable components and advanced functions for your
              models.
            </p>
            <h4>Available Libraries</h4>
            <ul class="features-list">
              <li>
                <strong>MCAD</strong> – Mechanical components like gears,
                screws, bearings, and fasteners
              </li>
              <li>
                <strong>BOSL2</strong> – Advanced geometry primitives,
                attachable parts, and complex shapes
              </li>
              <li>
                <strong>NopSCADlib</strong> – Parts library for 3D printers and
                electronics projects
              </li>
              <li>
                <strong>dotSCAD</strong> – Artistic patterns, designs, and
                creative geometry
              </li>
            </ul>
            <h4>How to Use Libraries</h4>
            <p>Include library modules in your OpenSCAD code:</p>
            <pre><code>use &lt;MCAD/boxes.scad&gt;;use &lt;BOSL2/std.scad&gt;;</code></pre>
            <p>
              The customizer automatically detects which libraries your model
              uses and marks them as "required". You can also manually enable
              any library from the 📚 Libraries panel.
            </p>
            <div class="features-action">
              <button
                class="btn btn-primary"
                data-example="library-test"
                data-feature-example="true"
              >
                📚 Load Library Test Example
              </button>
              <p class="features-note">
                This example demonstrates MCAD library usage with mechanical
                components.
              </p>
            </div>
            <h4>Related Features</h4>
            <ul class="features-list">
              <li>
                <strong>ZIP projects</strong> – Upload a
                <code>.zip</code> containing multiple <code>.scad</code> files
                and dependencies
              </li>
              <li>
                <strong>File tree</strong> – View included files to confirm
                everything loaded correctly
              </li>
              <li>
                <strong>Source viewer</strong> – Inspect the fully assembled
                source (Advanced tab)
              </li>
            </ul>
          </div>
          <!-- Colors Panel -->
          <div
            class="features-panel"
            id="featuresPanelColors"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-colors"
            hidden
          >
            <h3>Color Parameters</h3>
            <p>
              Add interactive color pickers to your models by using the
              <code>[color]</code> annotation in your OpenSCAD parameters.
            </p>
            <h4>Syntax</h4>
            <pre><code>// Hex color with annotationbox_color = "FF6B35"; // [color]// RGB hex format (with or without #)primary_color = "#3498DB"; // [color]secondary_color = "E74C3C"; // [color]</code></pre>
            <h4>How It Works</h4>
            <p>
              When you add the <code>// [color]</code> annotation to a string
              parameter, the customizer:
            </p>
            <ul class="features-list">
              <li>Displays a visual color picker instead of a text input</li>
              <li>Shows a color preview swatch next to the parameter</li>
              <li>Validates hex color values automatically</li>
              <li>Updates the preview in real-time as you change colors</li>
            </ul>
            <h4>Using Colors in Your Model</h4>
            <p>
              Use your color parameter in OpenSCAD however you prefer (RGB
              arrays, named colors, or helper functions). The example below
              includes a working conversion helper.
            </p>
            <div class="features-action">
              <button
                class="btn btn-primary"
                data-example="colored-box"
                data-feature-example="true"
              >
                🎨 Load Colored Box Example
              </button>
              <p class="features-note">
                This example shows how to use color parameters with a complete
                hex2rgb implementation.
              </p>
            </div>
            <h4>Preview-Only Model Color</h4>
            <p>
              You can also change the model’s display color without changing
              your OpenSCAD file:
            </p>
            <ul class="features-list">
              <li>
                <strong>Preview Settings &amp; Info → Model Color</strong> –
                affects the preview only
              </li>
              <li>
                <strong>Reset</strong> – returns to the theme default display
                color
              </li>
            </ul>
          </div>
          <!-- Presets Panel -->
          <div
            class="features-panel"
            id="featuresPanelPresets"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-presets"
            hidden
          >
            <h3>Designs (Presets)</h3>
            <p>
              Save and load your favourite design configurations to quickly
              switch between different variations of your model.
            </p>
            <h4>Saving Presets</h4>
            <ol class="features-list">
              <li>Adjust your parameters to the desired values</li>
              <li>
                Click the <strong>💾 Save Preset</strong> button above the
                parameters
              </li>
              <li>Enter a descriptive name for your preset</li>
              <li>Your preset is saved locally in your browser</li>
            </ol>
            <h4>Loading Presets</h4>
            <p>
              Use the preset dropdown menu to quickly switch between saved
              configurations. The parameters will update automatically.
            </p>
            <h4>Managing Presets</h4>
            <ul class="features-list">
              <li><strong>Rename</strong> – Update preset names for clarity</li>
              <li>
                <strong>Delete</strong> – Remove presets you no longer need
              </li>
              <li>
                <strong>Export/Import</strong> – Share presets with others or
                back them up
              </li>
            </ul>
            <p>
              Presets are stored per-file, so each model has its own set of
              saved configurations.
            </p>
            <h4>Sharing Your Configuration</h4>
            <ul class="features-list">
              <li>
                <strong>Share Link</strong> (Actions menu) – Copy a URL that
                includes your current parameters
              </li>
              <li>
                <strong>Export Params</strong> (Actions menu) – Download your
                current settings as a JSON file
              </li>
            </ul>
            <h4>Sort Designs</h4>
            <ul class="features-list">
              <li>
                <strong>Sort</strong> designs by name (A&#x2013;Z or Z&#x2013;A)
                or by date created/modified in the Manage Designs panel.
              </li>
              <li>Sort preference is saved per browser session.</li>
            </ul>
            <h4>Import Modes</h4>
            <ul class="features-list">
              <li>
                <strong>Merge</strong> &#x2014; add imported designs to your
                existing ones (default).
              </li>
              <li>
                <strong>Replace all</strong> &#x2014; delete all existing
                designs for the current model, then import. Always asks for
                confirmation.
              </li>
            </ul>
            <h4>Export Naming</h4>
            <ul class="features-list">
              <li>
                Single-design exports use the design name as the filename (e.g.
                <code>iPad Pro 11 LAMP layout.json</code>).
              </li>
            </ul>
            <h4>Compatibility Analysis</h4>
            <ul class="features-list">
              <li>
                When loading a design, the app compares its parameters against
                the current model&#x2019;s schema.
              </li>
              <li>
                Hidden parameters are excluded from this check &#x2014; no false
                &#x201C;new&#x201D; or &#x201C;obsolete&#x201D; warnings.
              </li>
            </ul>
          </div>
          <!-- Advanced Panel -->
          <div
            class="features-panel"
            id="featuresPanelAdvanced"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-advanced"
            hidden
          >
            <h3>Advanced Features</h3>
            <h4>Parameter Group Visibility</h4>
            <ul class="features-list">
              <li>
                Each parameter group header has a
                <strong>Hide group</strong> (×) button. Click it to remove the
                group from view.
              </li>
              <li>
                A <strong>Show all</strong> link appears at the bottom of the
                panel, showing how many groups are hidden.
              </li>
              <li>Hidden groups are remembered per model in localStorage.</li>
              <li>
                Keyboard: Tab to the × button and press Space/Enter; Tab to
                "Show all" to restore.
              </li>
            </ul>
            <h4>Parameter Search &amp; Jump</h4>
            <ul class="features-list">
              <li>
                <strong>Search parameters</strong> – Filter by name/description
              </li>
              <li>
                <strong>Jump to group</strong> – Quickly navigate long parameter
                lists
              </li>
              <li>
                <strong>Show all</strong> – Restore all parameters after a
                search
              </li>
            </ul>
            <h4>Output Formats</h4>
            <p>Export your customized models in multiple formats:</p>
            <ul class="features-list">
              <li>
                <strong>STL</strong> – Standard format for 3D printing (binary
                or ASCII)
              </li>
              <li>
                <strong>OBJ</strong> – Common 3D model format with material
                support
              </li>
              <li><strong>OFF</strong> – Object File Format for geometry</li>
              <li><strong>AMF</strong> – Additive Manufacturing File Format</li>
              <li>
                <strong>3MF</strong> – Modern 3D printing format with color
                support
              </li>
            </ul>
            <h4>Multi-File Projects</h4>
            <p>
              Upload ZIP files containing multiple OpenSCAD files. The
              customizer will:
            </p>
            <ul class="features-list">
              <li>Automatically detect the main file</li>
              <li>Extract and mount all included files</li>
              <li>Display a file tree showing the project structure</li>
              <li>
                Support relative paths in <code>include</code> and
                <code>use</code> statements
              </li>
            </ul>
            <div class="features-action">
              <button
                class="btn btn-primary"
                data-example="multi-file-box"
                data-feature-example="true"
              >
                🧩 Load Multi-file ZIP Example
              </button>
              <p class="features-note">
                A small ZIP project that demonstrates includes, modules, and the
                file tree.
              </p>
            </div>
            <h4>Parameter Limits Override</h4>
            <p>
              By default, sliders and number inputs respect the limits defined
              in your OpenSCAD file. You can unlock parameter limits from the
              Advanced menu to enter custom values.
            </p>
            <h4>Source Code Viewer</h4>
            <p>
              View the complete OpenSCAD source code, including all included
              files, from the Advanced menu. This helps verify that multi-file
              projects are loaded correctly.
            </p>
            <h4>Current Parameters as JSON</h4>
            <p>
              Use <strong>Advanced → View Params JSON</strong> to copy or
              archive your current configuration (useful for clinics,
              classrooms, or troubleshooting).
            </p>
            <h4>Render Quality</h4>
            <p>Choose different quality levels for preview and exports:</p>
            <ul class="features-list">
              <li>
                <strong>Preview quality</strong> – Auto, Fidelity, Balanced,
                Fast
              </li>
              <li>
                <strong>Export quality</strong> – Model default, Low, Medium,
                High
              </li>
              <li>
                <strong>Complexity indicator</strong> – Shows a suggested
                quality tier based on your model
              </li>
            </ul>
          </div>
          <!-- Workflow Panel -->
          <div
            class="features-panel"
            id="featuresPanelWorkflow"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-workflow"
            hidden
          >
            <h3>Workflow &amp; Actions</h3>
            <h4>Grid Size (Printer Bed)</h4>
            <ul class="features-list">
              <li>
                Open <strong>Preview Settings</strong> and use the
                <strong>Grid size</strong> controls to match your printer bed
                dimensions.
              </li>
              <li>
                Choose from common presets (Ender 3, Prusa MK4, CR-10, large
                format) or enter custom mm values.
              </li>
              <li>
                The grid updates immediately and the setting is remembered
                across sessions.
              </li>
            </ul>
            <h4>Screenshot Reference Overlay</h4>
            <ul class="features-list">
              <li>
                Include a <code>screenshot.png</code> in your ZIP project and it
                is automatically loaded as a reference overlay behind your
                keyguard in the 3D preview.
              </li>
              <li>
                Choose a tablet from the
                <strong>Size to device</strong> dropdown to snap the overlay to
                known screen dimensions.
              </li>
              <li>
                If your SCAD file has <code>screen_width_mm</code> and
                <code>screen_height_mm</code> parameters, the overlay resizes
                automatically when you load the model.
              </li>
            </ul>
            <p>
              The app is designed around a simple, repeatable workflow. A
              progress indicator at the top shows where you are.
            </p>
            <h4>The 4-Step Flow</h4>
            <ol class="features-list">
              <li>
                <strong>Upload</strong> – Load a <code>.scad</code> or
                <code>.zip</code> project
              </li>
              <li>
                <strong>Customize</strong> – Adjust parameters, use presets,
                search/jump for large models
              </li>
              <li>
                <strong>Generate</strong> – Create your output file
                (STL/OBJ/OFF/AMF/3MF)
              </li>
              <li>
                <strong>Download</strong> – Download the generated file (or
                download the last file again)
              </li>
            </ol>
            <h4>Actions Menu</h4>
            <p>
              Open the <strong>Actions</strong> drawer to find power features:
            </p>
            <ul class="features-list">
              <li>
                <strong>Share Link</strong> – Copy a URL with your current
                parameters
              </li>
              <li>
                <strong>Export Params</strong> – Download your configuration as
                JSON
              </li>
              <li>
                <strong>Compare</strong> – Track and compare parameter changes
              </li>
              <li>
                <strong>Queue</strong> – Batch multiple renders and process them
                later
              </li>
            </ul>
            <h4>Focus Mode</h4>
            <p>
              Use <strong>Full Screen</strong> (Focus Mode) to maximize the
              preview area when presenting or when working on smaller screens.
            </p>
          </div>
          <!-- Accessibility Panel -->
          <div
            class="features-panel"
            id="featuresPanelAccessibility"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-accessibility"
            hidden
          >
            <h3>Accessibility Features</h3>
            <p>
              The UI is built to support keyboard-only use, screen readers,
              voice control, and low-vision needs.
            </p>
            <h4>Console Warnings for Missing Files</h4>
            <ul class="features-list">
              <li>
                When a model uses <code>include &lt;file.txt&gt;</code> but the
                file is missing, the <strong>Console</strong> panel surfaces the
                warning immediately.
              </li>
              <li>
                A badge count on the Console button updates, and a live region
                announces the warning to screen readers.
              </li>
              <li>
                Filter by Warnings in the Console panel to see only relevant
                messages.
              </li>
            </ul>
            <h4>Live Region Announcements</h4>
            <ul class="features-list">
              <li>
                <strong>Designs sorted</strong>: announced when sort order
                changes in the Manage panel.
              </li>
              <li>
                <strong>Group hidden / shown</strong>: announced when parameter
                groups are hidden or shown.
              </li>
              <li>
                <strong>Grid size updated</strong>: announced when the printer
                bed dimensions change.
              </li>
              <li>
                <strong>Overlay sized</strong>: announced when the reference
                overlay is resized to a tablet device.
              </li>
            </ul>
            <h4>Keyboard &amp; Focus</h4>
            <ul class="features-list">
              <li>
                <strong>Skip link</strong> – Press <kbd>Tab</kbd> at the top to
                jump to main content
              </li>
              <li>
                <strong>Undo / Redo</strong> – <kbd>Ctrl</kbd>+<kbd>Z</kbd> /
                <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd>
              </li>
              <li>
                <strong>Focus indicators</strong> – 3px visible outlines (4px in
                High Contrast mode)
              </li>
              <li>
                <strong>Touch targets</strong> – Buttons meet a 44×44px minimum
                size
              </li>
            </ul>
            <h4>Screen Readers</h4>
            <ul class="features-list">
              <li>
                <strong>Status announcements</strong> – Key operations are
                announced via live regions
              </li>
              <li>
                <strong>Landmarks</strong> – Major sections are labeled as
                regions for quick navigation
              </li>
              <li>
                <strong>Plain-language errors</strong> – Errors include clear
                titles and suggested fixes
              </li>
            </ul>
            <h4>Theme &amp; Contrast</h4>
            <ul class="features-list">
              <li><strong>Theme toggle</strong> – Light / Dark</li>
              <li>
                <strong>High Contrast (HC)</strong> – AAA-oriented contrast and
                thicker focus/borders
              </li>
              <li>
                <strong>Forced colors</strong> – Works with Windows High
                Contrast / forced-colors mode
              </li>
              <li>
                <strong>Reduced motion</strong> – Respects
                <code>prefers-reduced-motion</code>
              </li>
            </ul>
            <div class="features-action">
              <a
                class="btn btn-outline"
                href="https://github.com/BrennenJohnston/openscad-assistive-forge/blob/main/docs/guides/ACCESSIBILITY_GUIDE.md"
                target="_blank"
                rel="noopener noreferrer"
              >
                📘 Full Accessibility Guide (opens in new tab)
              </a>
              <p class="features-note">
                Full details, including tested screen reader/browser
                combinations.
              </p>
            </div>
          </div>
          <!-- Alt View Panel (HFM gated) -->
          <div
            class="features-panel"
            id="featuresPanelAltView"
            role="tabpanel"
            tabindex="0"
            aria-labelledby="tab-altview"
            hidden
            data-hfm-gated
          >
            <h3>ASCII Render Mode (Alt View)</h3>
            <p>
              Alt View converts the 3D preview into character-based ASCII art.
              This hidden feature is unlocked via a special input sequence or
              developer bypass.
            </p>
            <h4>What is Alt View?</h4>
            <ul class="features-list">
              <li>
                <strong>Purpose</strong> – ASCII art rendering mode that
                converts the 3D preview into character-based art
              </li>
              <li>
                <strong>Location</strong> – Toggle button appears in the header
                next to the Theme toggle after unlock
              </li>
              <li>
                <strong>Effect</strong> – Activates the mono UI theme variant
                and replaces the WebGL preview with ASCII character output
              </li>
              <li>
                <strong>Session-only</strong> – The theme switch does not
                persist; closing the browser reverts to normal
              </li>
            </ul>
            <h4>ASCII Rendering Technology</h4>
            <p>
              The ASCII renderer uses a 6D shape-vector character model for
              glyph selection:
            </p>
            <ul class="features-list">
              <li>
                Each cell is sampled at 6 internal points to create a "shape
                signature"
              </li>
              <li>
                Characters are matched by finding the glyph whose shape vector
                is closest
              </li>
              <li>
                Per-cell and directional contrast enhancement improves edge
                definition
              </li>
              <li>
                Based on research into shape-vector ASCII rendering (credited in
                THIRD_PARTY_NOTICES.md)
              </li>
            </ul>
            <h4>Controls Reference</h4>
            <div class="altview-controls-diagram">
              <div class="altview-dpad-group">
                <div class="altview-dpad-label">Rotate D-pad</div>
                <div class="altview-dpad">
                  <div class="altview-dpad-arrow altview-dpad-up">▲</div>
                  <div class="altview-dpad-arrow altview-dpad-left">◄</div>
                  <div class="altview-dpad-center">⟳</div>
                  <div class="altview-dpad-arrow altview-dpad-right">►</div>
                  <div class="altview-dpad-arrow altview-dpad-down">▼</div>
                </div>
                <div class="altview-dpad-hint">Center: Auto-Rotate</div>
              </div>
              <div class="altview-dpad-group">
                <div class="altview-dpad-label">Pan D-pad</div>
                <div class="altview-dpad">
                  <div class="altview-dpad-arrow altview-dpad-up">▲</div>
                  <div class="altview-dpad-arrow altview-dpad-left">◄</div>
                  <div class="altview-dpad-center">⊕</div>
                  <div class="altview-dpad-arrow altview-dpad-right">►</div>
                  <div class="altview-dpad-arrow altview-dpad-down">▼</div>
                </div>
                <div class="altview-dpad-hint">Center: Pan Adjust Toggle</div>
              </div>
            </div>
            <p class="altview-adjust-legend">
              <strong>When Pan Adjust is ON:</strong> ▲/▼ = Edge ±, ◄/► = Size ±
            </p>
            <h4>Auto-Rotate (Rotate D-pad center)</h4>
            <ul class="features-list">
              <li>Toggles automatic model rotation around the Z-axis</li>
              <li>Enabled by default when Alt View is activated</li>
              <li>Click to pause/resume rotation</li>
            </ul>
            <h4>Pan Adjust Toggle (Pan D-pad center)</h4>
            <p>Switches the Pan D-pad between two modes:</p>
            <ul class="features-list">
              <li>
                <strong>OFF (default)</strong> – Normal pan behavior (moves the
                camera)
              </li>
              <li>
                <strong>ON</strong> – Adjustment mode for Edge and Size
                parameters
              </li>
            </ul>
            <h4>Edge &amp; Size Adjustment</h4>
            <p>
              When Pan Adjust is ON, the D-pad arrows control rendering
              parameters:
            </p>
            <ul class="features-list">
              <li>
                <strong>Up arrow</strong> – Increase Edge (sharper outlines,
                more contrast)
              </li>
              <li>
                <strong>Down arrow</strong> – Decrease Edge (softer outlines,
                less contrast)
              </li>
              <li>
                <strong>Right arrow</strong> – Increase Size (larger characters,
                fewer columns)
              </li>
              <li>
                <strong>Left arrow</strong> – Decrease Size (smaller characters,
                more columns)
              </li>
            </ul>
            <p>
              Edge range: 0.5–4.0 &nbsp;|&nbsp; Size range: 0.5–2.5
              &nbsp;(defaults vary by device)
            </p>
            <h4>Status Bar</h4>
            <p>
              When Alt View is active, the status bar shows current Edge and
              Size values. Example:
              <code>[ALT VIEW] Edge: 1.8 | Size: 1.0</code>
            </p>
            <h4>Tips</h4>
            <ul class="features-list">
              <li>
                Alt View auto-calibrates Edge and Size based on your viewport
                size and device type
              </li>
              <li>
                Mobile devices default to larger characters for readability
              </li>
              <li>
                High-DPI displays can handle more detail (smaller characters,
                sharper edges)
              </li>
              <li>
                The sliders in the preview settings panel provide the same
                adjustments as the D-pad
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <!-- Text File Editor Modal (for editing companion .txt files) -->
    <div
      class="modal hidden"
      id="textFileEditorModal"
      role="dialog"
      aria-labelledby="textFileEditorTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="textFileEditorOverlay"></div>
      <div class="modal-content modal-medium">
        <div class="modal-header">
          <h2 id="textFileEditorTitle">Edit File</h2>
          <button
            class="modal-close"
            id="textFileEditorClose"
            aria-label="Close file editor"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p class="text-editor-info" id="textFileEditorInfo">
            Editing: <span id="textFileEditorFileName"></span>
          </p>
          <textarea
            id="textFileEditorContent"
            class="text-file-editor-textarea"
            aria-label="File content editor"
            spellcheck="false"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
          ></textarea>
          <p class="text-editor-hint">
            Press <kbd>Ctrl</kbd>+<kbd>S</kbd> to save and preview, or click
            "Apply and Preview"
          </p>
        </div>
        <div class="modal-footer">
          <button id="textFileEditorCancel" class="btn btn-outline">
            Cancel
          </button>
          <button id="textFileEditorApply" class="btn btn-primary">
            Apply and Preview
          </button>
        </div>
      </div>
    </div>
    <!-- Reset All Confirmation Modal (COGA: Undo confirmation) -->
    <div
      class="modal hidden"
      id="resetConfirmModal"
      role="dialog"
      aria-labelledby="resetConfirmTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="resetConfirmOverlay"></div>
      <div class="modal-content modal-small confirm-modal-content">
        <div class="modal-header">
          <h2 id="resetConfirmTitle">Reset All Parameters?</h2>
          <button
            class="modal-close"
            id="resetConfirmClose"
            aria-label="Cancel reset"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body confirm-modal-body">
          <p>
            This will reset <strong id="resetParamCount">all</strong> parameters
            to their original default values.
          </p>
          <p class="confirm-warning">
            Any customizations you've made will be lost.
          </p>
        </div>
        <div class="modal-footer confirm-modal-footer">
          <button id="resetConfirmCancel" class="btn btn-secondary">
            Cancel
          </button>
          <button id="resetConfirmOk" class="btn btn-primary">Reset All</button>
        </div>
      </div>
    </div>
    <!-- Keyboard Shortcuts Modal -->
    <div
      class="modal hidden"
      id="shortcutsModal"
      role="dialog"
      aria-labelledby="shortcutsModalTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="shortcutsModalOverlay"></div>
      <div class="modal-content modal-large shortcuts-modal-content">
        <div class="modal-header">
          <h2 id="shortcutsModalTitle">Keyboard Shortcuts</h2>
          <button
            class="modal-close"
            id="shortcutsModalClose"
            aria-label="Close keyboard shortcuts"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body shortcuts-modal-body" id="shortcutsModalBody">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="modal-footer shortcuts-modal-footer">
          <button id="shortcutsResetAll" class="btn btn-secondary">
            Reset All to Defaults
          </button>
          <button id="shortcutsModalDone" class="btn btn-primary">Done</button>
        </div>
      </div>
    </div>
    <!-- Console Output Modal (echo/warning/error display) -->
    <div
      class="modal hidden"
      id="consoleOutputModal"
      role="dialog"
      aria-labelledby="consoleOutputTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="consoleOutputOverlay"></div>
      <div class="modal-content modal-large modal-console">
        <div class="modal-header">
          <h2 id="consoleOutputTitle">OpenSCAD Console Output</h2>
          <button
            class="modal-close"
            id="consoleOutputClose"
            aria-label="Close console output"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body console-modal-body">
          <p class="console-description">
            This shows output from <code>echo()</code> statements in your
            OpenSCAD file. Designers often use echo() to provide guidance, show
            calculated values, or help troubleshoot configurations.
          </p>
          <div class="console-output-container">
            <pre
              class="console-output"
              id="consoleOutput"
              tabindex="0"
              aria-label="Console output text"
            >
No console output yet. Generate a model to see output.</pre
            >
          </div>
          <p class="console-hint" id="consoleHint">
            <strong>Tip:</strong> Look for <code>ECHO:</code> lines that may
            contain important instructions from the model designer.
          </p>
        </div>
        <div class="modal-footer console-modal-footer">
          <button id="consoleCopyBtn" class="btn btn-secondary">
            <svg
              class="btn-icon-svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path
                d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
              ></path>
            </svg>
            Copy
          </button>
          <button id="consoleDownloadBtn" class="btn btn-secondary">
            <svg
              class="btn-icon-svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Download
          </button>
          <button id="consoleClearBtn" class="btn btn-secondary">Clear</button>
          <button id="consoleCloseBtn" class="btn btn-primary">Close</button>
        </div>
      </div>
    </div>
    <!-- First-Visit Disclosure Modal -->
    <div
      class="modal hidden"
      id="first-visit-modal"
      role="dialog"
      aria-labelledby="first-visit-title"
      aria-describedby="first-visit-description"
      aria-modal="true"
    >
      <div class="modal-overlay" id="firstVisitOverlay"></div>
      <div class="modal-content modal-medium">
        <div class="modal-header">
          <h2 id="first-visit-title">Welcome to OpenSCAD Assistive Forge</h2>
        </div>
        <div class="modal-body" id="first-visit-description">
          <p>
            <strong>This runs locally in your browser.</strong> Your model is
            processed on this device and is not uploaded to a server.
          </p>
          <h3>Before you start</h3>
          <ul class="features-list">
            <li>
              <strong>One-time download:</strong> Your first render downloads
              the OpenSCAD engine (~15–30MB) and caches it for next time.
            </li>
            <li>
              <strong>Saved here:</strong> Your designs and settings are stored
              in this browser (storage limits vary by device/browser).
            </li>
            <li>
              <strong>Clearing site data removes saves:</strong> If you clear
              your browser storage/site data, saved work may be removed.
            </li>
          </ul>
          <p class="features-note">
            <strong>Continue</strong> to download and run the OpenSCAD engine
            locally.
          </p>
          <details class="file-info-details first-visit-details">
            <summary>Technical details</summary>
            <ul class="features-list">
              <li>
                <strong>Local processing:</strong> Rendering happens on your
                device.
              </li>
              <li>
                <strong>No server:</strong> Nothing is sent to external servers.
              </li>
              <li><strong>Privacy:</strong> Your data stays on your device.</li>
            </ul>
            <p class="features-note">
              Learn more:
              <a
                href="https://github.com/BrennenJohnston/openscad-assistive-forge/blob/main/README.md#how-it-works"
                target="_blank"
                rel="noopener noreferrer"
                >How it works (opens in new tab)</a
              >
              ·
              <a
                href="https://github.com/BrennenJohnston/openscad-assistive-forge/blob/main/docs/TROUBLESHOOTING.md#wasm-loading-issues"
                target="_blank"
                rel="noopener noreferrer"
                >WASM download help (opens in new tab)</a
              >
            </p>
          </details>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-primary"
            id="first-visit-continue"
          >
            Download &amp; Continue
          </button>
        </div>
      </div>
    </div>
    <!-- Publish/Share Project Modal -->
    <div
      class="modal hidden"
      id="publishProjectModal"
      role="dialog"
      aria-labelledby="publishModalTitle"
      aria-modal="true"
    >
      <div class="modal-overlay" id="publishModalOverlay"></div>
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2 id="publishModalTitle">Publish Project</h2>
          <button
            class="modal-close"
            id="publishModalClose"
            aria-label="Close publish dialog"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p>
            Generate a <code>forge-manifest.json</code> for your current
            project. Host it on GitHub and share a one-click link that opens
            Forge with everything pre-loaded.
          </p>
          <h3>1. Your Manifest</h3>
          <div class="publish-manifest-container">
            <pre
              id="publishManifestOutput"
              class="publish-manifest-code"
              tabindex="0"
              aria-label="Generated manifest JSON"
            ></pre>
            <button
              id="copyManifestBtn"
              class="btn btn-sm btn-primary publish-copy-btn"
              aria-label="Copy manifest JSON to clipboard"
            >
              Copy Manifest
            </button>
          </div>
          <h3>2. Host on GitHub</h3>
          <ol class="publish-instructions">
            <li>
              Create a
              <a
                href="https://github.com/new"
                target="_blank"
                rel="noopener noreferrer"
                >new public GitHub repository</a
              >.
            </li>
            <li>
              Upload your <code>.scad</code> file, companion files, and preset
              <code>.json</code> file.
            </li>
            <li>
              Save the manifest JSON above as
              <code>forge-manifest.json</code> in the same directory.
            </li>
          </ol>
          <h3>3. Get Your Shareable Link</h3>
          <label for="publishRepoUrl" class="publish-label">
            Your GitHub raw base URL:
          </label>
          <input
            id="publishRepoUrl"
            type="url"
            class="publish-input"
            placeholder="https://raw.githubusercontent.com/user/repo/main/"
            aria-describedby="publishRepoUrlHelp"
          />
          <p id="publishRepoUrlHelp" class="publish-help-text">
            Paste the raw URL path to the directory containing your files (e.g.,
            <code>https://raw.githubusercontent.com/user/repo/main/</code>).
          </p>
          <div
            id="publishShareLinkContainer"
            class="publish-share-link-container hidden"
          >
            <label for="publishShareLink" class="publish-label"
              >Shareable link:</label
            >
            <div class="publish-share-link-row">
              <input
                id="publishShareLink"
                type="text"
                class="publish-input"
                readonly
                aria-label="Shareable Forge link"
              />
              <button
                id="copyShareLinkBtn"
                class="btn btn-sm btn-primary"
                aria-label="Copy shareable link to clipboard"
              >
                Copy
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Drawer backdrop (for mobile off-canvas) -->
    <div class="drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>
    <!-- Toolbar Menu Modals (Phase 1) -->
    <div
      id="fileMenuModal"
      class="toolbar-menu-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="File menu"
      aria-hidden="true"
    >
      <div
        class="modal-overlay toolbar-menu-overlay"
        id="fileMenuOverlay"
      ></div>
      <div class="toolbar-menu-content">
        <div class="toolbar-menu-header">
          <span class="toolbar-menu-title">File</span
          ><button
            class="modal-close toolbar-menu-close btn-icon"
            type="button"
            aria-label="Close File menu"
          >
            &times;
          </button>
        </div>
        <div class="toolbar-menu-body">
          <ul class="menu-items-list" id="fileMenuItems"></ul>
        </div>
      </div>
    </div>
    <div
      id="editMenuModal"
      class="toolbar-menu-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="Edit menu"
      aria-hidden="true"
    >
      <div
        class="modal-overlay toolbar-menu-overlay"
        id="editMenuOverlay"
      ></div>
      <div class="toolbar-menu-content">
        <div class="toolbar-menu-header">
          <span class="toolbar-menu-title">Edit</span
          ><button
            class="modal-close toolbar-menu-close btn-icon"
            type="button"
            aria-label="Close Edit menu"
          >
            &times;
          </button>
        </div>
        <div class="toolbar-menu-body">
          <ul class="menu-items-list" id="editMenuItems"></ul>
        </div>
      </div>
    </div>
    <div
      id="designMenuModal"
      class="toolbar-menu-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="Design menu"
      aria-hidden="true"
    >
      <div
        class="modal-overlay toolbar-menu-overlay"
        id="designMenuOverlay"
      ></div>
      <div class="toolbar-menu-content">
        <div class="toolbar-menu-header">
          <span class="toolbar-menu-title">Design</span
          ><button
            class="modal-close toolbar-menu-close btn-icon"
            type="button"
            aria-label="Close Design menu"
          >
            &times;
          </button>
        </div>
        <div class="toolbar-menu-body">
          <ul class="menu-items-list" id="designMenuItems"></ul>
        </div>
      </div>
    </div>
    <div
      id="viewMenuModal"
      class="toolbar-menu-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="View menu"
      aria-hidden="true"
    >
      <div
        class="modal-overlay toolbar-menu-overlay"
        id="viewMenuOverlay"
      ></div>
      <div class="toolbar-menu-content">
        <div class="toolbar-menu-header">
          <span class="toolbar-menu-title">View</span
          ><button
            class="modal-close toolbar-menu-close btn-icon"
            type="button"
            aria-label="Close View menu"
          >
            &times;
          </button>
        </div>
        <div class="toolbar-menu-body">
          <ul class="menu-items-list" id="viewMenuItems"></ul>
        </div>
      </div>
    </div>
    <div
      id="windowMenuModal"
      class="toolbar-menu-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="Window menu"
      aria-hidden="true"
    >
      <div
        class="modal-overlay toolbar-menu-overlay"
        id="windowMenuOverlay"
      ></div>
      <div class="toolbar-menu-content">
        <div class="toolbar-menu-header">
          <span class="toolbar-menu-title">Window</span
          ><button
            class="modal-close toolbar-menu-close btn-icon"
            type="button"
            aria-label="Close Window menu"
          >
            &times;
          </button>
        </div>
        <div class="toolbar-menu-body">
          <ul class="menu-items-list" id="windowMenuItems"></ul>
        </div>
      </div>
    </div>
    <div
      id="helpMenuModal"
      class="toolbar-menu-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="Help menu"
      aria-hidden="true"
    >
      <div
        class="modal-overlay toolbar-menu-overlay"
        id="helpMenuOverlay"
      ></div>
      <div class="toolbar-menu-content">
        <div class="toolbar-menu-header">
          <span class="toolbar-menu-title">Help</span
          ><button
            class="modal-close toolbar-menu-close btn-icon"
            type="button"
            aria-label="Close Help menu"
          >
            &times;
          </button>
        </div>
        <div class="toolbar-menu-body">
          <ul class="menu-items-list" id="helpMenuItems"></ul>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
