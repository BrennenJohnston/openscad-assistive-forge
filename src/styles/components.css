/* Component Styles */

/* Skip Link (Accessibility) */
/* Uses high-contrast blue instead of accent yellow for WCAG AAA compliance */
/* Colors are defined in semantic-tokens.css for theme consistency */
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--color-skip-link-bg);
  color: var(--color-skip-link-text);
  padding: var(--space-sm) var(--space-md);
  text-decoration: none;
  font-weight: 600;
  z-index: var(--z-index-skip-link);
  border-radius: 0 0 var(--border-radius-sm) 0;
}

.skip-link:focus {
  top: 0;
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* Global focus ring for interactive elements that are not `.btn` */
a:focus,
button:focus,
summary:focus,
[role='button']:focus,
[tabindex]:focus,
a:focus-visible,
button:focus-visible,
summary:focus-visible,
[role='button']:focus-visible,
[tabindex]:focus-visible {
  outline: 3px solid var(--color-focus) !important;
  outline-offset: 2px !important;
}

/* ============================================================================
   Shared Control Contract (.forge-control)
   ============================================================================
   Token-first base class for toolbar buttons, drawer toggles, panel collapse
   buttons, and modal close buttons. Applied alongside existing class names so
   JS selectors remain intact.
   ============================================================================ */
.forge-control {
  min-height: var(--size-touch-target);
  min-width: var(--size-touch-target);
  border-radius: var(--border-radius-md);
  padding: var(--space-xs);
  transition:
    background-color var(--motion-base) ease,
    border-color var(--motion-base) ease;
}

.forge-control--sm {
  min-height: var(--size-touch-target-sm);
  min-width: var(--size-touch-target-sm);
}

/* ============================================================================
   Shared Disclosure Contract (.forge-disclosure)
   ============================================================================
   Uniform <details>/<summary> pattern for Presets, Console Output, Reference
   Overlay, Libraries, Companion Files, and Advanced sections. Provides
   consistent chevron animation, spacing, font weight, and focus styling.
   ============================================================================ */
.forge-disclosure {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  margin-block: var(--space-xs);
  overflow: hidden;
  background: var(--color-bg-elevated, var(--color-bg-secondary));
}

.forge-disclosure summary {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  font-size: var(--font-size-sm);
  line-height: 1.4;
  font-weight: var(--font-weight-semibold, 600);
  letter-spacing: normal;
  cursor: pointer;
  min-height: var(--size-touch-target);
  list-style: none;
  transition: background-color var(--motion-base) ease;
}

/* Summary flex layout: label fills space, hide button sits at end before chevron */
.param-group-summary {
  display: flex;
  align-items: center;
}

.param-group-summary > span:first-child {
  flex: 1;
  min-width: 0;
}

/* Hide button on each group header */
.param-group-hide-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.5rem;
  height: 1.5rem;
  padding: 0;
  margin-right: var(--space-xs);
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  background: transparent;
  color: var(--color-text-secondary);
  font-size: 0.75rem;
  line-height: 1;
  cursor: pointer;
  opacity: 0;
  transition:
    opacity var(--motion-base) ease,
    background-color var(--motion-base) ease;
}

.forge-disclosure summary:hover .param-group-hide-btn,
.forge-disclosure summary:focus-within .param-group-hide-btn {
  opacity: 1;
}

.param-group-hide-btn:hover {
  background: var(--color-surface-hover);
  border-color: var(--color-border);
  color: var(--color-text-primary);
}

.param-group-hide-btn:focus-visible {
  opacity: 1;
  outline: 2px solid var(--color-focus-ring);
  outline-offset: 2px;
}

/* "Show all groups" action button */
.param-groups-show-all {
  width: 100%;
  margin-top: var(--space-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  text-align: center;
}

.forge-disclosure summary::-webkit-details-marker {
  display: none;
}

.forge-disclosure summary::after {
  content: '';
  display: inline-block;
  width: 0.5em;
  height: 0.5em;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(-45deg);
  transition: transform var(--motion-base) ease;
  margin-left: auto;
  flex-shrink: 0;
}

.forge-disclosure[open] summary::after {
  transform: rotate(45deg);
}

.forge-disclosure-icon {
  width: 1em;
  height: 1em;
  flex-shrink: 0;
  stroke: currentColor;
  fill: none;
}

.forge-disclosure-title {
  flex: 1;
  min-width: 0;
}

@media (prefers-reduced-motion: reduce) {
  .forge-disclosure summary,
  .forge-disclosure summary::after {
    transition: none;
  }
}

/* Buttons */
.btn {
  padding: var(--space-sm) var(--space-md);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  font-weight: 500;
  transition:
    background-color var(--motion-base),
    transform var(--motion-fast);
  min-height: var(--size-touch-target);
  min-width: var(--size-touch-target);
  /* Default button styling - secondary-like appearance for buttons without color variant */
  background-color: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
}

.btn:hover:not(:disabled) {
  background-color: var(--color-hover-bg);
  border-color: var(--color-text-secondary);
}

/* WCAG 2.2 SC 2.4.13 Focus Appearance: minimum 2px thickness, 3:1 contrast */
.btn:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.btn:focus:not(:focus-visible) {
  outline: none;
}

.btn:focus-visible {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  /* Additional border for increased perimeter size */
  box-shadow:
    0 0 0 1px var(--color-bg-primary),
    0 0 0 4px var(--color-focus);
}

.btn:active {
  transform: translateY(1px);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background-color: var(--color-accent);
  color: var(--color-on-accent);
}

.btn-primary:hover:not(:disabled) {
  background-color: var(--color-accent-hover);
}

.btn-success {
  background-color: var(--color-success);
  color: var(--color-on-success);
}

.btn-success:hover:not(:disabled) {
  background-color: var(--color-success-hover);
}

.btn-secondary {
  background-color: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
}

.btn-secondary:hover:not(:disabled) {
  background-color: var(--color-border);
}

.btn-sm {
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
  min-height: var(--size-touch-target-sm);
}

.btn-with-icon {
  gap: var(--space-xs);
}

.btn-outline {
  background-color: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  color: var(--color-text-primary);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn-outline:hover:not(:disabled) {
  background-color: var(--color-hover-bg);
  border-color: var(--color-text-primary);
}

.btn-large {
  flex: 1;
  padding: var(--space-md) var(--space-lg);
  font-size: var(--font-size-lg);
}

.btn-icon {
  padding: var(--space-xs);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  /* WCAG 2.5.5 Target Size: 44px on touch, 36px on desktop (via --size-touch-target) */
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
  cursor: pointer;
  transition:
    background-color var(--motion-fast),
    border-color var(--motion-fast);
}

/* Small icon button for dense UI areas (e.g., preset controls, color pickers)
   Use sparingly - only where 44px would cause layout issues */
.btn-icon-sm {
  min-width: var(--size-touch-target-sm);
  min-height: var(--size-touch-target-sm);
}

.btn-icon:hover:not(:disabled) {
  background-color: var(--color-bg-secondary);
  border-color: var(--color-accent);
}

.btn-icon:disabled {
  opacity: var(--opacity-disabled);
  cursor: not-allowed;
}

.btn-icon:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* ============================================================================
   Panel Collapse Button - Icon Rotation & States
   ============================================================================ */

#collapseParamPanelBtn svg {
  transition: transform var(--motion-slow) ease;
}

@media (prefers-reduced-motion: reduce) {
  #collapseParamPanelBtn svg {
    transition: none;
  }
}

/* Rotate icon 180° when collapsed to show "expand" direction */
.param-panel.collapsed #collapseParamPanelBtn svg {
  transform: rotate(180deg);
}

/* Desktop only - hide collapse button on mobile (drawer toggle is used instead) */
@media (max-width: 767px) {
  .param-panel .btn-collapse-panel {
    display: none;
  }
}

/* ============================================================================
   Mobile Drawer Toggle Button
   ============================================================================ */

.mobile-only {
  display: none;
}

@media (max-width: 767px) {
  .mobile-only {
    display: inline-flex;
  }
}

#mobileDrawerToggle {
  display: none;
  align-items: center;
  gap: var(--space-xs);
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
}

@media (max-width: 767px) {
  #mobileDrawerToggle {
    display: inline-flex;
  }
}

/* Hide label on very small screens for space efficiency */
@media (max-width: 360px) {
  #mobileDrawerToggle .btn-label {
    display: none;
  }
}

/* ============================================================================
   Preview Drawer Header
   ============================================================================
   Container for the preview settings drawer toggle and mobile params button.
   On mobile, both buttons appear side by side. On desktop, only the drawer
   toggle is visible since the params panel is always visible.
   ============================================================================ */

.preview-drawer-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  height: var(--drawer-header-height);
  min-height: var(--drawer-header-height);
  padding: 0 var(--space-sm);
  background-color: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  gap: var(--space-sm);
}

/* Header layout containers */
.preview-drawer-header-left {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  min-width: 0;
  flex: 1 1 auto;
}

.preview-drawer-header-right {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex: 0 0 auto;
}

.preview-drawer-title {
  margin: 0;
  font-size: var(--font-size-sm);
  font-weight: 600;
  line-height: 1.2;
  color: var(--color-text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Match Camera/Parameters collapse toggle button styling */
.preview-drawer-toggle-btn.btn-collapse-panel {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  border-right: 1px solid var(--color-border); /* override base .btn-collapse-panel */
  flex-shrink: 0;
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
  padding: var(--space-xs);
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.preview-drawer-toggle-btn.btn-collapse-panel svg {
  transition: transform var(--motion-base) ease;
  /* Base icon points left; rotate to point DOWN when collapsed (expand) */
  transform: rotate(90deg);
}

.preview-drawer-toggle-btn.btn-collapse-panel[aria-expanded='true'] svg {
  /* Rotate to point UP when expanded (collapse) */
  transform: rotate(-90deg);
}

@media (prefers-reduced-motion: reduce) {
  .preview-drawer-toggle-btn.btn-collapse-panel svg {
    transition: none;
  }
}

/* Preview drawer toggle now uses shared .btn-collapse-panel styling (see above). */

/* ============================================================================
   Actions Drawer Toggle Button (Mobile)
   ============================================================================
   Toggle button for expanding secondary actions in the actions bar.
   Arrow indicates expand (up) or collapse (down) state.
   ============================================================================ */

.actions-drawer-toggle {
  display: none;
}

@media (max-width: 767px) {
  .actions-drawer-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
    width: 100%;
    min-height: var(--size-touch-target-sm);
    padding: var(--space-xs) var(--space-md);
    background-color: var(--color-bg-tertiary);
    border: none;
    border-bottom: 1px solid var(--color-border);
    cursor: pointer;
    transition: background-color var(--motion-base) ease;
    order: -2; /* Place at top of actions bar */
  }

  .actions-drawer-toggle:hover {
    background-color: var(--color-hover-bg);
  }

  .actions-drawer-toggle:focus-visible {
    outline: 3px solid var(--color-focus);
    outline-offset: -3px;
  }

  .actions-toggle-label {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  .actions-toggle-arrow {
    width: var(--size-icon-sm, 16px);
    height: var(--size-icon-sm, 16px);
    color: var(--color-accent-fg);
    transition: transform var(--motion-slow) ease;
    flex-shrink: 0;
  }

  /* Arrow flips when drawer content is visible */
  .actions-drawer-toggle[aria-expanded='true'] .actions-toggle-arrow {
    transform: rotate(180deg);
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .actions-toggle-arrow {
      transition: none;
    }
  }
}

/* Upload Zone */
.upload-zone {
  display: block;
  text-align: center;
  border: 2px dashed var(--color-border);
  border-radius: var(--border-radius-lg);
  padding: var(--space-xl);
  padding-left: max(var(--space-xl), env(safe-area-inset-left, 0px));
  padding-right: max(var(--space-xl), env(safe-area-inset-right, 0px));
  cursor: pointer;
  transition: all var(--motion-base);
  position: relative;
  outline: none;
}

.upload-zone:hover {
  border-color: var(--color-accent);
  background-color: var(--color-accent-subtle);
}

.upload-zone.drag-over {
  border-color: var(--color-accent);
  background-color: var(--color-hover-bg);
  transform: scale(1.02);
}

.upload-zone:focus,
.upload-zone:focus-within {
  border-color: var(--color-focus);
  box-shadow: var(--focus-ring);
}

.upload-icon {
  margin: 0 auto var(--space-md);
  color: var(--color-text-primary);
}

/* Upload panel — shares box pattern with saved-projects-panel, storage-panel, features-overview */
.upload-panel {
  margin-top: var(--space-xl);
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  overflow: hidden;
  max-width: 100%;
  box-sizing: border-box;
}

.upload-panel h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

.upload-panel > p {
  margin-bottom: var(--space-md);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

[data-high-contrast='true'] .upload-panel {
  border-width: 2px;
}

@media (forced-colors: active) {
  .upload-panel {
    border: 2px solid CanvasText;
  }
}

/* Welcome actions container (upload + start new) */
.welcome-actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  align-items: center;
  max-width: 500px;
  margin: 0 auto;
}

.welcome-divider {
  display: flex;
  align-items: center;
  width: 100%;
  gap: var(--space-md);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

.welcome-divider::before,
.welcome-divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--color-border);
}

.start-new-btn {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-md) var(--space-lg);
  font-size: var(--font-size-base);
}

.start-new-btn:hover {
  background: var(--color-accent);
  color: var(--color-accent-text);
  border-color: var(--color-accent);
}

.upload-text {
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
}

.file-input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

/* Saved Projects Panel */
.saved-projects-panel {
  margin-top: var(--space-xl);
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  /* Prevent content from overflowing on mobile */
  overflow: hidden;
  max-width: 100%;
  box-sizing: border-box;
}

.saved-projects-panel h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

[data-high-contrast='true'] .saved-projects-panel {
  border-width: 2px;
}

.saved-projects-description {
  margin-bottom: var(--space-md);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
}

.saved-projects-list {
  display: grid;
  /* Use min() to ensure columns don't exceed container width on mobile */
  grid-template-columns: repeat(auto-fill, minmax(min(280px, 100%), 1fr));
  gap: var(--space-md);
  margin-bottom: var(--space-md);
  /* Prevent overflow */
  min-width: 0;
  max-width: 100%;
}

.saved-project-card {
  display: flex;
  flex-direction: column;
  padding: var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  /* Match panel border-radius (md = 8px) for visual consistency with surrounding panels */
  border-radius: var(--border-radius-md);
  box-shadow: var(--shadow-sm);
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base),
    transform var(--motion-base);
  cursor: pointer;
  min-width: 0;
  max-width: 100%;
  box-sizing: border-box;
}

.saved-project-card:hover {
  border-color: var(--color-accent);
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.saved-project-card:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.saved-project-header {
  display: flex;
  align-items: start;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  /* Allow content to shrink for text truncation */
  min-width: 0;
}

.saved-project-icon {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  /* Use --color-accent-fg: amber-11 in light (~5.1:1 on white), yellow-9 in dark (~12:1 on dark) */
  color: var(--color-accent-fg);
}

.saved-project-info {
  flex: 1;
  min-width: 0;
}

.saved-project-name {
  font-weight: 600;
  font-size: var(--font-size-md);
  color: var(--color-text-primary);
  margin: 0 0 var(--space-xs) 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.saved-project-meta {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

.saved-project-date {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.saved-project-notes-preview {
  margin: var(--space-sm) 0;
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.saved-project-notes-preview:empty {
  display: none;
}

.saved-project-notes-preview a {
  color: var(--color-accent-fg);
  text-decoration: underline;
  word-break: break-all;
}

.saved-project-notes-preview a:hover {
  color: var(--color-accent-fg);
  text-decoration-thickness: 2px;
}

.saved-project-actions {
  display: flex;
  gap: var(--space-xs);
  margin-top: auto;
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
}

.saved-project-actions .btn {
  flex: 1;
  min-width: 0;
  font-size: var(--font-size-xs);
  padding: var(--space-xs) var(--space-sm);
  min-height: var(--size-touch-target);
}

.saved-projects-empty {
  text-align: center;
  padding: var(--space-xl);
  color: var(--color-text-secondary);
  font-style: italic;
}

.saved-projects-empty.hidden {
  display: none;
}

/* Save Project Modal */
.save-project-modal .modal-body {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.save-project-checkbox-wrapper {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
}

.save-project-checkbox-wrapper input[type='checkbox'] {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.save-project-checkbox-wrapper label {
  cursor: pointer;
  font-weight: 600;
}

.save-project-notes-field {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.save-project-notes-field label {
  font-weight: 600;
  font-size: var(--font-size-sm);
}

.save-project-notes-field textarea {
  min-height: 100px;
  padding: var(--space-sm);
  font-family: inherit;
  font-size: var(--font-size-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  resize: vertical;
}

.save-project-notes-field textarea:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.save-project-notes-counter {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  text-align: right;
}

.save-project-notes-counter.warning {
  color: var(--color-warning);
}

.save-project-notes-counter.error {
  color: var(--color-error);
}

/* Edit Project Modal */
.edit-project-modal .modal-body {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.edit-project-field {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.edit-project-field label {
  font-weight: 600;
  font-size: var(--font-size-sm);
}

.edit-project-field input {
  padding: var(--space-sm);
  font-family: inherit;
  font-size: var(--font-size-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
}

.edit-project-field input:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.edit-project-field textarea {
  min-height: 150px;
  padding: var(--space-sm);
  font-family: inherit;
  font-size: var(--font-size-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  resize: vertical;
}

.edit-project-field textarea:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* Mobile responsive adjustments */
@media (max-width: 767px) {
  .saved-projects-panel {
    /* Reduce padding on mobile for more content space */
    padding: var(--space-md);
  }

  .saved-projects-list {
    grid-template-columns: 1fr;
  }

  .saved-project-actions {
    flex-direction: column;
  }

  .saved-project-actions .btn {
    width: 100%;
  }

  .folder-header {
    /* Reduce padding on mobile */
    padding: var(--space-sm);
  }

  .folder-contents {
    /* Reduce left padding on mobile */
    padding-left: var(--space-sm);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .saved-project-card {
    transition: none;
  }

  .saved-project-card:hover {
    transform: none;
  }
}

/* ============================================================================
   Folder Tree Styles (v2)
   ============================================================================ */

/* Header with actions */
.saved-projects-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
  margin-bottom: var(--space-sm);
  flex-wrap: wrap;
}

.saved-projects-header h3 {
  margin: 0;
}

.saved-projects-actions {
  display: flex;
  gap: var(--space-xs);
  flex-wrap: wrap;
}

.saved-projects-actions .btn {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
}

/* Folder Breadcrumbs */
.folder-breadcrumbs {
  margin-bottom: var(--space-md);
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

.folder-breadcrumbs.hidden {
  display: none;
}

.breadcrumb-list {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-xs);
  margin: 0;
  padding: 0;
  list-style: none;
}

.breadcrumb-item {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.breadcrumb-item:not(:last-child)::after {
  content: '›';
  color: var(--color-text-secondary);
  margin-left: var(--space-xs);
}

.breadcrumb-link {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-xs) var(--space-sm);
  /* amber-11 in light (~5.1:1 on white) / yellow-9 in dark — both pass WCAG AA */
  color: var(--color-accent-fg);
  text-decoration: none;
  font-size: var(--font-size-sm);
  border-radius: var(--border-radius-sm);
  transition: background-color var(--motion-fast);
}

.breadcrumb-link:hover {
  background: var(--color-hover-bg);
  text-decoration: underline;
}

.breadcrumb-link:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.breadcrumb-link.current {
  color: var(--color-text-primary);
  font-weight: 600;
  pointer-events: none;
}

/* Folder Tree Container */
.saved-projects-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  /* Prevent horizontal overflow on narrow viewports */
  min-width: 0;
  overflow: hidden;
}

/* Folder Tree */
.folder-tree {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  /* Prevent horizontal overflow */
  min-width: 0;
}

.folder-tree:empty {
  display: none;
}

/* Folder Item */
.folder-item {
  display: flex;
  flex-direction: column;
  /* Required for proper width constraint in flex container */
  min-width: 0;
}

.folder-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition:
    border-color var(--motion-fast),
    background-color var(--motion-fast);
  min-width: 0;
  overflow: hidden;
}

.folder-header:hover {
  border-color: var(--color-accent);
  background: var(--color-hover-bg);
}

.folder-header:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.folder-header[aria-expanded='true'] {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  border-bottom-color: transparent;
}

.folder-expand-icon {
  flex-shrink: 0;
  width: 16px;
  height: 16px;
  color: var(--color-text-secondary);
  transition: transform var(--motion-fast);
}

.folder-header[aria-expanded='true'] .folder-expand-icon {
  transform: rotate(90deg);
}

.folder-icon {
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  color: var(--color-accent-fg);
}

.folder-name {
  flex: 1;
  font-weight: 600;
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.folder-count {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  background: var(--color-bg-secondary);
  padding: var(--space-2xs) var(--space-sm);
  border-radius: var(--border-radius-pill);
}

.folder-actions {
  display: flex;
  gap: var(--space-xs);
  opacity: 0;
  transition: opacity var(--motion-fast);
}

.folder-header:hover .folder-actions,
.folder-header:focus-within .folder-actions {
  opacity: 1;
}

.folder-actions .btn {
  padding: var(--space-xs);
  min-width: 28px;
  min-height: 28px;
}

/* Folder Contents */
.folder-contents {
  display: none;
  padding: var(--space-md);
  padding-left: var(--space-xl);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-top: none;
  border-bottom-left-radius: var(--border-radius-md);
  border-bottom-right-radius: var(--border-radius-md);
  overflow: hidden;
  min-width: 0;
}

.folder-contents.expanded {
  display: block;
}

.folder-contents .folder-tree,
.folder-contents .saved-projects-list {
  margin-top: var(--space-sm);
}

.folder-contents .saved-projects-list {
  grid-template-columns: repeat(auto-fill, minmax(min(240px, 100%), 1fr));
}

/* Nested folder indentation */
.folder-contents .folder-item {
  margin-left: var(--space-md);
}

/* Folder Context Menu */
.folder-context-menu {
  position: absolute;
  z-index: var(--z-index-modal);
  min-width: 160px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  box-shadow: var(--shadow-lg);
  padding: var(--space-xs);
}

.folder-context-menu-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border: none;
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
  text-align: left;
  cursor: pointer;
  border-radius: var(--border-radius-sm);
  transition: background-color var(--motion-fast);
}

.folder-context-menu-item:hover {
  background: var(--color-hover-bg);
}

.folder-context-menu-item:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.folder-context-menu-item.danger {
  color: var(--color-error);
}

.folder-context-menu-item.danger:hover {
  background: color-mix(in srgb, var(--color-error) 15%, transparent);
}

/* Drag and Drop Feedback */
.folder-item.drag-over > .folder-header {
  border-color: var(--color-accent);
  border-style: dashed;
  background: color-mix(in srgb, var(--color-accent) 10%, transparent);
}

.folder-item.dragging {
  opacity: 0.5;
}

.saved-project-card.dragging {
  opacity: 0.5;
}

.saved-project-card.drag-over {
  border-color: var(--color-accent);
  border-style: dashed;
}

.drop-zone-indicator {
  padding: var(--space-md);
  border: 2px dashed var(--color-border);
  border-radius: var(--border-radius-sm);
  text-align: center;
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-md);
}

.drop-zone-indicator.active {
  border-color: var(--color-accent-fg);
  background: color-mix(in srgb, var(--color-accent) 10%, transparent);
  color: var(--color-accent-fg);
}

/* Folder Color Indicator */
.folder-color-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

/* Smart Cache Clear Dialog Styles */
.cache-clear-dialog {
  max-width: 500px;
}

/* Import mode dialog (merge vs replace) */
.import-mode-dialog {
  max-width: 440px;
  padding: var(--space-lg);
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.import-mode-dialog h3 {
  margin: 0;
  font-size: var(--font-size-lg);
  color: var(--color-text-primary);
}

.import-mode-dialog fieldset {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  padding: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.import-mode-dialog legend {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  padding: 0 var(--space-xs);
  color: var(--color-text-secondary);
}

.import-mode-option {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
  cursor: pointer;
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
}

.import-mode-option input[type='radio'] {
  margin-top: 2px;
  flex-shrink: 0;
}

.import-mode-actions {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
}

.cache-clear-warning {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
  padding: var(--space-md);
  background: color-mix(in srgb, var(--color-warning) 15%, transparent);
  border: 1px solid var(--color-warning);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--space-md);
}

.cache-clear-warning-icon {
  flex-shrink: 0;
  font-size: 1.5rem;
}

.cache-clear-warning-text {
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
}

.cache-clear-sizes {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-md);
  margin-bottom: var(--space-md);
}

.cache-size-item {
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  text-align: center;
}

.cache-size-label {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-xs);
}

.cache-size-value {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
}

.cache-clear-options {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-lg);
}

.cache-clear-option {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
  padding: var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: all var(--motion-fast);
}

.cache-clear-option:hover {
  border-color: var(--color-accent);
}

.cache-clear-option input[type='checkbox'] {
  margin-top: 2px;
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.cache-clear-option-content {
  flex: 1;
}

.cache-clear-option-label {
  font-weight: 600;
  color: var(--color-text-primary);
  margin-bottom: var(--space-xs);
}

.cache-clear-option-desc {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

/* Preservation indicator */
.cache-clear-option.preservation-off .cache-clear-option-label {
  color: var(--color-error);
}

.cache-clear-option.preservation-on .cache-clear-option-label {
  color: var(--color-success);
}

.preservation-indicator {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-xs);
  padding: 2px 8px;
  border-radius: 10px;
  margin-left: var(--space-sm);
}

.preservation-indicator.danger {
  background: color-mix(in srgb, var(--color-error) 15%, transparent);
  color: var(--color-error);
}

.preservation-indicator.safe {
  background: color-mix(in srgb, var(--color-success) 15%, transparent);
  color: var(--color-success);
}

.cache-clear-backup-prompt {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-md);
  background: color-mix(in srgb, var(--color-info) 10%, transparent);
  border: 1px solid var(--color-info);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--space-md);
}

.cache-clear-backup-prompt .btn {
  flex-shrink: 0;
}

/* Project File Manager Modal
 * The outer .preset-modal must NOT have max-width — it is the full-viewport
 * backdrop. Constraining its width pins the overlay to the left edge.
 * Width/sizing is scoped to the inner content box only. */
.file-manager-modal .preset-modal-content {
  width: min(92vw, 800px);
  max-width: 800px;
  max-height: min(90vh, 860px);
  /* Use flex-column so header and footer stay fixed while body scrolls */
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.file-manager-modal .preset-modal-header,
.file-manager-modal .preset-modal-footer {
  flex-shrink: 0;
}

.file-manager-modal .preset-modal-body {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}

/* The file tree renders inside the scrollable body —
 * removing its own overflow/max-height avoids nested scrollbars. */
.file-manager-modal .file-manager-tree {
  max-height: none;
  overflow-y: visible;
  border: none;
  background: transparent;
  border-radius: 0;
}

/* Standalone .file-manager-tree (outside the modal, e.g. inline panel) */
.file-manager-tree {
  max-height: min(60vh, 400px);
  overflow-y: auto;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  background: var(--color-bg-primary);
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}

.file-manager-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  min-height: var(--size-touch-target);
  border-bottom: 1px solid var(--color-border);
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
}

.file-manager-item:last-child {
  border-bottom: none;
}

.file-manager-item:hover {
  background: var(--color-hover-bg);
}

.file-manager-item-icon {
  flex-shrink: 0;
  width: 20px;
  height: 20px;
  color: var(--color-text-secondary);
}

.file-manager-item-icon.main-file {
  color: var(--color-accent-fg);
}

.file-manager-item-path {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: var(--color-text-primary);
}

.file-manager-item-size {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

/* "Main" badge for the primary project file */
.file-manager-main-badge {
  display: inline-block;
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  border-radius: var(--border-radius-sm);
  border: 1px solid transparent;
}

.file-manager-item-actions {
  display: flex;
  gap: var(--space-2xs);
  margin-left: auto;
  flex-shrink: 0;
}

/* Always visible with subdued styling; enhanced on hover */
.file-manager-item-actions .btn-rename-project-file,
.file-manager-item-actions .btn-delete-project-file {
  color: var(--color-text-secondary);
  border-color: var(--color-border-light, var(--color-border));
  background: transparent;
  transition:
    color var(--motion-fast),
    border-color var(--motion-fast),
    background-color var(--motion-fast);
}

.file-manager-item-actions .btn-rename-project-file:hover:not(:disabled),
.file-manager-item-actions .btn-delete-project-file:hover:not(:disabled) {
  color: var(--color-text-primary);
  border-color: var(--color-text-primary);
  background: var(--color-bg-secondary);
}

.file-manager-item-actions .btn-rename-project-file:focus-visible,
.file-manager-item-actions .btn-delete-project-file:focus-visible {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.btn-delete-project-file:hover:not(:disabled),
.btn-delete-project-folder:hover:not(:disabled) {
  background: var(--color-error-bg, rgba(220, 53, 69, 0.1));
  color: var(--color-error);
  border-color: var(--color-error);
}

.btn-delete-project-file:disabled {
  color: var(--color-text-tertiary);
  border-color: var(--color-border-light, var(--color-border));
  cursor: not-allowed;
}

/* Nested folder grouping in file manager */
.file-manager-folder {
  border-bottom: 1px solid var(--color-border);
}

.file-manager-folder:last-child {
  border-bottom: none;
}

.file-manager-folder-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  min-height: var(--size-touch-target);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold, 600);
  cursor: pointer;
  list-style: none;
  color: var(--color-text-primary);
  background: var(--color-bg-secondary);
}

.file-manager-folder-header::-webkit-details-marker {
  display: none;
}

.file-manager-folder-header:hover {
  background: var(--color-hover-bg);
}

.file-manager-folder-icon {
  flex-shrink: 0;
  color: var(--color-accent-fg);
}

.file-manager-folder-name {
  flex: 1;
  color: var(--color-text-primary);
}

.file-manager-folder-count {
  font-size: var(--font-size-xs);
  font-weight: 400;
  color: var(--color-text-secondary);
}

.file-manager-folder-contents {
  padding-left: var(--space-md);
}

.file-manager-folder-contents .file-manager-item {
  padding-left: var(--space-lg);
}

.file-manager-folder-actions {
  display: flex;
  gap: var(--space-2xs);
  margin-left: auto;
}

/* Always visible with subdued styling; enhanced on hover */
.file-manager-folder-actions .btn-icon {
  color: var(--color-text-secondary);
  border-color: var(--color-border-light, var(--color-border));
  background: transparent;
  transition:
    color var(--motion-fast),
    border-color var(--motion-fast),
    background-color var(--motion-fast);
}

.file-manager-folder-actions .btn-icon:hover:not(:disabled) {
  color: var(--color-text-primary);
  border-color: var(--color-text-primary);
  background: var(--color-bg-secondary);
}

.file-manager-folder-actions .btn-icon:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.file-manager-empty-folder {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  padding: var(--space-sm) var(--space-lg);
  font-style: italic;
}

/* High Contrast Mode - File Manager */
:root[data-high-contrast='true'] .file-manager-item {
  border-width: 2px;
}

:root[data-high-contrast='true'] .file-manager-folder {
  border-width: 2px;
}

:root[data-high-contrast='true'] .file-manager-folder-header {
  font-weight: 700;
}

:root[data-high-contrast='true'] .file-manager-main-badge {
  font-weight: 700;
  border: 2px solid var(--color-accent-text);
}

:root[data-high-contrast='true']
  .file-manager-item-actions
  .btn-rename-project-file,
:root[data-high-contrast='true']
  .file-manager-item-actions
  .btn-delete-project-file,
:root[data-high-contrast='true'] .file-manager-folder-actions .btn-icon {
  border-width: 2px;
  color: var(--color-text-primary);
  border-color: var(--color-text-primary);
}

:root[data-high-contrast='true']
  .file-manager-item-actions
  .btn-rename-project-file:focus-visible,
:root[data-high-contrast='true']
  .file-manager-item-actions
  .btn-delete-project-file:focus-visible,
:root[data-high-contrast='true']
  .file-manager-folder-actions
  .btn-icon:focus-visible {
  outline-width: 4px;
}

/* Reduced Motion - File Manager */
@media (prefers-reduced-motion: reduce) {
  .file-manager-item-actions .btn-rename-project-file,
  .file-manager-item-actions .btn-delete-project-file,
  .file-manager-folder-actions .btn-icon,
  .file-manager-item {
    transition: none;
  }
}

/* Forced Colors Mode (Windows High Contrast) - File Manager */
@media (forced-colors: active) {
  .file-manager-item {
    border-color: CanvasText;
    color: CanvasText;
  }

  .file-manager-item-icon,
  .file-manager-item-icon.main-file {
    color: CanvasText;
  }

  .file-manager-item-path,
  .file-manager-folder-name {
    color: CanvasText;
  }

  .file-manager-item-size,
  .file-manager-folder-count {
    color: GrayText;
  }

  .file-manager-main-badge {
    background: Highlight;
    color: HighlightText;
    border: 1px solid HighlightText;
  }

  .file-manager-folder {
    border-color: CanvasText;
  }

  .file-manager-folder-header {
    background: Canvas;
    color: CanvasText;
  }

  .file-manager-folder-icon {
    color: CanvasText;
  }

  .file-manager-empty-folder {
    color: GrayText;
  }

  .file-manager-item-actions .btn-rename-project-file,
  .file-manager-item-actions .btn-delete-project-file,
  .file-manager-folder-actions .btn-icon {
    border: 1px solid ButtonText;
    color: ButtonText;
    background: ButtonFace;
  }

  .btn-delete-project-file:hover:not(:disabled),
  .btn-delete-project-folder:hover:not(:disabled) {
    border-color: ButtonText;
    color: ButtonText;
    background: ButtonFace;
  }

  .btn-delete-project-file:disabled {
    color: GrayText;
    border-color: GrayText;
  }

  .file-manager-item-actions .btn-rename-project-file:focus-visible,
  .file-manager-item-actions .btn-delete-project-file:focus-visible,
  .file-manager-folder-actions .btn-icon:focus-visible {
    outline: 2px solid Highlight;
    outline-offset: 2px;
  }
}

.file-manager-toolbar {
  display: flex;
  gap: var(--space-sm);
  padding: var(--space-md) 0;
}

/* Persistence Status Indicator */
.persistence-status {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-xs);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
}

.persistence-status.persistent {
  background: color-mix(in srgb, var(--color-success) 15%, transparent);
  color: var(--color-success);
}

.persistence-status.not-persistent {
  background: color-mix(in srgb, var(--color-warning) 15%, transparent);
  color: var(--color-warning);
}

.persistence-status-icon {
  width: 12px;
  height: 12px;
}

/* Mobile responsive adjustments for folder tree */
@media (max-width: 767px) {
  .saved-projects-header {
    flex-direction: column;
    align-items: stretch;
  }

  .saved-projects-actions {
    justify-content: flex-end;
  }

  .saved-projects-actions .btn .btn-text {
    display: none;
  }

  .folder-contents {
    padding-left: var(--space-md);
  }

  .folder-contents .folder-item {
    margin-left: var(--space-sm);
  }

  .folder-contents .saved-projects-list {
    grid-template-columns: 1fr;
  }

  .folder-actions {
    opacity: 1;
  }

  .cache-clear-sizes {
    grid-template-columns: 1fr;
  }
}

@media (prefers-reduced-motion: reduce) {
  .folder-header,
  .folder-expand-icon,
  .folder-actions {
    transition: none;
  }
}

.examples-section {
  margin-top: var(--space-xl);
  padding-top: var(--space-xl);
  padding-left: max(0px, env(safe-area-inset-left, 0px));
  padding-right: max(0px, env(safe-area-inset-right, 0px));
  border-top: 1px solid var(--color-border);
}

.examples-section p {
  margin-bottom: var(--space-md);
  color: var(--color-text-secondary);
}

.preview-settings-panel {
  margin: var(--space-sm) 0;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
}

.preview-settings-header {
  padding: var(--space-sm) var(--space-md);
  user-select: text;
  font-weight: 600;
  font-size: var(--font-size-sm);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  transition: background-color var(--motion-base) ease;
}

.preview-settings-header:hover {
  background-color: var(--color-bg-primary);
}

.preview-settings-header:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.settings-icon {
  font-size: 1rem;
}

.preview-settings {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md);
  padding-top: var(--space-sm);
}

.preview-setting {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.preview-setting.cache-tools {
  flex-basis: 100%;
  justify-content: space-between;
}

.preview-setting.cache-tools .btn {
  margin-left: auto;
}

.preview-setting-label {
  margin-right: var(--space-xs);
}

.preview-setting-divider {
  border-top: 1px solid var(--color-border);
  margin: var(--space-xs) 0;
}

.preview-settings-subheading {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-secondary);
  display: block;
  margin-bottom: var(--space-2xs);
}

.preview-settings select {
  min-height: 36px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--color-border);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  padding: 0 var(--space-sm);
}

.preview-settings input[type='checkbox'] {
  width: 18px;
  height: 18px;
}

/* Preview settings divider (used before engine toggle) */
.preview-setting-divider {
  flex-basis: 100%;
  height: 1px;
  background-color: var(--color-border);
  margin: var(--space-xs) 0;
}

/* Grid size setting group */
.preview-setting-group {
  flex-basis: 100%;
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  padding-top: var(--space-xs);
}

.preview-setting-group-label {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.preview-setting-inline {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-sm);
}

.preview-setting-inline span {
  min-width: 6rem;
  color: var(--color-text-primary);
}

.preview-setting-inline select,
.preview-setting-inline input[type='number'] {
  flex: 1;
  min-width: 0;
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-surface-raised);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

.preview-setting-inline input[type='number'] {
  width: 5rem;
}

/* Preview setting hint text (used for engine toggle explanation) */
.preview-setting-hint {
  flex-basis: 100%;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  margin: 0;
  padding-left: calc(18px + var(--space-xs)); /* Align with checkbox label */
  line-height: 1.4;
}

/* High contrast mode: ensure hint is visible */
:root[data-high-contrast='true'] .preview-setting-hint {
  color: var(--color-text-primary);
}

/* Rotation speed slider setting - full width layout within preview settings */
.preview-setting.rotation-speed-setting {
  flex-basis: 100%;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: var(--space-xs);
}

.preview-setting.rotation-speed-setting .preview-setting-label {
  margin-right: 0;
}

/* Ensure slider value uses tabular figures for stable width */
.preview-setting.rotation-speed-setting .slider-value {
  min-width: 4.5rem;
  font-variant-numeric: tabular-nums;
}

/* High contrast mode - thicker slider track and enhanced focus */
:root[data-high-contrast='true']
  .preview-setting.rotation-speed-setting
  .slider-container
  input[type='range'] {
  height: 8px;
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

:root[data-high-contrast='true']
  .preview-setting.rotation-speed-setting
  .slider-value {
  font-weight: 700;
}

.update-banner {
  position: sticky;
  top: 0;
  z-index: var(--z-index-sticky);
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-sm) var(--space-md);
}

.update-banner.hidden {
  display: none;
}

.update-banner-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-md);
  flex-wrap: wrap;
}

.update-banner-text {
  color: var(--color-text-primary);
  font-weight: 600;
}

.update-banner-actions {
  display: inline-flex;
  align-items: center;
  gap: var(--space-sm);
}

/* Model Color Picker */
.model-color-setting {
  flex-basis: 100%;
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-xs);
}

.model-color-picker {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
}

.model-color-picker input[type='color'] {
  width: 44px;
  height: 32px;
  padding: var(--space-2xs);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  cursor: pointer;
  transition: border-color var(--motion-base);
}

.model-color-picker input[type='color']:hover {
  border-color: var(--color-accent);
}

.model-color-picker input[type='color']:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.model-color-picker .btn-icon {
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-secondary);
  font-size: var(--size-icon-sm);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: all var(--motion-base);
}

.model-color-picker .btn-icon:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-accent);
  color: var(--color-text-primary);
}

.model-color-picker .btn-icon:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

/* Reference Overlay Controls */
.overlay-details {
  /* Card styling provided by .forge-disclosure */
}

.overlay-summary {
  /* Inherits layout from .forge-disclosure summary */
}

.overlay-summary:hover {
  background-color: var(--color-bg-primary);
}

.overlay-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.overlay-details[open] .overlay-summary {
  border-bottom: 1px solid var(--color-border);
}

.overlay-summary-icon {
  font-size: var(--font-size-base);
}

.overlay-summary-text {
  flex: 1;
  font-weight: var(--font-weight-semibold, 600);
}

.overlay-status {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
}

.overlay-status.active {
  color: var(--color-success);
  background: var(--color-success-bg, rgba(76, 175, 80, 0.1));
}

.overlay-controls {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  padding: var(--space-md);
  padding-top: var(--space-sm);
}

.overlay-control {
  display: flex;
  flex-direction: column;
  gap: var(--space-2xs);
}

.overlay-control-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.overlay-source-row {
  display: flex;
  gap: var(--space-xs);
  align-items: stretch;
}

.overlay-select {
  flex: 1;
  min-width: 0;
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  min-height: var(--size-touch-target-sm);
}

.overlay-select:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.overlay-select option,
.measure-image-select option,
.measure-unit-select option {
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
}

.overlay-upload-btn {
  flex-shrink: 0;
  white-space: nowrap;
  cursor: pointer;
}

.overlay-upload-btn:hover {
  background: var(--color-hover-bg);
}

.overlay-dimensions-display {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
}

.overlay-dimensions-value {
  font-weight: 500;
  color: var(--color-text-primary);
}

.overlay-enable-toggle {
  margin: 0;
}

.overlay-opacity-control .slider-container,
.overlay-rotation-control .slider-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.overlay-opacity-control input[type='range'],
.overlay-rotation-control input[type='range'] {
  flex: 1;
  min-width: 100px;
}

.overlay-color-row {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.overlay-color-row input[type='color'] {
  width: 32px;
  height: 28px;
  padding: 1px;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm, 4px);
  background: transparent;
  cursor: pointer;
}

.overlay-auto-color-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-2xs);
  font-size: var(--font-size-sm);
  margin: 0;
  cursor: pointer;
}

.overlay-fit-buttons {
  flex-direction: row;
  gap: var(--space-xs);
}

.overlay-fit-buttons .btn {
  flex: 1;
}

.overlay-advanced-details {
  margin-top: var(--space-xs);
}

.overlay-advanced-summary {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: var(--space-xs) 0;
  min-height: var(--size-touch-target-sm);
  display: flex;
  align-items: center;
}

.overlay-advanced-summary:hover {
  color: var(--color-accent-fg);
}

.overlay-advanced-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.overlay-advanced-controls {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  padding: var(--space-sm) 0;
}

.overlay-size-row,
.overlay-offset-row {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.overlay-size-field,
.overlay-offset-field {
  display: flex;
  align-items: center;
  gap: var(--space-2xs);
  flex: 1;
}

.overlay-size-field input,
.overlay-offset-field input {
  width: 100%;
  max-width: 80px;
  padding: var(--space-xs);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  text-align: right;
}

.overlay-size-field input:focus,
.overlay-offset-field input:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.overlay-size-field span,
.overlay-offset-field span {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  min-width: 1ch;
}

.overlay-aspect-lock {
  width: 32px;
  height: 32px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.overlay-aspect-lock[aria-pressed='false'] {
  opacity: 0.5;
}

.overlay-aspect-lock:hover {
  opacity: 1;
}

/* -----------------------------------------------------------------------
   Image Measurement Tool
   ----------------------------------------------------------------------- */

.measure-details {
  /* Card styling provided by .forge-disclosure */
}

.measure-summary {
  /* Inherits layout from .forge-disclosure summary */
}

.measure-summary:hover {
  background-color: var(--color-bg-primary);
}

.measure-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.measure-details[open] .measure-summary {
  border-bottom: 1px solid var(--color-border);
}

.measure-controls {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  padding: var(--space-md);
  padding-top: var(--space-sm);
}

.measure-source-row {
  display: flex;
  gap: var(--space-xs);
  align-items: stretch;
}

.measure-upload-btn {
  flex-shrink: 0;
  white-space: nowrap;
  cursor: pointer;
}

.measure-upload-btn:hover {
  background: var(--color-hover-bg);
}

.measure-info-row {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.measure-dim-display {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-family: var(--font-family-mono);
}

.measure-canvas-container {
  width: 100%;
  height: 240px;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  overflow: hidden;
  background: var(--color-bg-secondary);
  position: relative;
}

.measure-canvas {
  width: 100%;
  height: 100%;
  cursor: crosshair;
  display: block;
}

.measure-canvas:focus {
  outline: var(--focus-ring-width, 3px) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset, -3px);
}

.measure-canvas.drag-over {
  outline: 2px dashed var(--color-accent);
  outline-offset: -2px;
}

.measure-coord-row {
  display: flex;
  gap: var(--space-sm);
}

.measure-coord-pair {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex: 1;
}

.measure-coord-label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-secondary);
  min-width: 1.5ch;
}

.measure-coord-value {
  font-family: var(--font-family-mono);
  font-size: var(--font-size-base);
  color: var(--color-text-primary);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-2xs) var(--space-xs);
  min-width: 4ch;
  text-align: right;
}

.measure-copy-btn {
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
  font-size: var(--font-size-sm);
  white-space: nowrap;
}

.measure-zoom-row {
  display: flex;
  align-items: center;
  gap: var(--space-2xs);
  margin-left: auto;
}

.measure-zoom-btn {
  min-width: 28px;
  min-height: 28px;
  font-size: var(--font-size-base);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.measure-zoom-input {
  width: 4.5em;
  font-size: var(--font-size-sm);
  font-family: var(--font-family-mono);
  color: var(--color-text-primary);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-2xs) var(--space-xs);
  text-align: center;
  min-height: 28px;
  -moz-appearance: textfield;
}

.measure-zoom-input::-webkit-inner-spin-button,
.measure-zoom-input::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.measure-zoom-input:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 1px;
}

/* Manifest info banner */
.manifest-info-banner {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-accent);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--space-sm);
  font-size: var(--font-size-sm);
  flex-wrap: wrap;
}
.manifest-info-text {
  flex: 1;
  min-width: 0;
}
.manifest-info-banner .btn-icon {
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
}

.measure-image-select,
.measure-unit-select {
  font-size: var(--font-size-sm);
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target-sm);
}
.measure-image-select {
  flex: 1;
  min-width: 0;
}
.measure-image-select:focus,
.measure-unit-select:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}
.measure-unit-select {
  width: auto;
  margin-left: auto;
}

.overlay-unit-row {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-wrap: wrap;
}
.overlay-unit-select {
  font-size: var(--font-size-sm);
  padding: var(--space-2xs) var(--space-xs);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target);
}
.overlay-scale-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}
.overlay-scale-input {
  width: 5em;
  font-size: var(--font-size-sm);
  padding: var(--space-2xs) var(--space-xs);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target);
}

.measure-help-text {
  font-size: var(--font-size-xs);
  color: var(--color-text-tertiary);
  margin: 0;
  line-height: 1.4;
}

.measure-pin-indicator {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-accent-fg);
  white-space: nowrap;
}

/* Toolbar: mode buttons + zoom controls on one line */
.measure-toolbar {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-wrap: wrap;
}

.measure-mode-row {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}
.measure-mode-btn {
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
  font-size: var(--font-size-sm);
  border-radius: var(--border-radius-sm);
  transition:
    background-color 0.15s,
    color 0.15s;
}
.measure-mode-btn.active {
  background-color: var(--color-accent);
  color: var(--color-on-accent, #fff);
  border-color: var(--color-accent);
}
.measure-mode-btn:focus-visible {
  outline: var(--focus-ring-width, 3px) solid var(--color-focus);
  outline-offset: 2px;
}

/* Distance readout row (Ruler mode) */
.measure-dist-row {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}
.measure-dist-row label {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-secondary);
  min-width: 5ch;
}
.measure-dist-row output {
  font-family: var(--font-family-mono);
  font-size: var(--font-size-base);
  color: var(--color-text-primary);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-2xs) var(--space-xs);
  min-width: 6ch;
  text-align: right;
}

/* Calibration input row (Calibrate mode) */
.measure-calib-row {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-wrap: wrap;
}
.measure-calib-row span:first-child {
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}
.measure-calib-row input[type='number'] {
  width: 5em;
  font-size: var(--font-size-sm);
  padding: var(--space-2xs) var(--space-xs);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target);
}
.measure-calib-error {
  font-size: var(--font-size-xs);
  color: var(--color-error, #e53e3e);
  font-weight: var(--font-weight-semibold, 600);
}

/* Scale & unit settings section (below canvas) */
.measure-scale-section {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

/* Scale factor row */
.measure-scale-row {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}
.measure-scale-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  white-space: nowrap;
}
.measure-scale-input {
  width: 5em;
  font-size: var(--font-size-sm);
  padding: var(--space-2xs) var(--space-xs);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target);
}
.measure-scale-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-tertiary);
}

/* Fullscreen expansion for Image Measurement */
.measure-controls.measure-fullscreen {
  position: fixed;
  inset: 0;
  z-index: var(--z-index-modal, 1000);
  background: var(--color-bg-primary);
  padding: var(--space-lg);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}
.measure-controls.measure-fullscreen .measure-canvas-container {
  height: auto;
  flex: 1;
  min-height: 0;
}
.measure-fullscreen-backdrop {
  position: fixed;
  inset: 0;
  z-index: calc(var(--z-index-modal, 1000) - 1);
  background: rgba(12, 12, 12, 0.55);
  backdrop-filter: blur(6px);
}
.measure-fullscreen-close {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  z-index: 1;
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
}
@media (prefers-reduced-motion: reduce) {
  .measure-fullscreen-backdrop {
    backdrop-filter: none;
  }
}

/* High Contrast Mode - Measurement Tool */
:root[data-high-contrast='true'] .measure-canvas-container {
  border-width: 2px;
}

:root[data-high-contrast='true'] .measure-zoom-input {
  border-width: 2px;
  font-weight: 600;
}

:root[data-high-contrast='true'] .measure-scale-section {
  border-width: 2px;
}

:root[data-high-contrast='true'] .measure-mode-btn {
  border-width: 2px;
}

/* Forced Colors Mode (Windows High Contrast) - Measurement Tool */
@media (forced-colors: active) {
  .measure-canvas {
    border-color: ButtonText;
  }
  .measure-coord-value {
    background: Canvas;
    color: CanvasText;
    border-color: ButtonText;
  }
  .measure-pin-indicator {
    color: Highlight;
  }
  .measure-mode-btn.active {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight;
  }
  .measure-dist-row output {
    background: Canvas;
    color: CanvasText;
    border-color: ButtonText;
  }
  .measure-calib-error {
    color: LinkText;
  }
  .measure-zoom-input {
    background: Canvas;
    color: CanvasText;
    border: 1px solid ButtonText;
  }
  .measure-scale-section {
    background: Canvas;
    border-color: CanvasText;
    color: CanvasText;
  }
  .measure-canvas-container {
    border-color: ButtonText;
  }
}

/* Responsive: measurement tool rows on narrow screens */
@media (max-width: 767px) {
  .measure-toolbar {
    flex-wrap: wrap;
  }
  .measure-zoom-row {
    margin-left: 0;
    flex-basis: 100%;
  }
  .measure-mode-row {
    flex-wrap: wrap;
  }
  .measure-dist-row {
    flex-wrap: wrap;
  }
  .measure-scale-row {
    flex-wrap: wrap;
  }
  .measure-scale-hint {
    flex-basis: 100%;
  }
}

.example-buttons {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

@media (min-width: 768px) {
  .example-buttons {
    flex-direction: row;
    flex-wrap: wrap;
  }
}

/* Parameter Controls */
.param-group {
  margin-bottom: var(--space-lg);
}

.param-group summary {
  /* Inherits layout from .forge-disclosure summary; only overrides listed */
  user-select: none;
}

.param-group summary:focus-visible {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.param-control {
  margin-bottom: var(--space-md);
  padding: var(--space-sm);
  /* Smooth transitions for dependency visibility */
  transition:
    opacity var(--motion-slow) ease,
    max-height var(--motion-slow) ease,
    margin var(--motion-slow) ease,
    padding var(--motion-slow) ease;
  /* overflow:visible so help tooltips are not clipped */
  overflow: visible;
}

/* Hidden state for dependent parameters */
.param-control[aria-hidden='true'] {
  opacity: 0;
  max-height: 0;
  margin: 0;
  padding: 0;
  pointer-events: none;
  overflow: hidden;
}

/* Reduced motion: instant show/hide */
@media (prefers-reduced-motion: reduce) {
  .param-control {
    transition: none;
  }
}

.param-description {
  display: none;
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  font-style: italic;
}

.param-control label {
  display: block;
  font-weight: 500;
  margin-bottom: var(--space-xs);
  color: var(--color-text-primary);
}

/* Help Tooltip Styles */
.param-label-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

/* --- Parameter Detail Level Modes ---------------------------------------- */

/* Show Details: description on a new line below the label */
[data-detail-level='show'] .param-label-container {
  flex-wrap: wrap;
}

[data-detail-level='show'] .param-description {
  display: block;
  flex-basis: 100%;
  order: 99;
  margin-top: var(--space-2xs);
}

[data-detail-level='show'] .param-help-wrapper {
  display: none;
}

/* Inline Details: description inline next to the label */
[data-detail-level='inline'] .param-description {
  display: inline;
}

[data-detail-level='inline'] .param-help-wrapper {
  display: none;
}

/* Hide Details: description hidden, tooltip-only (default behavior) */
[data-detail-level='hide'] .param-description {
  display: none;
}

/* Description Only: description replaces label when description exists */
[data-detail-level='desc-only']
  .param-label-container[data-has-description]
  > label,
[data-detail-level='desc-only']
  .param-label-container[data-has-description]
  > .param-label-text {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

[data-detail-level='desc-only'] .param-description {
  display: inline;
  font-style: normal;
  font-weight: 500;
  color: var(--color-text-primary);
}

[data-detail-level='desc-only'] .param-help-wrapper {
  display: none;
}

/* Detail level dropdown in param search bar */
.param-detail-wrapper {
  flex-shrink: 0;
}

.param-detail-select {
  min-height: var(--size-touch-target);
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
  border: 1px solid var(--color-input-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  cursor: pointer;
}

.param-detail-select:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.param-help-wrapper {
  position: relative;
  display: inline-block;
}

.param-help-button {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: none;
  font-size: var(--font-size-2xs);
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition:
    background-color var(--motion-base),
    transform var(--motion-fast);
  flex-shrink: 0;
}

.param-help-button:hover {
  background: var(--color-accent-hover);
  transform: scale(1.1);
}

.param-help-button:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.param-help-button:active {
  transform: scale(0.95);
}

.param-help-button[aria-expanded='true'] {
  background: var(--color-accent-hover);
}

.param-tooltip {
  position: absolute;
  top: calc(100% + var(--space-sm));
  left: 50%;
  transform: translateX(-50%);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-sm) var(--space-md);
  max-width: 280px;
  min-width: 200px;
  font-size: var(--font-size-sm);
  line-height: 1.4;
  color: var(--color-text-primary);
  box-shadow: var(--shadow-md);
  z-index: var(--z-index-modal);
  white-space: normal;
  word-wrap: break-word;
}

.param-tooltip::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-bottom-color: var(--color-border);
}

.param-tooltip::after {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 5px solid transparent;
  border-bottom-color: var(--color-bg-secondary);
  margin-bottom: calc(var(--space-2xs) / 2);
}

/* High Contrast Mode Adjustments for Tooltips */
body.high-contrast .param-help-button {
  border: 2px solid currentColor;
}

body.high-contrast .param-tooltip {
  border-width: 2px;
}

/* Dark Mode Adjustments for Tooltips */
@media (prefers-color-scheme: dark) {
  .param-tooltip {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  }
}

/* Mobile Adjustments for Tooltips */
@media (max-width: 767px) {
  .param-tooltip {
    position: fixed;
    left: 16px;
    right: 16px;
    top: auto;
    bottom: calc(env(safe-area-inset-bottom, 16px) + 16px);
    width: auto;
    max-width: none;
    transform: none;
    font-size: var(--font-size-base);
  }

  .param-tooltip::before,
  .param-tooltip::after {
    display: none;
  }
}

.param-unit {
  color: var(--color-text-secondary);
  font-weight: normal;
  font-size: var(--font-size-sm);
  margin-left: var(--space-xs);
}

/* Range Slider */
.slider-container {
  display: flex;
  align-items: center;
  gap: var(--space-md);
}

.slider-container input[type='range'] {
  flex: 1;
  height: 6px;
  border-radius: var(--border-radius-xs);
  background: var(--color-bg-secondary);
  outline: none;
}

.slider-container input[type='range']:focus {
  box-shadow: var(--focus-ring);
}

.slider-container input[type='range']:focus:not(:focus-visible) {
  box-shadow: none;
}

.slider-container input[type='range']:focus-visible {
  box-shadow: var(--focus-ring);
}

.slider-value {
  min-width: 60px;
  text-align: right;
  font-weight: 600;
  color: var(--color-text-primary);
}

/* Slider Spinbox - Editable numeric input paired with slider
 * Users need precise value entry alongside slider
 * This allows precise pixel value entry (0-10000 range) alongside slider */
.slider-spinbox {
  width: 80px;
  min-width: 80px;
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  font-variant-numeric: tabular-nums;
  text-align: right;
  -moz-appearance: textfield; /* Hide spinner in Firefox by default */
}

/* Show spinner on focus/hover for discoverability */
.slider-spinbox:hover,
.slider-spinbox:focus {
  -moz-appearance: auto;
}

.slider-spinbox::-webkit-inner-spin-button,
.slider-spinbox::-webkit-outer-spin-button {
  opacity: 0; /* Hidden by default */
}

.slider-spinbox:hover::-webkit-inner-spin-button,
.slider-spinbox:hover::-webkit-outer-spin-button,
.slider-spinbox:focus::-webkit-inner-spin-button,
.slider-spinbox:focus::-webkit-outer-spin-button {
  opacity: 1; /* Show on interaction */
}

.slider-spinbox:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

/* Unit label for slider spinbox */
.slider-unit {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
  min-width: 25px;
}

/* High contrast mode - enhanced visibility */
@media (prefers-contrast: more) {
  .slider-spinbox {
    border-width: 2px;
    border-color: var(--color-text);
  }
}

:root[data-high-contrast='true'] .slider-spinbox {
  border-width: 2px;
  font-weight: 600;
}

:root[data-high-contrast='true'] .slider-unit {
  font-weight: 600;
  color: var(--color-text);
}

/* Out-of-range value indicator for spinbox */
.param-control.out-of-range .slider-spinbox {
  color: var(--color-warning);
  font-weight: 600;
}

/* Limits unlocked indicator for spinbox */
.param-control.limits-unlocked .slider-spinbox {
  border-color: var(--color-warning);
  box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.2);
}

/* Mobile responsiveness - stack on small screens */
@media (max-width: 480px) {
  .slider-container {
    flex-wrap: wrap;
  }

  .slider-container input[type='range'] {
    flex-basis: 100%;
    order: 1;
  }

  .slider-spinbox {
    flex: 1;
    min-width: 60px;
    order: 2;
  }

  .slider-unit {
    order: 3;
  }

  .param-default-value {
    order: 4;
    flex-basis: 100%;
    text-align: center;
    margin-top: var(--space-xs);
  }
}

/* Number Input Container with Unit */
.number-input-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.number-input-container input[type='number'] {
  flex: 1;
}

/* Unit Label */
.unit-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
  min-width: 30px;
  text-align: left;
}

/* High contrast mode for unit labels */
body.high-contrast .unit-label {
  font-weight: 600;
  color: var(--color-text);
}

/* Number Input */
input[type='number'] {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
}

input[type='number']:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

input[type='number']:focus:not(:focus-visible) {
  box-shadow: none;
  border-color: var(--color-border);
}

input[type='number']:focus-visible {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

/* Select Dropdown */
select {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  min-height: var(--size-touch-target);
}

select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

select:focus:not(:focus-visible) {
  box-shadow: none;
  border-color: var(--color-border);
}

select:focus-visible {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

/* Toggle Switch */
.toggle-switch {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.toggle-switch input[type='checkbox'] {
  width: 48px;
  height: 28px;
  appearance: none;
  background-color: var(--color-border);
  border-radius: var(--border-radius-pill);
  position: relative;
  cursor: pointer;
  transition: background-color var(--motion-base);
}

.toggle-switch input[type='checkbox']:focus {
  box-shadow: var(--focus-ring);
}

.toggle-switch input[type='checkbox']:focus:not(:focus-visible) {
  box-shadow: none;
}

.toggle-switch input[type='checkbox']:focus-visible {
  box-shadow: var(--focus-ring);
}

.toggle-switch input[type='checkbox']::before {
  content: '';
  position: absolute;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background-color: white;
  top: 2px;
  left: 2px;
  transition: transform var(--motion-base);
}

.toggle-switch input[type='checkbox']:checked {
  background-color: var(--color-success);
}

.toggle-switch input[type='checkbox']:checked::before {
  transform: translateX(20px);
}

.toggle-label {
  font-weight: normal;
  color: var(--color-text-secondary);
}

/* Progress Indicator */
.progress-bar {
  width: 100%;
  height: 4px;
  background-color: var(--color-bg-secondary);
  border-radius: var(--border-radius-xs);
  overflow: hidden;
  margin-top: var(--space-sm);
}

.progress-fill {
  height: 100%;
  background-color: var(--color-accent);
  transition: width var(--motion-slow);
}

/* Loading Spinner */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid var(--color-bg-secondary);
  border-top-color: var(--color-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* Processing Overlay — shown during long operations (ZIP extraction, etc.) */
.processing-overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(12, 12, 12, 0.75);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  color: var(--color-text-primary, #fff);
  gap: var(--space-md, 12px);
  animation: fadeInOverlay 0.15s ease-out;
}

@keyframes fadeInOverlay {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.processing-overlay .processing-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid var(--color-bg-secondary, #333);
  border-top-color: var(--color-accent, #f4c400);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.processing-overlay .processing-message {
  font-size: 1.1rem;
  font-weight: 600;
  text-align: center;
}

.processing-overlay .processing-hint {
  font-size: 0.85rem;
  opacity: 0.7;
  text-align: center;
  max-width: 340px;
}

/* ========================================
   Auto-Preview Indicator Styles (v1.2)
   ======================================== */

/* Preview container wrapper */
.preview-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}

/* Preview state indicator badge */
.preview-state-indicator {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  font-weight: 500;
  z-index: 10;
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  transition: all var(--motion-slow) ease;
}

/* State: Idle - no preview yet */
.preview-state-indicator.state-idle {
  background-color: var(--color-bg-secondary);
  color: var(--color-text-secondary);
}

/* State: Current - preview matches parameters */
.preview-state-indicator.state-current {
  background-color: var(--color-success);
  color: var(--color-on-success);
}

/* State: Pending - parameter changed, render scheduled */
.preview-state-indicator.state-pending {
  background-color: var(--color-warning);
  color: var(--color-on-warning);
  animation: pulse-pending 1.5s ease-in-out infinite;
}

/* State: Rendering - preview render in progress */
.preview-state-indicator.state-rendering {
  background-color: var(--color-accent);
  color: var(--color-on-accent);
}

/* State: Stale - preview outdated */
.preview-state-indicator.state-stale {
  background-color: var(--color-warning-hover);
  color: var(--color-on-warning);
}

/* State: Error - render failed */
.preview-state-indicator.state-error {
  background-color: var(--color-error-bg);
  color: var(--color-text-primary);
  border: 1px solid var(--color-error);
}

/* Pulse animation for pending state */
@keyframes pulse-pending {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.02);
  }
}

/* Preview border states */
.preview-container {
  transition:
    border-color var(--motion-slow) ease,
    box-shadow var(--motion-slow) ease;
}

.preview-container.preview-pending {
  border: 2px solid var(--color-warning);
  box-shadow: 0 0 8px var(--color-warning);
}

.preview-container.preview-stale {
  border: 2px solid var(--color-warning);
  box-shadow: 0 0 8px var(--color-warning);
}

.preview-container.preview-rendering {
  border: 2px solid var(--color-accent);
  animation: border-pulse 1s ease-in-out infinite;
}

.preview-container.preview-current {
  border: 2px solid var(--color-success);
}

.preview-container.preview-error {
  border: 2px solid var(--color-error);
}

@keyframes border-pulse {
  0%,
  100% {
    box-shadow: var(--focus-ring);
  }
  50% {
    box-shadow: 0 0 0 4px var(--color-focus);
  }
}

/* Rendering overlay */
.preview-rendering-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 20;
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--motion-slow) ease;
}

.preview-rendering-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

.preview-rendering-overlay .spinner-large {
  width: 48px;
  height: 48px;
  border-width: 4px;
}

.preview-rendering-overlay .rendering-text {
  margin-top: var(--space-md);
  color: white;
  font-size: var(--font-size-base);
  font-weight: 500;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

/* Auto-preview toggle in settings */
.auto-preview-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm) 0;
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-md);
}

.auto-preview-toggle label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

/* Quality indicator */
.quality-indicator {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-left: var(--space-xs);
}

.quality-indicator.preview-quality {
  color: var(--color-warning);
}

.quality-indicator.full-quality {
  color: var(--color-success);
}

/* Stats with quality info */
.stats-quality {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
}

.stats-quality.preview {
  background-color: var(--color-warning-bg);
  color: var(--color-warning-text);
}

.stats-quality.full {
  background-color: var(--color-success-bg);
  color: var(--color-success-text);
}

/* Complexity tier indicator */
.complexity-indicator {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-sm);
  padding: var(--space-xs) 0;
}

.complexity-tier-label {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-2xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  font-weight: 500;
  font-size: var(--font-size-xs);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.complexity-tier-label.tier-beginner {
  background-color: var(--color-success-bg);
  color: var(--color-success-text);
}

.complexity-tier-label.tier-standard {
  background-color: var(--color-info-bg);
  color: var(--color-info-text);
}

.complexity-tier-label.tier-complex {
  background-color: var(--color-warning-bg);
  color: var(--color-warning-text);
}

/* Dark theme overrides for complexity indicator - now handled by semantic tokens */
[data-theme='dark'] .complexity-tier-label.tier-beginner {
  background-color: var(--color-success-bg);
  color: var(--color-success-text);
}

[data-theme='dark'] .complexity-tier-label.tier-standard {
  background-color: var(--color-info-bg);
  color: var(--color-info-text);
}

[data-theme='dark'] .complexity-tier-label.tier-complex {
  background-color: var(--color-warning-bg);
  color: var(--color-warning-text);
}

/* Responsive adjustments */
@media (prefers-reduced-motion: reduce) {
  .preview-state-indicator.state-pending,
  .preview-container.preview-rendering {
    animation: none;
  }

  @keyframes pulse-pending {
    0%,
    100% {
      opacity: 1;
    }
  }

  @keyframes border-pulse {
    0%,
    100% {
      box-shadow: var(--focus-ring);
    }
  }
}

/* File Tree (ZIP Projects) */
.file-tree {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  max-height: 200px;
  overflow-y: auto;
  scrollbar-gutter: stable;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

.preset-modal-content::-webkit-scrollbar,
.file-tree::-webkit-scrollbar {
  width: 8px;
}

.preset-modal-content::-webkit-scrollbar-track,
.file-tree::-webkit-scrollbar-track {
  background: transparent;
}

.preset-modal-content::-webkit-scrollbar-thumb,
.file-tree::-webkit-scrollbar-thumb {
  background-color: var(--color-border);
  border-radius: var(--border-radius-sm);
  border: 2px solid transparent;
  background-clip: content-box;
}

.preset-modal-content::-webkit-scrollbar-thumb:hover,
.file-tree::-webkit-scrollbar-thumb:hover {
  background-color: var(--color-text-secondary);
}

/* Dark mode scrollbar contrast */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .preset-modal-content,
  :root:not([data-theme='light']) .file-tree {
    scrollbar-color: var(--color-border) transparent;
  }

  :root:not([data-theme='light'])
    .preset-modal-content::-webkit-scrollbar-thumb,
  :root:not([data-theme='light']) .file-tree::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
  }

  :root:not([data-theme='light'])
    .preset-modal-content::-webkit-scrollbar-thumb:hover,
  :root:not([data-theme='light']) .file-tree::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-text-secondary);
  }
}

:root[data-theme='dark'] .preset-modal-content,
:root[data-theme='dark'] .file-tree {
  scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
}

:root[data-theme='dark'] .preset-modal-content::-webkit-scrollbar-thumb,
:root[data-theme='dark'] .file-tree::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.35);
}

:root[data-theme='dark'] .preset-modal-content::-webkit-scrollbar-thumb:hover,
:root[data-theme='dark'] .file-tree::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255, 255, 255, 0.5);
}

.file-tree-header {
  font-weight: 600;
  margin-bottom: var(--space-xs);
  padding-bottom: var(--space-xs);
  border-bottom: 1px solid var(--color-border);
  font-family: var(--font-family-base);
}

.file-tree-item {
  padding: var(--space-2xs) 0;
  padding-left: var(--space-md);
  color: var(--color-text-secondary);
}

.file-tree-item.main {
  font-weight: 600;
  color: var(--color-text-primary);
}

.file-tree-badge {
  display: inline-block;
  padding: var(--space-2xs) var(--space-xs);
  margin-left: var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  font-size: var(--font-size-2xs);
  border-radius: var(--border-radius-xs);
  font-weight: 600;
  font-family: var(--font-family-base);
}

/* Format Selector */
.format-selector {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
  flex-wrap: wrap;
}

.format-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  white-space: nowrap;
}

.format-select {
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  cursor: pointer;
  min-height: var(--size-touch-target);
  min-width: 200px;
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.format-select:hover {
  border-color: var(--color-accent);
}

.format-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.format-info {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-style: italic;
  flex: 1;
  min-width: 200px;
}

/* High contrast mode adjustments for format selector */
:root[data-high-contrast='true'] .format-select {
  border-width: 2px;
}

@media (max-width: 767px) {
  .format-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .format-select,
  .format-info {
    width: 100%;
  }
}

/* Output Format Section (Left Panel) */
.output-format-section {
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
}

.output-format-label {
  display: block;
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-xs);
}

.output-format-select {
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  cursor: pointer;
  min-height: var(--size-touch-target);
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.output-format-select:hover {
  border-color: var(--color-accent);
}

.output-format-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.output-format-info {
  display: block;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-style: italic;
  margin-top: var(--space-xs);
}

/* High contrast mode adjustments for output format */
:root[data-high-contrast='true'] .output-format-select {
  border-width: 2px;
}

/* 2D Format Guidance (SVG/DXF -- laser cutting workflows) */
.format-2d-guidance {
  margin-top: var(--space-md);
  padding: var(--space-md);
  background: var(--color-info-bg, rgba(33, 150, 243, 0.1));
  border: 1px solid var(--color-info-border, var(--color-accent));
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
}

.format-2d-guidance.hidden {
  display: none;
}

.format-2d-guidance .guidance-title {
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-xs) 0;
}

.format-2d-guidance .guidance-text {
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-sm) 0;
  line-height: 1.5;
}

.format-2d-guidance .guidance-text code {
  background: var(--color-bg-tertiary, var(--color-bg-primary));
  padding: 0.125em 0.375em;
  border-radius: var(--border-radius-xs);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 0.9em;
}

.format-2d-guidance .guidance-details {
  margin-top: var(--space-sm);
}

.format-2d-guidance .guidance-details summary {
  cursor: pointer;
  color: var(--color-accent-text, var(--color-accent));
  font-weight: 500;
}

.format-2d-guidance .guidance-details summary:hover {
  text-decoration: underline;
}

.format-2d-guidance .guidance-details ul {
  margin: var(--space-sm) 0 0 var(--space-md);
  padding: 0;
  list-style: disc;
}

.format-2d-guidance .guidance-details li {
  margin-bottom: var(--space-xs);
  color: var(--color-text-secondary);
}

.format-2d-guidance .guidance-details code {
  background: var(--color-bg-tertiary, var(--color-bg-primary));
  padding: 0.125em 0.375em;
  border-radius: var(--border-radius-xs);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 0.9em;
}

/* Preset Controls */
.preset-controls {
  /* Card styling provided by .forge-disclosure */
}

.preset-summary {
  /* Inherits layout from .forge-disclosure summary */
}

.preset-summary:hover {
  background-color: var(--color-bg-primary);
}

.preset-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.preset-icon {
  /* Icon sizing now provided by .forge-disclosure-icon */
}

.preset-content {
  padding: var(--space-md);
  padding-top: 0;
}

.preset-controls[open] .preset-summary {
  border-bottom: 1px solid var(--color-border);
  margin-bottom: var(--space-sm);
}

.preset-sort-toolbar {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-sm);
  margin-bottom: var(--space-xs);
}

.preset-actions {
  display: flex;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  flex-wrap: wrap;
}

.preset-selector {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.preset-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  white-space: nowrap;
}

.preset-select {
  flex: 1;
  min-width: 200px;
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  cursor: pointer;
  min-height: 36px;
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.preset-select:hover {
  border-color: var(--color-accent);
}

.preset-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.preset-select:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Preset Controls - OpenSCAD Customizer-style button group (Save, Add, Delete)
 * Match OpenSCAD Customizer semantics exactly */
.preset-selector .preset-actions-group {
  display: flex;
  gap: 2px;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  overflow: hidden;
  background: var(--color-bg-secondary);
}

.preset-selector .preset-actions-group .btn-icon {
  border: none;
  border-radius: 0;
  background: transparent;
  /* Use smaller touch target for dense preset button group */
  min-width: var(--size-touch-target-sm);
  min-height: 36px;
  padding: var(--space-xs);
  font-size: var(--font-size-base);
  transition:
    background-color var(--motion-fast),
    color var(--motion-fast);
}

.preset-selector .preset-actions-group .btn-icon:not(:last-child) {
  border-right: 1px solid var(--color-border);
}

.preset-selector .preset-actions-group .btn-icon:hover:not(:disabled) {
  background: var(--color-bg-tertiary);
}

.preset-selector .preset-actions-group .btn-icon:focus {
  outline: none;
  box-shadow: inset 0 0 0 2px var(--color-focus);
}

.preset-selector .preset-actions-group .btn-icon:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Delete button danger style */
.preset-selector .preset-actions-group .btn-danger-icon:hover:not(:disabled) {
  background: var(--color-error-bg, #fee);
  color: var(--color-error);
}

/* Dirty indicator: asterisk on save button when preset has unsaved changes (desktop OpenSCAD parity) */
#savePresetBtn[data-dirty='true']::after {
  content: ' *';
  color: var(--color-warning, #e67e22);
  font-weight: bold;
}

/* Preset actions row - now for Import / Export button */
.preset-actions {
  display: flex;
  gap: var(--space-sm);
  margin-top: var(--space-sm);
  flex-wrap: wrap;
}

/* High contrast mode adjustments for presets */
:root[data-high-contrast='true'] .preset-selector .preset-actions-group {
  border-width: 2px;
}

:root[data-high-contrast='true']
  .preset-selector
  .preset-actions-group
  .btn-icon {
  font-weight: 600;
}

:root[data-high-contrast='true'] .preset-controls {
  border-width: 2px;
}

:root[data-high-contrast='true'] .overlay-details {
  border-width: 2px;
}

:root[data-high-contrast='true'] .preset-select {
  border-width: 2px;
}

:root[data-high-contrast='true'] .preset-sort-select {
  border-width: 2px;
}

/* Preset Management Modal */
.preset-modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-index-modal);
  padding: var(--space-md);
  padding-top: calc(var(--space-md) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--space-md) + env(safe-area-inset-bottom, 0px));
  padding-left: calc(var(--space-md) + env(safe-area-inset-left, 0px));
  padding-right: calc(var(--space-md) + env(safe-area-inset-right, 0px));
}

/* Base Modal (shared) */
.modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-index-modal);
  padding: var(--space-md);
  padding-top: calc(var(--space-md) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--space-md) + env(safe-area-inset-bottom, 0px));
  padding-left: calc(var(--space-md) + env(safe-area-inset-left, 0px));
  padding-right: calc(var(--space-md) + env(safe-area-inset-right, 0px));
}

.modal-overlay {
  position: absolute;
  inset: 0;
  background: rgba(12, 12, 12, 0.55);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

@supports not (
  (backdrop-filter: blur(6px)) or (-webkit-backdrop-filter: blur(6px))
) {
  .modal-overlay {
    background: rgba(12, 12, 12, 0.7);
  }
}

.modal-content {
  position: relative;
  z-index: 1;
  max-height: min(90vh, 900px);
  overflow: auto;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-lg);
  border: 2px solid var(--color-border);
  padding: var(--space-lg);
  background: var(--color-bg-primary);
}

body.first-visit-blocking #app {
  filter: blur(4px);
  pointer-events: none;
  user-select: none;
}

.preset-modal-content {
  background: var(--color-bg-primary);
  border-radius: var(--border-radius-lg);
  padding: var(--space-lg);
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  scrollbar-gutter: stable;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  box-shadow: var(--shadow-lg);
  border: 2px solid var(--color-border);
}

.preset-modal-header,
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-sm);
  border-bottom: 2px solid var(--color-border);
}

.preset-modal-title {
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0;
}

.preset-modal-close,
.modal-close {
  background: transparent;
  border: none;
  font-size: var(--font-size-lg);
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: var(--space-xs);
  line-height: 1;
  min-width: var(--size-touch-target-sm);
  min-height: var(--size-touch-target-sm);
  border-radius: var(--border-radius-sm);
}

.preset-modal-close:hover,
.modal-close:hover {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
}

.preset-modal-close:focus,
.modal-close:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.preset-list-toolbar {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) 0 var(--space-sm);
  border-bottom: 1px solid var(--color-border);
  margin-bottom: var(--space-sm);
}

.preset-sort-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  white-space: nowrap;
}

.preset-sort-select {
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-surface-raised);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.preset-sort-select:hover {
  border-color: var(--color-accent);
}

.preset-sort-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.preset-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.preset-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  gap: var(--space-md);
}

.preset-item-info {
  flex: 1;
  min-width: 0;
}

.preset-item-name {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  margin: 0 0 var(--space-xs) 0;
  word-break: break-word;
}

.preset-item-meta {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
}

.preset-item-actions {
  display: flex;
  gap: var(--space-xs);
  flex-shrink: 0;
}

.preset-empty {
  text-align: center;
  padding: var(--space-xl);
  color: var(--color-text-secondary);
  font-style: italic;
}

.preset-modal-footer {
  display: flex;
  gap: var(--space-sm);
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
  flex-wrap: wrap;
}

/* Preset Compatibility Warning */
.preset-compat-section {
  margin: var(--space-md) 0;
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

.preset-compat-section h4 {
  margin: 0 0 var(--space-xs) 0;
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.preset-compat-section p {
  margin: 0 0 var(--space-xs) 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.preset-compat-list {
  margin: var(--space-xs) 0 0 0;
  padding-left: var(--space-md);
  font-size: var(--font-size-sm);
}

.preset-compat-list li {
  margin-bottom: var(--space-2xs);
}

.preset-compat-list code {
  font-family: var(--font-family-mono);
  font-size: var(--font-size-2xs);
  background: var(--color-bg-primary);
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-xs);
}

.preset-compat-note {
  margin-top: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-info-bg, rgba(33, 150, 243, 0.1));
  border-left: 3px solid var(--color-info, #2196f3);
  border-radius: var(--border-radius-xs);
  font-size: var(--font-size-sm);
}

/* Confirm Dialog (COGA compliant) */
.confirm-modal .confirm-modal-content {
  max-width: 420px;
}

.confirm-modal-body {
  padding: var(--space-md) 0;
}

.confirm-modal-body p {
  margin: 0;
  line-height: 1.6;
  color: var(--color-text-primary);
}

.confirm-modal .preset-form-actions {
  justify-content: flex-end;
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
}

/* Missing Dependencies Dialog -- shows when design package is missing include/use/import files */
.missing-deps-modal .missing-deps-content {
  max-width: 520px;
}

.missing-deps-body {
  padding: var(--space-md) 0;
}

.missing-deps-body p {
  margin: 0 0 var(--space-sm) 0;
  line-height: 1.6;
  color: var(--color-text-primary);
}

.missing-deps-list {
  list-style: none;
  padding: 0;
  margin: var(--space-sm) 0;
  max-height: 200px;
  overflow-y: auto;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

.missing-dep-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-xs) var(--space-sm);
  border-bottom: 1px solid var(--color-border);
  font-family: var(--font-family-mono, monospace);
  font-size: var(--font-size-sm);
}

.missing-dep-item:last-child {
  border-bottom: none;
}

.missing-dep-file {
  color: var(--color-error);
  font-weight: 500;
}

.missing-dep-type {
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
}

.missing-deps-hint {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  background: var(--color-info-bg, rgba(33, 150, 243, 0.1));
  padding: var(--space-sm);
  border-radius: var(--border-radius-sm);
  border-left: 3px solid var(--color-info, #2196f3);
}

.missing-deps-hint code {
  background: var(--color-bg-tertiary);
  padding: 0.1em 0.3em;
  border-radius: var(--border-radius-xs);
  font-size: 0.9em;
}

/* Resolved state — file was added by user */
.missing-dep-resolved .missing-dep-file {
  color: var(--color-success, #38a169);
  text-decoration: line-through;
}

.missing-dep-resolved::after {
  content: '✓';
  color: var(--color-success, #38a169);
  font-weight: 700;
  margin-left: var(--space-xs);
}

/* Added files counter */
.missing-deps-added {
  margin-top: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: color-mix(
    in srgb,
    var(--color-success, #38a169) 12%,
    transparent
  );
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-success, #38a169);
}

.missing-deps-modal .preset-form-actions {
  justify-content: flex-end;
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
  gap: var(--space-sm);
  flex-wrap: wrap;
}

/* Console Output Panel -- displays ECHO, WARNING, ERROR messages from OpenSCAD */
.console-panel {
  /* Card styling provided by .forge-disclosure */
}

.console-summary {
  /* Inherits layout from .forge-disclosure summary */
  font-weight: 600;
}

.console-title {
  flex: 1;
}

.console-badge {
  background: var(--color-accent);
  color: var(--color-on-accent);
  font-size: var(--font-size-xs);
  font-weight: 600;
  padding: 0.15em 0.5em;
  border-radius: var(--border-radius-pill);
  min-width: 1.5em;
  text-align: center;
}

.console-badge.has-warnings {
  background: var(--color-warning);
  color: var(--color-on-warning, #000);
}

.console-badge.hidden {
  display: none;
}

.console-content {
  padding: var(--space-sm);
  border-top: 1px solid var(--color-border);
}

.console-controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--color-border);
}

.console-filter {
  display: flex;
  align-items: center;
  gap: var(--space-xxs);
  font-size: var(--font-size-sm);
  cursor: pointer;
}

.console-filter input[type='checkbox'] {
  margin: 0;
}

.console-actions {
  display: flex;
  gap: 2px;
  margin-left: auto;
}

.console-output {
  max-height: 200px;
  overflow-y: auto;
  font-family: var(--font-family-mono, monospace);
  font-size: var(--font-size-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-xs);
}

.console-empty {
  color: var(--color-text-secondary);
  font-style: italic;
  padding: var(--space-sm);
  text-align: center;
}

.console-entry {
  display: flex;
  gap: var(--space-sm);
  padding: var(--space-xxs) var(--space-xs);
  border-bottom: 1px solid var(--color-border);
  line-height: 1.4;
}

.console-entry:last-child {
  border-bottom: none;
}

.console-timestamp {
  color: var(--color-text-tertiary);
  flex-shrink: 0;
  font-size: 0.85em;
}

.console-type {
  font-weight: 600;
  flex-shrink: 0;
  min-width: 4em;
}

.console-entry--echo .console-type {
  color: var(--color-info, #2196f3);
}

.console-entry--warning .console-type {
  color: var(--color-warning);
}

.console-entry--error .console-type {
  color: var(--color-error);
}

.console-entry--info .console-type {
  color: var(--color-text-secondary);
}

.console-message {
  flex: 1;
  word-break: break-word;
}

.console-entry--warning {
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.1));
}

.console-entry--error {
  background: var(--color-error-bg, rgba(244, 67, 54, 0.1));
}

/* High contrast mode for console */
:root[data-high-contrast='true'] .console-output {
  border-width: 2px;
}

:root[data-high-contrast='true'] .console-entry--warning,
:root[data-high-contrast='true'] .console-entry--error {
  border-left: 3px solid currentColor;
}

/* Mobile responsiveness */
@media (max-width: 480px) {
  .console-controls {
    flex-direction: column;
    align-items: flex-start;
  }

  .console-actions {
    margin-left: 0;
    margin-top: var(--space-xs);
  }

  .console-timestamp {
    display: none; /* Save space on mobile */
  }
}

/* File Actions Panel — REMOVED (features now in File toolbar menu) */

/* ---- Error Log Panel ---------------------------------------------------- */

.error-log-panel {
  /* Card styling provided by .forge-disclosure */
}

.error-log-summary {
  font-weight: 600;
}

.error-log-title {
  flex: 1;
}

.error-log-badge {
  background: var(--color-error);
  color: var(--color-error-text);
  font-size: var(--font-size-xs);
  font-weight: 600;
  padding: 0.15em 0.5em;
  border-radius: var(--border-radius-pill);
  min-width: 1.5em;
  text-align: center;
}

.error-log-badge.has-errors {
  background: var(--color-error);
}

.error-log-badge.hidden {
  display: none;
}

.error-log-content {
  padding: var(--space-sm);
  border-top: 1px solid var(--color-border);
}

.error-log-controls {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  padding-bottom: var(--space-sm);
  border-bottom: 1px solid var(--color-border);
}

.error-log-filter {
  display: flex;
  align-items: center;
  gap: var(--space-xxs);
  font-size: var(--font-size-sm);
  cursor: pointer;
}

.error-log-filter input[type='checkbox'] {
  margin: 0;
}

.error-log-actions {
  display: flex;
  gap: 2px;
  margin-left: auto;
}

.error-log-output {
  max-height: 250px;
  overflow-y: auto;
  font-family: var(--font-family-mono, monospace);
  font-size: var(--font-size-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

.error-log-empty {
  color: var(--color-text-secondary);
  font-style: italic;
  padding: var(--space-sm);
  text-align: center;
}

.error-log-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
}

.error-log-table thead {
  position: sticky;
  top: 0;
  z-index: var(--z-index-sticky, 10);
  background: var(--color-bg-secondary);
}

.error-log-table th {
  text-align: left;
  padding: var(--space-xs) var(--space-sm);
  border-bottom: var(--border-width-base) solid var(--color-border);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.error-log-table th:nth-child(1) {
  width: 5.5em;
}
.error-log-table th:nth-child(2) {
  width: 8em;
}
.error-log-table th:nth-child(3) {
  width: 4em;
}

.error-log-sort-btn {
  background: none;
  border: none;
  font: inherit;
  font-weight: 600;
  cursor: pointer;
  padding: var(--space-2xs) 0;
  color: var(--color-text-primary);
}

.error-log-sort-btn:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.error-log-sort-btn[aria-sort='ascending']::after {
  content: ' ↑';
}

.error-log-sort-btn[aria-sort='descending']::after {
  content: ' ↓';
}

.error-log-row {
  border-bottom: 1px solid var(--color-border);
}

.error-log-row:last-child {
  border-bottom: none;
}

.error-log-row td {
  padding: var(--space-xs) var(--space-sm);
  vertical-align: top;
  font-size: var(--font-size-sm);
  line-height: 1.4;
}

.error-log-row--error {
  background: var(--color-error-bg, rgba(244, 67, 54, 0.08));
}

.error-log-row--warning {
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.08));
}

.error-log-type-badge {
  display: inline-block;
  padding: 0.1em 0.4em;
  border-radius: var(--border-radius-xs);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

.error-log-type-badge--error {
  background: var(--color-error-bg, rgba(244, 67, 54, 0.15));
  color: var(--color-error);
}

.error-log-type-badge--warning {
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.15));
  color: var(--color-warning);
}

.error-log-type-badge--deprecated {
  background: var(--color-info-bg, rgba(33, 150, 243, 0.12));
  color: var(--color-info);
}

.error-log-type-badge--trace {
  color: var(--color-text-secondary);
}

.error-log-cell--message {
  word-break: break-word;
}

.error-log-line-link {
  background: none;
  border: none;
  font: inherit;
  color: var(--color-accent-fg);
  cursor: pointer;
  text-decoration: underline;
  padding: 0;
  min-height: auto;
  min-width: auto;
}

.error-log-line-link:hover {
  color: var(--color-accent-fg);
  text-decoration-thickness: 2px;
}

.error-log-line-link:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

:root[data-high-contrast='true'] .error-log-output {
  border-width: 2px;
}

:root[data-high-contrast='true'] .error-log-row--error,
:root[data-high-contrast='true'] .error-log-row--warning {
  border-left: 3px solid currentColor;
}

@media (max-width: 480px) {
  .error-log-controls {
    flex-direction: column;
    align-items: flex-start;
  }

  .error-log-actions {
    margin-left: 0;
    margin-top: var(--space-xs);
  }

  .error-log-table th:nth-child(2),
  .error-log-row td:nth-child(2) {
    display: none;
  }
}

/* Edit Tools Panel — REMOVED (features now in Edit toolbar menu) */

/* Design Tools Panel — REMOVED (features now in Design toolbar menu)
   Styles for design-validity-status, design-geometry-info, and design-ast
   modal are kept below since the toolbar menu still uses them. */

.design-validity-status {
  font-size: var(--font-size-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  min-height: 0;
  transition: background-color var(--motion-base);
}

.design-validity-status:empty {
  display: none;
}

.design-validity-status[data-state='valid'] {
  background: var(--color-success-bg);
  color: var(--color-success);
}

.design-validity-status[data-state='invalid'] {
  background: var(--color-error-bg);
  color: var(--color-error);
}

.design-geometry-info {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.design-geometry-dl {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--space-2xs) var(--space-md);
  margin: 0;
}

.design-geometry-dl dt {
  font-weight: 600;
  color: var(--color-text-primary);
}

.design-geometry-dl dd {
  margin: 0;
  font-variant-numeric: tabular-nums;
}

.design-ast-heading {
  font-size: var(--font-size-lg);
  font-weight: 600;
  margin: 0 0 var(--space-md);
}

.design-ast-content {
  max-height: 60vh;
  overflow: auto;
  background: var(--color-bg-secondary);
  padding: var(--space-md);
  border-radius: var(--border-radius-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  white-space: pre-wrap;
  word-break: break-word;
}

.design-ast-close {
  margin-top: var(--space-md);
  min-height: var(--size-touch-target);
}

/* Display Options Panel — REMOVED (features now in View toolbar menu) */

/* ---- Animation Panel & Controls ----------------------------------------- */

.animation-panel-body {
  padding: var(--space-sm);
}

.anim-controls {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.anim-controls-row {
  display: flex;
  gap: var(--space-sm);
  align-items: center;
}

.anim-btn {
  min-height: var(--size-touch-target);
  flex: 1;
}

.anim-label {
  font-size: var(--font-size-xs);
  font-weight: 600;
  color: var(--color-text-secondary);
  white-space: nowrap;
}

.anim-input {
  width: 4.5em;
  min-height: var(--size-touch-target);
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
  border: 1px solid var(--color-input-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
}

.anim-input:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.anim-t-display {
  font-size: var(--font-size-sm);
  font-family: var(--font-family-mono);
  font-variant-numeric: tabular-nums;
  color: var(--color-text-secondary);
}

/* ---- Camera Copy Values Grid -------------------------------------------- */

.camera-copy-values {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-xs);
}

/* Save Preset Form */
.preset-form {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.preset-form-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.preset-form-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

.preset-form-input,
.preset-form-textarea {
  padding: var(--space-sm) var(--space-md);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  min-height: 44px;
}

.preset-form-textarea {
  min-height: 80px;
  resize: vertical;
}

.preset-form-input:focus,
.preset-form-textarea:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.preset-form-hint {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-style: italic;
}

.preset-form-actions {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
  flex-wrap: wrap;
}

@media (max-width: 767px) {
  .preset-modal {
    padding: var(--space-sm);
    padding-top: calc(var(--space-sm) + env(safe-area-inset-top, 0px));
    padding-bottom: calc(var(--space-sm) + env(safe-area-inset-bottom, 0px));
    padding-left: calc(var(--space-sm) + env(safe-area-inset-left, 0px));
    padding-right: calc(var(--space-sm) + env(safe-area-inset-right, 0px));
  }

  .preset-modal-content {
    padding: var(--space-md);
    max-height: 90vh;
  }

  .preset-item {
    flex-direction: column;
    align-items: stretch;
  }

  .preset-item-actions {
    justify-content: flex-end;
  }

  .preset-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .preset-select {
    width: 100%;
  }
}

/* Dimensions Display */
.dimensions-display {
  margin-top: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

.dimensions-display.hidden {
  display: none;
}

.dimensions-heading {
  margin: 0 0 var(--space-sm) 0;
  font-size: var(--font-size-base);
  font-weight: 600;
  color: var(--color-text-primary);
}

.dimensions-list {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-sm);
  margin: 0;
}

.dimension-item {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  padding: var(--space-xs) 0;
}

.dimension-item dt {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  font-weight: 500;
}

.dimension-item dd {
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
  margin: 0;
  font-weight: 600;
  font-family: var(--font-family-mono);
}

/* Mobile: stack dimensions vertically */
@media (max-width: 767px) {
  .dimensions-list {
    grid-template-columns: 1fr;
  }
}

/* ========================================
   Comparison View
   ======================================== */

.comparison-container {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: var(--space-md);
  padding-top: calc(var(--space-md) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--space-md) + env(safe-area-inset-bottom, 0px));
  padding-left: calc(var(--space-md) + env(safe-area-inset-left, 0px));
  padding-right: calc(var(--space-md) + env(safe-area-inset-right, 0px));
  background: var(--color-bg-primary);
  overflow: hidden;
}

.comparison-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-md);
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-md);
  border-bottom: 2px solid var(--color-border);
}

.comparison-header h2 {
  margin: 0;
  font-size: var(--font-size-xl);
  color: var(--color-text-primary);
}

.comparison-controls {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.comparison-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: var(--space-md);
  flex: 1;
  overflow-y: auto;
  padding: var(--space-sm);
  scrollbar-gutter: stable;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* WebKit scrollbar dark mode contrast */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .comparison-grid::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
  }

  :root:not([data-theme='light'])
    .comparison-grid::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-text-secondary);
  }
}

:root[data-theme='dark'] .comparison-grid::-webkit-scrollbar-thumb {
  background-color: rgba(255, 255, 255, 0.35);
}

:root[data-theme='dark'] .comparison-grid::-webkit-scrollbar-thumb:hover {
  background-color: rgba(255, 255, 255, 0.5);
}

/* Dark mode scrollbar contrast (Firefox) */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme='light']) .comparison-grid {
    scrollbar-color: var(--color-border) transparent;
  }
}

:root[data-theme='dark'] .comparison-grid {
  scrollbar-color: rgba(255, 255, 255, 0.4) transparent;
}

.comparison-empty-state {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
  text-align: center;
}

/* Variant Card */
.variant-card {
  display: flex;
  flex-direction: column;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--motion-base);
}

.variant-card:hover {
  box-shadow: var(--shadow-md);
}

.variant-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.variant-name-input {
  flex: 1;
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  background: transparent;
  border: none;
  border-bottom: 2px solid transparent;
  padding: var(--space-xs);
  transition: border-color var(--motion-base);
}

.variant-name-input:hover {
  border-bottom-color: var(--color-border);
}

.variant-name-input:focus {
  outline: none;
  border-bottom-color: var(--color-accent);
}

.variant-actions {
  display: flex;
  gap: var(--space-xs);
}

/* Comparison View variant action buttons - scoped to avoid duplicating base .btn-icon */
.variant-actions .btn-icon {
  background: var(--color-bg-primary);
  border-radius: var(--border-radius-sm);
  font-size: var(--size-icon-md);
  cursor: pointer;
  transition: all var(--motion-base);
}

.variant-actions .btn-icon:hover:not(:disabled) {
  background: var(--color-accent);
  border-color: var(--color-accent);
  /* Note: scale(1.1) removed to avoid unexpected motion for users
     preferring reduced motion. Use color change only for hover feedback. */
}

.variant-actions .btn-icon:disabled {
  opacity: var(--opacity-disabled);
  cursor: not-allowed;
}

/* Variant Preview */
.variant-preview {
  position: relative;
  width: 100%;
  height: 300px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--space-sm);
  overflow: hidden;
}

/* Variant Status */
.variant-status {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  align-items: center;
  padding: var(--space-sm);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
}

.status-label {
  font-weight: 600;
}

.status-stats {
  color: var(--color-text-secondary);
  font-family: var(--font-family-mono);
}

.status-error {
  color: var(--color-error);
  font-weight: 500;
}

/* Variant States */
.variant-state-pending .status-label {
  color: var(--color-text-secondary);
}

.variant-state-rendering .status-label {
  color: var(--color-text-primary);
  animation: pulse 1.5s ease-in-out infinite;
}

.variant-state-complete {
  border-color: var(--color-success);
}

.variant-state-complete .status-label {
  color: var(--color-success);
}

.variant-state-error {
  border-color: var(--color-error);
  background: rgba(220, 53, 69, 0.1);
}

.variant-state-error .status-label {
  color: var(--color-error);
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

/* Responsive Design */
@media (max-width: 1200px) {
  .comparison-grid {
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  }
}

@media (max-width: 767px) {
  .comparison-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .comparison-controls {
    width: 100%;
  }

  .comparison-controls .btn {
    flex: 1;
    min-width: 0;
    font-size: var(--font-size-sm);
  }

  .comparison-grid {
    grid-template-columns: 1fr;
  }

  .variant-card {
    padding: var(--space-sm);
  }

  .variant-preview {
    height: 250px;
  }

  .variant-actions {
    flex-wrap: wrap;
  }
}

/* High Contrast Mode */
[data-high-contrast='true'] .variant-card {
  border-width: 2px;
}

[data-high-contrast='true'] .variant-state-complete {
  border-width: 3px;
}

[data-high-contrast='true'] .variant-state-error {
  border-width: 3px;
}

/* High Contrast - Comparison View buttons (global .btn-icon HC handled elsewhere) */
[data-high-contrast='true'] .variant-actions .btn-icon {
  border-width: 2px;
  font-weight: 700;
}

/* Reduced Motion - Comparison View (global reduced-motion handled in variables.css) */
@media (prefers-reduced-motion: reduce) {
  .variant-card {
    transition: none;
  }

  .variant-actions .btn-icon {
    transition: none;
  }

  .variant-state-rendering .status-label {
    animation: none;
  }
}

/* ============================================================================
   Library Controls
   ============================================================================ */

.library-controls {
  /* Wrapper div for visibility control only; card styling on inner .forge-disclosure */
}

.library-details {
  position: relative;
}

.library-summary {
  /* Inherits layout from .forge-disclosure summary */
  color: var(--color-text-primary);
  border-radius: var(--border-radius-sm);
}

.library-summary:hover {
  background: var(--color-bg-primary);
}

.library-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.library-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 24px;
  height: 24px;
  padding: 0 var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  border-radius: var(--border-radius-lg);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

.library-content {
  padding: var(--space-md);
  padding-top: var(--space-sm);
}

.library-help {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-md);
}

.library-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.library-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: all var(--motion-base);
  min-height: var(--size-touch-target);
}

.library-item:hover {
  background: var(--color-bg-secondary);
  box-shadow: var(--shadow-sm);
}

.library-item:has(input:checked) {
  border-color: var(--color-accent);
  background: var(--color-accent-subtle, rgba(0, 102, 204, 0.05));
}

.library-item:has(input:focus) {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.library-detected {
  border-color: var(--color-warning);
  border-width: 2px;
}

.library-item input[type='checkbox'] {
  width: 20px;
  height: 20px;
  margin: 0;
  cursor: pointer;
  accent-color: var(--color-accent);
}

.library-icon {
  font-size: var(--size-icon-lg);
  flex-shrink: 0;
  line-height: 1;
}

.library-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--space-2xs);
  min-width: 0;
}

.library-name {
  font-weight: 600;
  color: var(--color-text-primary);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-wrap: wrap;
}

.library-required-badge {
  display: inline-block;
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-warning);
  color: var(--color-on-warning);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-2xs);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.library-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  line-height: 1.3;
}

.library-footer {
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
}

.btn-link {
  background: none;
  border: none;
  color: var(--color-text-primary);
  text-decoration-color: var(--color-accent-fg);
  cursor: pointer;
  text-decoration: underline;
  font-size: var(--font-size-sm);
  padding: var(--space-xs);
  transition: color var(--motion-base);
}

.btn-link-with-icon {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2xs);
}

.btn-link:hover {
  color: var(--color-text-primary);
  text-decoration-color: var(--color-accent-fg);
  text-decoration-thickness: 2px;
}

.btn-link:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

/* High Contrast Mode */
[data-high-contrast='true'] .library-controls {
  border-width: 2px;
}

[data-high-contrast='true'] .library-item {
  border-width: 2px;
}

[data-high-contrast='true'] .library-detected {
  border-width: 3px;
}

[data-high-contrast='true'] .library-badge {
  font-weight: 700;
}

[data-high-contrast='true'] .library-required-badge {
  font-weight: 900;
}

/* Responsive Design */
@media (max-width: 767px) {
  .library-item {
    padding: var(--space-xs);
  }

  .library-icon {
    font-size: var(--size-icon-md);
  }

  .library-name {
    font-size: var(--font-size-sm);
  }

  .library-description {
    font-size: var(--font-size-2xs);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .library-summary,
  .library-item {
    transition: none;
  }

  .library-summary::before {
    transition: none;
  }
}

/* ============================================================================
   Project Files Controls (Multi-file project management)
   ============================================================================ */

.project-files-controls {
  /* Wrapper div for visibility control only; card styling on inner .forge-disclosure */
}

.project-files-details {
  margin: 0;
}

.project-files-summary {
  /* Inherits layout from .forge-disclosure summary */
  color: var(--color-text-primary);
  border-radius: var(--border-radius-sm);
}

.project-files-summary:hover {
  background: var(--color-bg-tertiary);
}

.project-files-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.project-files-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 24px;
  height: 24px;
  padding: 0 var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  font-size: var(--font-size-sm);
  font-weight: 600;
  border-radius: var(--border-radius-lg);
}

.project-files-content {
  padding: var(--space-sm);
  padding-top: var(--space-xs);
}

.project-files-help {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-sm);
}

/* Warning for missing files -- dependency preflight check with actionable button */
.project-files-warning {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  padding: var(--space-sm);
  margin-bottom: var(--space-sm);
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.1));
  border: 1px solid var(--color-warning, #ffc107);
  border-radius: var(--border-radius-sm);
  color: var(--color-warning-text, var(--color-text-primary));
  font-size: var(--font-size-sm);
}

.project-files-warning .warning-content {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
}

.project-files-warning .warning-icon {
  flex-shrink: 0;
}

.project-files-warning .btn-warning-action {
  align-self: flex-start;
  font-size: var(--font-size-sm);
  padding: var(--space-xs) var(--space-sm);
}

/* File list */
.project-files-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  margin-bottom: var(--space-sm);
  max-height: 200px;
  overflow-y: auto;
  scrollbar-gutter: stable;
  scrollbar-width: thin;
  scrollbar-color: var(--color-border) transparent;
}

.project-file-item {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  font-size: var(--font-size-sm);
}

.project-file-item.main-file {
  border-color: var(--color-accent-fg);
  background: var(--color-accent-subtle);
}

.project-file-icon {
  flex-shrink: 0;
  font-size: 1.1em;
}

.project-file-name {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-family: var(--font-family-mono);
}

.project-file-size {
  color: var(--color-text-secondary);
  font-size: var(--font-size-2xs);
  flex-shrink: 0;
}

.project-file-badge {
  display: inline-block;
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-accent);
  color: var(--color-accent-text);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  border-radius: var(--border-radius-sm);
}

.project-file-actions {
  display: flex;
  gap: var(--space-2xs);
  flex-shrink: 0;
}

.project-file-btn {
  padding: var(--space-2xs) var(--space-xs);
  font-size: var(--font-size-2xs);
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  color: var(--color-text-secondary);
  transition:
    background var(--motion-base),
    color var(--motion-base),
    border-color var(--motion-base);
}

.project-file-btn:hover {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border-color: var(--color-accent);
}

.project-file-btn:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.project-file-btn.btn-danger:hover {
  background: var(--color-error-bg, rgba(220, 53, 69, 0.1));
  border-color: var(--color-error);
  color: var(--color-error);
}

/* Add file button area */
.project-files-actions {
  margin-bottom: var(--space-sm);
}

.project-files-add-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  cursor: pointer;
}

.project-files-footer {
  border-top: 1px solid var(--color-border);
  padding-top: var(--space-xs);
  margin-top: var(--space-xs);
}

.project-files-hint {
  font-size: var(--font-size-2xs);
  color: var(--color-text-secondary);
  margin: 0;
}

/* Companion files empty state */
.companion-empty-state {
  padding: var(--space-sm) var(--space-md);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  text-align: center;
  border: 1px dashed var(--color-border);
  border-radius: var(--border-radius-sm);
  margin-bottom: var(--space-sm);
}

.companion-empty-state p {
  margin: 0;
}

.companion-empty-state code {
  font-size: 0.85em;
  padding: 1px 4px;
  background: var(--color-bg-tertiary);
  border-radius: 3px;
}

/* Companion Save/Update button */
.companion-save-btn {
  margin-top: var(--space-xs);
  width: 100%;
}

/* High Contrast Mode */
[data-high-contrast='true'] .project-files-controls {
  border-width: 2px;
}

[data-high-contrast='true'] .project-file-item {
  border-width: 2px;
}

[data-high-contrast='true'] .project-file-item.main-file {
  border-width: 3px;
}

/* ============================================================================
   Text File Editor Modal
   ============================================================================ */

.text-file-editor-textarea {
  width: 100%;
  min-height: 300px;
  padding: var(--space-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  line-height: 1.5;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  resize: vertical;
  /* Prevent smart quotes and autocorrect */
  -webkit-text-size-adjust: none;
  text-size-adjust: none;
}

.text-file-editor-textarea:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

.text-editor-info {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-sm);
}

.text-editor-info span {
  font-family: var(--font-family-mono);
  font-weight: 600;
  color: var(--color-text-primary);
}

.text-editor-hint {
  font-size: var(--font-size-2xs);
  color: var(--color-text-secondary);
  margin-top: var(--space-sm);
  margin-bottom: 0;
}

/* =========================================
   Color Picker Control
   ========================================= */

.param-control--color {
  margin-bottom: var(--space-md);
}

.color-picker-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-xs);
}

.color-preview {
  width: 44px;
  height: 44px;
  border-radius: var(--border-radius-sm);
  border: 2px solid var(--color-border);
  box-shadow: var(--shadow-sm);
  transition: border-color var(--motion-base);
}

.color-preview:hover {
  border-color: var(--color-accent);
}

.color-picker {
  width: 64px;
  height: 44px;
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  background: none;
  padding: var(--space-2xs);
  transition: border-color var(--motion-base);
}

.color-picker:hover {
  border-color: var(--color-accent);
}

.color-picker:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

/* Remove default color input styling in WebKit browsers */
.color-picker::-webkit-color-swatch-wrapper {
  padding: 0;
}

.color-picker::-webkit-color-swatch {
  border: none;
  border-radius: var(--border-radius-sm);
}

.color-hex-input {
  width: 90px;
  padding: var(--space-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-base);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  text-transform: uppercase;
  transition: border-color var(--motion-base);
}

.color-hex-input:hover {
  border-color: var(--color-accent);
}

.color-hex-input:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

.color-hex-input::placeholder {
  color: var(--color-text-secondary);
}

/* High Contrast Mode */
[data-high-contrast='true'] .color-preview {
  border-width: 3px;
}

[data-high-contrast='true'] .color-picker {
  border-width: 3px;
}

[data-high-contrast='true'] .color-hex-input {
  border-width: 3px;
}

/* Responsive */
@media (max-width: 767px) {
  .color-picker-container {
    flex-wrap: wrap;
  }

  .color-preview {
    width: 40px;
    height: 40px;
  }

  .color-picker {
    width: 56px;
    height: 40px;
  }

  .color-hex-input {
    width: 100%;
    flex: 1 1 100%;
  }
}

/* =========================================
   File Upload Control
   ========================================= */

.param-control--file {
  margin-bottom: var(--space-md);
}

.file-upload-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-xs);
  flex-wrap: wrap;
}

.file-input {
  /* Hide the actual file input */
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.file-upload-button {
  padding: var(--space-sm) var(--space-md);
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  font-weight: 500;
  cursor: pointer;
  min-height: 44px;
  transition:
    background-color var(--motion-base),
    transform var(--motion-fast);
}

.file-upload-button:hover {
  background: var(--color-accent-hover);
}

.file-upload-button:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.file-upload-button:active {
  transform: translateY(1px);
}

.file-info {
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-sm);
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  line-height: 1.4;
}

.file-info-summary {
  min-width: 0;
  word-wrap: break-word;
}

.file-info-details {
  font-size: var(--font-size-xs);
}

.file-info-details summary {
  cursor: pointer;
  user-select: none;
  color: var(--color-text-primary);
  padding: var(--space-xs) 0;
  font-size: var(--font-size-xs);
}

.file-info-details summary:hover {
  text-decoration: underline;
}

.file-info-details summary:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.file-info-tree {
  margin-top: var(--space-xs);
  font-family: monospace;
  font-size: var(--font-size-xs);
  white-space: pre-wrap;
  overflow-x: auto;
}

.file-info--error {
  background: rgba(220, 53, 69, 0.1);
  color: var(--color-error);
  border-color: var(--color-error);
}

.file-clear-button {
  width: 44px;
  height: 44px;
  background: var(--color-error);
  color: var(--color-accent-text);
  border: none;
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-lg);
  cursor: pointer;
  transition:
    background-color var(--motion-base),
    transform var(--motion-fast);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.file-clear-button:hover {
  background: var(--color-error-hover);
}

.file-clear-button:focus {
  outline: 3px solid var(--color-error);
  outline-offset: 2px;
}

.file-clear-button:active {
  transform: translateY(1px);
}

/* High Contrast Mode */
[data-high-contrast='true'] .file-upload-button {
  border: 2px solid currentColor;
}

[data-high-contrast='true'] .file-info {
  border-width: 3px;
}

[data-high-contrast='true'] .file-clear-button {
  border: 2px solid currentColor;
}

/* Responsive */
@media (max-width: 767px) {
  .file-upload-container {
    flex-direction: column;
    align-items: stretch;
  }

  .file-upload-button,
  .file-info,
  .file-clear-button {
    width: 100%;
  }

  .file-clear-button {
    width: auto;
  }
}

@media (max-height: 720px) {
  .upload-zone {
    padding: var(--space-lg);
  }

  .features-overview {
    margin-top: var(--space-lg);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .color-preview,
  .color-picker,
  .color-hex-input,
  .file-upload-button,
  .file-clear-button {
    transition: none;
  }
}

/* =========================================
   Vector Parameter Controls
   ========================================= */

.vector-parameter {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  margin-bottom: var(--space-md);
}

.vector-parameter legend {
  font-weight: var(--font-weight-semibold, 600);
  color: var(--color-text-primary);
  padding: 0 var(--space-xs);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.vector-parameter .parameter-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: var(--space-xs) 0 var(--space-sm) 0;
  padding: 0;
}

.vector-inputs {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.vector-component {
  flex: 1;
  min-width: 80px;
  max-width: 150px;
}

.vector-component .component-label {
  display: block;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-xs);
  font-weight: 500;
}

.vector-input {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-base);
  text-align: center;
  min-height: 44px;
  background: var(--color-input-bg);
  color: var(--color-text-primary);
}

.vector-input:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

.vector-input:hover {
  border-color: var(--color-accent);
}

.range-hint {
  display: block;
  font-size: var(--font-size-xs);
  color: var(--color-text-tertiary);
  text-align: center;
  margin-top: var(--space-xs);
}

/* High contrast mode for vector controls */
[data-high-contrast='true'] .vector-parameter {
  border-width: 2px;
}

[data-high-contrast='true'] .vector-input {
  border-width: 2px;
}

[data-high-contrast='true'] .vector-input:focus {
  outline-width: 3px;
}

/* Mobile responsive vector layout */
@media (max-width: 480px) {
  .vector-inputs {
    flex-direction: column;
  }

  .vector-component {
    max-width: 100%;
  }
}

/* Raw/expression parameter styles */
.raw-parameter {
  margin-bottom: var(--space-md);
}

.raw-value-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.raw-input {
  width: 100%;
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  font-family: monospace;
  font-size: var(--font-size-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  min-height: 44px;
}

.raw-input:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
  border-color: var(--color-accent);
}

.raw-warning {
  font-size: var(--font-size-xs);
  color: var(--color-warning);
  font-style: italic;
}

/* Reduced motion for vector controls */
@media (prefers-reduced-motion: reduce) {
  .vector-input {
    transition: none;
  }
}

/* =========================================
   Render Queue
   ========================================= */

.queue-badge {
  display: inline-block;
  min-width: 20px;
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-accent);
  color: var(--color-on-accent);
  border-radius: var(--border-radius-md);
  font-size: var(--font-size-2xs);
  font-weight: 700;
  line-height: 1;
  text-align: center;
  vertical-align: middle;
  margin-left: var(--space-xs);
}

.queue-controls {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
}

.queue-stats {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
  margin-bottom: var(--space-md);
  font-size: var(--font-size-sm);
}

.queue-stat {
  color: var(--color-text-secondary);
}

.queue-stat strong {
  color: var(--color-text-primary);
  font-weight: 600;
  margin-left: var(--space-xs);
}

.queue-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  max-height: 500px;
  overflow-y: auto;
  padding: var(--space-sm);
}

.queue-empty {
  text-align: center;
  padding: var(--space-xl);
  color: var(--color-text-secondary);
}

.queue-empty p {
  margin: var(--space-sm) 0;
}

.queue-empty-hint {
  font-size: var(--font-size-sm);
  opacity: 0.7;
}

.queue-item {
  background: var(--color-bg-primary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.queue-item:hover {
  border-color: var(--color-accent);
  box-shadow: var(--shadow-md);
}

.queue-item-queued {
  border-left: 4px solid var(--color-warning);
}

.queue-item-rendering {
  border-left: 4px solid var(--color-accent);
  background: var(--color-bg-secondary);
}

.queue-item-complete {
  border-left: 4px solid var(--color-success);
}

.queue-item-error {
  border-left: 4px solid var(--color-error);
}

.queue-item-cancelled {
  border-left: 4px solid var(--color-text-secondary);
  opacity: 0.7;
}

.queue-item-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
  flex-wrap: wrap;
}

.queue-item-icon {
  font-size: var(--size-icon-md);
  line-height: 1;
}

.queue-item-name {
  flex: 1;
  font-weight: 600;
  color: var(--color-text-primary);
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.queue-item-name[contenteditable='true'] {
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-sm);
  cursor: text;
}

.queue-item-name[contenteditable='true']:hover {
  background: var(--color-bg-secondary);
}

.queue-item-name[contenteditable='true']:focus {
  outline: 2px solid var(--color-focus);
  background: var(--color-bg-primary);
}

.queue-item-format {
  padding: var(--space-2xs) var(--space-xs);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
}

.queue-item-state {
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-2xs);
  font-weight: 600;
  text-transform: capitalize;
}

.queue-item-queued .queue-item-state {
  background: var(--color-warning-bg);
  color: var(--color-warning-text);
}

.queue-item-rendering .queue-item-state {
  background: var(--color-accent-subtle);
  color: var(--color-accent-text);
}

.queue-item-complete .queue-item-state {
  background: var(--color-success-bg);
  color: var(--color-success-text);
}

.queue-item-error .queue-item-state {
  background: var(--color-error-bg);
  color: var(--color-error-text);
}

.queue-item-cancelled .queue-item-state {
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
}

.queue-item-body {
  margin-bottom: var(--space-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.queue-item-error {
  color: var(--color-error);
  margin-bottom: var(--space-xs);
}

.queue-item-time,
.queue-item-stats {
  margin-bottom: var(--space-xs);
}

.queue-item-actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
}

.queue-item-actions .btn {
  min-height: 36px;
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
}

/* High Contrast Mode */
[data-high-contrast='true'] .queue-item {
  border-width: 3px;
}

[data-high-contrast='true'] .queue-item-queued {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-rendering {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-complete {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-error {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-item-cancelled {
  border-left-width: 6px;
}

[data-high-contrast='true'] .queue-badge {
  font-weight: 900;
  border: 2px solid white;
}

/* Responsive */
@media (max-width: 767px) {
  .queue-controls {
    padding: var(--space-sm);
  }

  .queue-stats {
    padding: var(--space-sm);
    gap: var(--space-sm);
  }

  .queue-item {
    padding: var(--space-sm);
  }

  .queue-item-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .queue-item-name {
    width: 100%;
  }

  .queue-item-actions {
    width: 100%;
  }

  .queue-item-actions .btn {
    flex: 1 1 auto;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .queue-item {
    transition: none;
  }
}

/* =========================================
   LOD (Level of Detail) Warning
   ========================================= */

.lod-warning {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--color-bg-elevated);
  border: 2px solid var(--color-warning);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  max-width: 320px;
  width: 90%;
  z-index: 100;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  animation: lodFadeIn var(--motion-base) ease-out;
}

.lod-warning--critical {
  border-color: var(--color-error);
  background: var(--color-bg-elevated);
}

@keyframes lodFadeIn {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

.lod-warning-header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-sm);
}

.lod-warning-icon {
  font-size: 1.25rem;
}

.lod-warning-title {
  font-size: var(--font-size-md);
  color: var(--color-text-primary);
}

.lod-warning-content {
  margin-bottom: var(--space-md);
}

.lod-warning-message {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-xs);
}

.lod-warning-stats {
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  background: var(--color-bg-secondary);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  text-align: center;
}

.lod-warning-stats strong {
  color: var(--color-warning);
}

.lod-warning--critical .lod-warning-stats strong {
  color: var(--color-error);
}

.lod-warning-actions {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: var(--space-sm);
}

.lod-warning-actions .btn-ghost {
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
  text-decoration: underline;
  text-underline-offset: 2px;
  background: none;
  border: none;
  padding: var(--space-xs) var(--space-sm);
  cursor: pointer;
  opacity: 0.8;
}

.lod-warning-actions .btn-ghost:hover {
  color: var(--color-text-primary);
  opacity: 1;
}

/* High Contrast Mode */
[data-high-contrast='true'] .lod-warning {
  border-width: 3px;
}

[data-high-contrast='true'] .lod-warning--critical {
  border-color: var(--color-error);
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .lod-warning {
    animation: none;
  }
}

/* Mobile Responsive */
@media (max-width: 480px) {
  .lod-warning {
    max-width: 95%;
    padding: var(--space-sm);
  }

  .lod-warning-stats {
    font-size: var(--font-size-xs);
  }
}

/* =========================================
   Memory Warning Notification
   ========================================= */

.memory-warning {
  position: fixed;
  bottom: calc(var(--space-lg) + env(safe-area-inset-bottom, 0px));
  left: 50%;
  transform: translateX(-50%);
  z-index: var(--z-index-skip-link);
  max-width: 400px;
  width: calc(100% - 2 * var(--space-md));
  padding: var(--space-md);
  background: var(--color-bg-elevated);
  border: 2px solid var(--color-warning);
  border-radius: var(--border-radius-md);
  box-shadow: var(--shadow-lg);
  animation: slideUp var(--motion-slow) ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.memory-warning-content {
  display: flex;
  align-items: flex-start;
  gap: var(--space-sm);
}

.memory-warning-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.memory-warning-text {
  flex: 1;
}

.memory-warning-text strong {
  display: block;
  color: var(--color-warning);
  font-size: var(--font-size-md);
  margin-bottom: var(--space-xs);
}

.memory-warning-text p {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin: 0;
}

.memory-warning-hint {
  margin-top: var(--space-xs) !important;
  font-style: italic;
}

.memory-warning-dismiss {
  flex-shrink: 0;
  width: 28px;
  height: 28px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  line-height: 1;
}

/* High Contrast Mode */
[data-high-contrast='true'] .memory-warning {
  border-width: 3px;
  border-color: var(--color-warning);
}

/* Mobile Responsive */
@media (max-width: 480px) {
  .memory-warning {
    max-width: calc(100% - 2 * var(--space-sm));
    bottom: calc(var(--space-sm) + env(safe-area-inset-bottom, 0px));
    padding: var(--space-sm);
  }

  .memory-warning-icon {
    font-size: 1.25rem;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .memory-warning {
    animation: none;
  }
}

/* =========================================
   Memory State Badges (Milestone 0 Foundation)
   ========================================= */

.memory-status-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2xs);
  padding: var(--space-2xs) var(--space-xs);
  font-size: var(--font-size-xs);
  font-weight: 500;
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  transition: all var(--motion-base) ease-out;
}

.memory-status-badge[data-state='normal'] {
  background: var(--color-success-bg, rgba(0, 200, 83, 0.1));
  color: var(--color-success);
}

.memory-status-badge[data-state='warning'] {
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.15));
  color: var(--color-warning);
}

.memory-status-badge[data-state='critical'] {
  background: var(--color-error-bg, rgba(244, 67, 54, 0.15));
  color: var(--color-error);
  animation: pulse-critical 1.5s ease-in-out infinite;
}

.memory-status-badge[data-state='emergency'] {
  background: var(--color-error);
  color: white;
  animation: pulse-emergency 0.8s ease-in-out infinite;
}

@keyframes pulse-critical {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

@keyframes pulse-emergency {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.9;
    transform: scale(1.02);
  }
}

/* Memory Banner (for critical/emergency states) */
.memory-banner {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: var(--z-index-tutorial-panel);
  padding: var(--space-sm) var(--space-md);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  font-weight: 500;
  transform: translateY(-100%);
  transition: transform var(--motion-slow) ease-out;
}

.memory-banner[data-visible='true'] {
  transform: translateY(0);
}

.memory-banner[data-state='critical'] {
  background: var(--color-warning);
  color: var(--color-on-warning, #000);
}

.memory-banner[data-state='emergency'] {
  background: var(--color-error);
  color: white;
}

.memory-banner-actions {
  display: flex;
  gap: var(--space-sm);
}

.memory-banner-btn {
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid currentColor;
  border-radius: var(--border-radius-sm);
  background: transparent;
  color: inherit;
  font-weight: 600;
  cursor: pointer;
  transition: background-color var(--motion-fast);
}

.memory-banner-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.memory-banner-btn:focus-visible {
  outline: 2px solid currentColor;
  outline-offset: 2px;
}

/* Memory action button visibility based on state */
.memory-action-critical,
.memory-action-emergency {
  display: none;
}

.memory-banner[data-state='critical'] .memory-action-critical,
.memory-banner[data-state='emergency'] .memory-action-critical {
  display: inline-flex;
}

.memory-banner[data-state='emergency'] .memory-action-emergency {
  display: inline-flex;
}

/* Emergency state: hide dismiss button (non-dismissible) */
.memory-banner[data-state='emergency'] .memory-action-dismissable {
  display: none;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .memory-status-badge[data-state='critical'],
  .memory-status-badge[data-state='emergency'] {
    animation: none;
  }
  .memory-banner {
    transition: none;
  }
}

/* =========================================
   Advanced Menu
   ========================================= */

.advanced-menu {
  /* Card styling provided by .forge-disclosure */
}

.advanced-menu-summary {
  /* Inherits layout from .forge-disclosure summary */
  color: var(--color-text-secondary);
}

.advanced-menu-summary:hover {
  color: var(--color-text-primary);
  background: var(--color-bg-tertiary);
}

.advanced-menu-summary:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
}

.advanced-menu[open] .advanced-menu-summary {
  border-bottom: 1px solid var(--color-border);
}

.advanced-icon {
  /* Icon sizing now provided by .forge-disclosure-icon */
}

.advanced-menu-content {
  padding: var(--space-md);
}

.advanced-section {
  margin-bottom: var(--space-md);
  padding-bottom: var(--space-md);
  border-bottom: 1px solid var(--color-border);
}

.advanced-section:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.advanced-section-title {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-sm) 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.advanced-btn {
  margin-right: var(--space-xs);
  margin-bottom: var(--space-xs);
}

.advanced-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  cursor: pointer;
  font-size: var(--font-size-sm);
}

.advanced-toggle input[type='checkbox'] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.advanced-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-muted);
  margin: var(--space-xs) 0 0 0;
  font-style: italic;
}

.reset-tools {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xs);
}

.reset-group-selector {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
}

.reset-group-selector label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.reset-group-select {
  flex: 1;
  padding: var(--space-xs) var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

/* =========================================
   Source Code Viewer Modal
   ========================================= */

.modal-source {
  max-width: 900px;
  width: min(92vw, 900px);
  height: 80vh;
  display: flex;
  flex-direction: column;
}

.source-viewer-actions {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.source-viewer-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.source-viewer-textarea {
  flex: 1;
  width: 100%;
  min-height: clamp(12rem, 40vh, 18.75rem);
  padding: var(--space-md);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  resize: vertical;
  tab-size: 2;
  white-space: pre;
  overflow: auto;
}

.source-viewer-textarea:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: -2px;
}

.source-viewer-info {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: var(--space-sm);
}

.source-viewer-info span {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
}

/* =========================================
   Parameters JSON Viewer Modal
   ========================================= */

.modal-medium {
  max-width: 600px;
  width: min(92vw, 600px);
}

.params-json-actions {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.params-json-textarea {
  width: 100%;
  min-height: clamp(12rem, 40vh, 18.75rem);
  max-height: min(70vh, 500px);
  padding: var(--space-md);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  resize: vertical;
  tab-size: 2;
  white-space: pre;
  overflow: auto;
}

.params-json-textarea:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: -2px;
}

/* =========================================
   Parameter Limits Override Indicator
   ========================================= */

.param-control.limits-unlocked .slider-container input[type='range'],
.param-control.limits-unlocked .number-input-container input[type='number'] {
  border-color: var(--color-warning);
  box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.2);
}

.param-unlocked-indicator {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  font-size: var(--font-size-xs);
  color: var(--color-warning);
  margin-left: var(--space-xs);
}

.param-unlocked-indicator::before {
  content: '🔓';
}

/* Warning for out-of-range values */
.param-control.out-of-range .slider-value,
.param-control.out-of-range input[type='number'] {
  color: var(--color-warning);
  font-weight: 600;
}

.param-out-of-range-warning {
  font-size: var(--font-size-xs);
  color: var(--color-warning);
  margin-top: var(--space-xs);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.param-out-of-range-warning::before {
  content: '⚠️';
}

/* =========================================
   Individual Parameter Reset Button
   ========================================= */

.param-reset-btn {
  padding: var(--space-2xs) var(--space-xs);
  font-size: var(--font-size-xs);
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary); /* Ensure this adapts to theme */
  cursor: pointer;
  opacity: 0;
  transition:
    opacity var(--motion-base),
    color var(--motion-base),
    border-color var(--motion-base);
  margin-left: auto;
}

.param-control:hover .param-reset-btn,
.param-control:focus-within .param-reset-btn {
  opacity: 1;
}

.param-reset-btn:hover {
  color: var(--color-text-primary);
  border-color: var(--color-accent);
}

.param-reset-btn:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 1px;
  opacity: 1;
}

.param-reset-btn.modified {
  opacity: 1;
  color: var(--color-text-primary);
  border-color: var(--color-accent);
}

/* High Contrast Mode */
[data-high-contrast='true'] .advanced-menu {
  border-width: 2px;
}

[data-high-contrast='true'] .source-viewer-textarea,
[data-high-contrast='true'] .params-json-textarea {
  border-width: 2px;
}

[data-high-contrast='true']
  .param-control.limits-unlocked
  .slider-container
  input[type='range'],
[data-high-contrast='true']
  .param-control.limits-unlocked
  .number-input-container
  input[type='number'] {
  border-width: 3px;
}

/* Mobile Responsive */
@media (max-width: 767px) {
  .modal-source {
    height: 90vh;
    max-width: 100%;
    margin: var(--space-sm);
  }

  .source-viewer-textarea {
    font-size: var(--font-size-xs);
  }

  .reset-group-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .reset-group-selector label {
    margin-bottom: var(--space-xs);
  }
}

/* =========================================
   Console Output Modal (echo/warning/error display)
   ========================================= */

.modal-console {
  max-width: 800px;
  width: min(92vw, 800px);
}

.console-modal-body {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.console-description {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin: 0;
}

.console-description code {
  background: var(--color-bg-secondary);
  padding: 0.125em 0.375em;
  border-radius: var(--border-radius-xs);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

.console-output-container {
  flex: 1;
  min-height: 200px;
  max-height: 400px;
  overflow: hidden;
  background: var(--color-bg-tertiary, var(--color-bg-secondary));
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
}

.console-output {
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  white-space: pre-wrap;
  word-wrap: break-word;
  padding: var(--space-md);
  margin: 0;
  color: var(--color-text-primary);
  height: 100%;
  max-height: 400px;
  overflow-y: auto;
  overflow-x: hidden;
}

/* Highlight ECHO: lines for visibility */
.console-output .echo-line {
  color: var(--color-info-text, #17a2b8);
  font-weight: 600;
  background: var(--color-info-bg, rgba(23, 162, 184, 0.15));
  display: block;
  padding: 2px 4px;
  margin: 1px 0;
  border-radius: var(--border-radius-xs, 2px);
  border-left: 3px solid var(--color-info, #17a2b8);
}

.console-hint {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
}

.console-hint code {
  background: var(--color-bg-tertiary, var(--color-bg-primary));
  padding: 0.125em 0.375em;
  border-radius: var(--border-radius-xs);
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}

.console-modal-footer {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
}

/* Console badge for new output notification */
.console-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 18px;
  height: 18px;
  padding: 0 4px;
  font-size: var(--font-size-xs);
  font-weight: 600;
  color: var(--color-error-text, white);
  background: var(--color-error, #dc3545);
  border-radius: var(--border-radius-full);
  margin-left: var(--space-xs);
}

.console-badge.hidden {
  display: none;
}

/* Mobile responsive */
@media (max-width: 767px) {
  .modal-console {
    height: 90vh;
    max-width: 100%;
    margin: var(--space-sm);
  }

  .console-output-container {
    max-height: 50vh;
  }
}

/* WASM Loading Overlay */
.wasm-loading-overlay {
  position: fixed;
  inset: 0;
  z-index: var(--z-index-tutorial-panel);
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-primary);
  opacity: 1;
  transition: opacity var(--motion-slow) ease-out;
}

.wasm-loading-overlay.fade-out {
  opacity: 0;
  pointer-events: none;
}

.wasm-loading-content {
  text-align: center;
  max-width: 400px;
  padding: var(--space-xl);
}

.wasm-loading-spinner {
  margin-bottom: var(--space-lg);
}

.wasm-loading-spinner .spinner-large {
  width: 64px;
  height: 64px;
  border-width: 5px;
}

.wasm-loading-title {
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

.wasm-loading-message {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-md) 0;
  min-height: 1.5em;
}

.wasm-loading-progress-container {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-md);
}

.wasm-loading-progress-bar {
  flex: 1;
  height: 8px;
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  overflow: hidden;
}

.wasm-loading-progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: var(--border-radius-sm);
  transition: width var(--motion-slow) ease-out;
}

.wasm-loading-progress-fill.indeterminate {
  width: 30% !important;
  animation: indeterminateProgress 1.5s ease-in-out infinite;
}

@keyframes indeterminateProgress {
  0% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(200%);
  }
  100% {
    transform: translateX(-100%);
  }
}

.wasm-loading-progress-text {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-primary);
  min-width: 40px;
  text-align: right;
}

.wasm-loading-hint {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  margin: 0;
}

/* High Contrast Mode for WASM Loading */
[data-high-contrast='true'] .wasm-loading-progress-bar {
  border: 2px solid var(--color-text-primary);
}

/* Reduced Motion for WASM Loading */
@media (prefers-reduced-motion: reduce) {
  .wasm-loading-progress-fill.indeterminate {
    animation: none;
    width: 50% !important;
  }
}

/* ========== FEATURES GUIDE MODAL ========== */

.features-guide-body {
  display: flex;
  flex-direction: column;
  gap: 0; /* Remove gap, let children handle spacing */
  max-height: min(70vh, 600px);
  max-height: min(70dvh, 600px); /* Dynamic viewport height */
  overflow: hidden;
}

/* Tab bar stays fixed at top of modal body */
.features-tabs {
  display: flex;
  gap: var(--space-xs);
  border-bottom: 2px solid var(--color-border);
  flex-shrink: 0; /* Don't shrink */
  overflow-x: auto; /* Horizontal scroll if needed */
  overflow-y: hidden;
  scrollbar-width: thin;
  -webkit-overflow-scrolling: touch;
  /* Ensure tabs don't wrap into tiny unusable sizes */
  flex-wrap: nowrap;
  padding: 0 var(--space-sm);
}

/* Scroll indicator for tabs */
.features-tabs::after {
  content: '';
  position: sticky;
  right: 0;
  width: 20px;
  background: linear-gradient(to left, var(--color-bg-primary), transparent);
  flex-shrink: 0;
  pointer-events: none;
}

.features-tab {
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  color: var(--color-text-secondary);
  font-weight: 500;
  font-size: var(--font-size-base);
  cursor: pointer;
  min-height: var(--size-touch-target);
  min-width: 80px; /* Minimum width so tabs aren't too small */
  white-space: nowrap;
  flex-shrink: 0; /* Don't shrink individual tabs */
  transition:
    color var(--motion-base),
    border-color var(--motion-base),
    background-color var(--motion-base);
}

.features-tab:hover {
  color: var(--color-text-primary);
  background-color: var(--color-hover-bg);
}

.features-tab:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: -3px;
  z-index: 1;
}

.features-tab[aria-selected='true'] {
  color: var(--color-text-primary);
  border-bottom-color: var(--color-accent);
  font-weight: 600;
}

/* Panel scrolls independently */
.features-panel {
  flex: 1;
  overflow-y: auto;
  padding: var(--space-lg);
  outline: none;
  min-height: 0; /* Required for flex child scrolling */
}

.features-panel h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-md) 0;
}

.features-panel h4 {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: var(--space-lg) 0 var(--space-sm) 0;
}

.features-panel p {
  margin: var(--space-sm) 0;
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.features-panel pre {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-md);
  overflow-x: auto;
  margin: var(--space-md) 0;
}

.features-panel code {
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
}

.features-panel p code {
  background: var(--color-bg-secondary);
  padding: var(--space-2xs) var(--space-xs);
  border-radius: var(--border-radius-xs);
  font-size: 0.9em;
}

.features-list {
  margin: var(--space-sm) 0;
  padding-left: var(--space-lg);
  line-height: 1.8;
}

.features-list li {
  margin: var(--space-xs) 0;
  color: var(--color-text-secondary);
}

.features-list strong {
  color: var(--color-text-primary);
  font-weight: 600;
}

.features-action {
  margin: var(--space-lg) 0;
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  border-left: 4px solid var(--color-accent);
}

.features-note {
  margin: var(--space-sm) 0 0 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  font-style: italic;
}

/* Alt View Controls Diagram */
.altview-controls-diagram {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-xl);
  justify-content: center;
  margin: var(--space-lg) 0;
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

.altview-dpad-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-xs);
}

.altview-dpad-label {
  font-weight: 600;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

.altview-dpad {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr 1fr;
  gap: 2px;
  width: 90px;
  height: 90px;
}

.altview-dpad-arrow {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-xs);
  font-size: 0.9rem;
  color: var(--color-text-secondary);
}

.altview-dpad-up {
  grid-column: 2;
  grid-row: 1;
}

.altview-dpad-left {
  grid-column: 1;
  grid-row: 2;
}

.altview-dpad-center {
  grid-column: 2;
  grid-row: 2;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-accent);
  color: var(--color-bg-primary);
  border-radius: var(--border-radius-xs);
  font-weight: 600;
  font-size: 1.1rem;
}

.altview-dpad-right {
  grid-column: 3;
  grid-row: 2;
}

.altview-dpad-down {
  grid-column: 2;
  grid-row: 3;
}

.altview-dpad-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-muted);
  text-align: center;
}

.altview-adjust-legend {
  text-align: center;
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  margin: var(--space-md) 0;
}

/* Modal size variant for Features Guide */
.modal-large {
  max-width: 900px;
  width: 90vw;
}

/* Ensure modal content is always opaque */
.modal-content {
  background-color: var(--color-bg-primary);
  opacity: 1;
}

/* Override any inherited transparency */
#featuresGuideModal .modal-content {
  background-color: var(--color-bg-primary);
  opacity: 1;
}

/* High Contrast for Features Guide */
[data-high-contrast='true'] .features-tabs {
  border-bottom-width: 3px;
}

[data-high-contrast='true'] .features-tab[aria-selected='true'] {
  border-bottom-width: 4px;
}

[data-high-contrast='true'] .features-panel pre {
  border-width: 2px;
}

[data-high-contrast='true'] .features-action {
  border-width: 2px;
  border-left-width: 6px;
}

/* =========================================
   Features Guide - Tutorial Highlight Polish
   Enhanced styling when modal is spotlighted
   ========================================= */

/* Enhanced header when spotlighted */
#featuresGuideModal .modal-content.tutorial-target-highlight .modal-header {
  background: linear-gradient(
    135deg,
    var(--color-accent) 0%,
    color-mix(in srgb, var(--color-accent) 80%, var(--color-bg-primary)) 100%
  );
  color: var(--color-accent-text, white);
  border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
  padding: var(--space-md) var(--space-lg);
}

#featuresGuideModal .modal-content.tutorial-target-highlight .modal-header h2 {
  color: inherit;
}

#featuresGuideModal .modal-content.tutorial-target-highlight .modal-close {
  color: inherit;
  opacity: 0.9;
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .modal-close:hover {
  opacity: 1;
  background: rgba(255, 255, 255, 0.2);
}

/* Make close button more prominent during tutorial - pulsing hint */
#featuresGuideModal .modal-content.tutorial-target-highlight .modal-close {
  animation: closeButtonHint 2s ease-in-out infinite;
  position: relative;
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .modal-close::after {
  content: 'Close to continue';
  position: absolute;
  right: 100%;
  top: 50%;
  transform: translateY(-50%);
  margin-right: var(--space-sm);
  white-space: nowrap;
  font-size: var(--font-size-xs);
  font-weight: 500;
  opacity: 0.9;
  pointer-events: none;
}

@keyframes closeButtonHint {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

/* Enhanced tabs when spotlighted */
#featuresGuideModal .modal-content.tutorial-target-highlight .features-tabs {
  position: relative;
  background: var(--color-bg-secondary);
  border-bottom: 2px solid var(--color-accent);
  padding-top: var(--space-lg);
}

#featuresGuideModal .modal-content.tutorial-target-highlight .features-tab {
  font-weight: 600;
  transition: all var(--motion-base) ease;
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-tab:hover {
  background: color-mix(in srgb, var(--color-accent) 15%, transparent);
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-tab[aria-selected='true'] {
  color: var(--color-text-primary);
  border-bottom-color: var(--color-accent);
  background: color-mix(
    in srgb,
    var(--color-accent) 10%,
    var(--color-bg-primary)
  );
}

/* Enhanced panel content when spotlighted */
#featuresGuideModal .modal-content.tutorial-target-highlight .features-panel {
  background: var(--color-bg-primary);
}

#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-panel
  h3 {
  color: var(--color-text-primary);
  border-bottom: 2px solid var(--color-accent);
  padding-bottom: var(--space-xs);
  margin-bottom: var(--space-md);
}

#featuresGuideModal .modal-content.tutorial-target-highlight .features-action {
  border-color: var(--color-accent);
  background: color-mix(
    in srgb,
    var(--color-accent) 8%,
    var(--color-bg-secondary)
  );
}

/* Encourage exploration - hint above tabs */
#featuresGuideModal
  .modal-content.tutorial-target-highlight
  .features-tabs::before {
  content: '👆 Explore the tabs to learn more';
  position: absolute;
  left: var(--space-sm);
  top: var(--space-2xs);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-weight: 500;
  font-style: italic;
}

/* Tutorial panel positioning when Features Guide modal is open */
body:has(#featuresGuideModal:not(.hidden)) .tutorial-panel {
  /* Position at bottom of screen when modal is open */
  position: fixed !important;
  bottom: var(--space-md) !important;
  left: 50% !important;
  top: auto !important;
  transform: translateX(-50%) !important;
  max-width: min(400px, calc(100vw - var(--space-lg) * 2)) !important;
  z-index: 10006 !important;
  box-shadow:
    0 -4px 20px rgba(0, 0, 0, 0.3),
    0 0 0 3px var(--color-accent) !important;
}

/* Hide the arrow when modal is open - panel is detached */
body:has(#featuresGuideModal:not(.hidden)) .tutorial-arrow {
  display: none !important;
}

/* Mobile: adjust panel position when modal is open */
@media (max-width: 767px) {
  body:has(#featuresGuideModal:not(.hidden)) .tutorial-panel {
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    max-width: 100% !important;
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0 !important;
    max-height: 35vh !important;
  }
}

/* Responsive adjustments */
@media (max-width: 767px) {
  .features-guide-body {
    max-height: 80vh;
    max-height: 80dvh;
  }

  .modal-large {
    width: 95vw;
    max-width: none;
    margin: var(--space-sm);
  }

  .features-tab {
    padding: var(--space-sm);
    min-width: 70px;
    font-size: var(--font-size-sm);
  }

  .features-panel {
    padding: var(--space-md);
  }
}

/* =========================================
   Camera Controls (WCAG 2.2 SC 2.5.7)
   Non-drag alternatives for 3D preview
   ========================================= */

.camera-controls {
  position: absolute;
  bottom: var(--space-md);
  right: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  z-index: 50;
  background: var(--color-bg-primary);
  padding: var(--space-sm);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-md);
  /* Prevent the panel from exceeding the preview area */
  max-height: calc(100% - (var(--space-md) * 2));
  overflow: auto;
}

.camera-controls-header {
  display: flex;
  gap: var(--space-xs);
  align-items: center;
  justify-content: space-between;
}

.camera-controls-toggle,
.camera-controls-move {
  min-height: 44px;
  padding: 0 var(--space-sm);
  border-radius: var(--border-radius-sm);
  border: 2px solid var(--color-border);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  font-weight: 600;
  cursor: pointer;
}

.camera-controls-toggle {
  flex: 1;
  text-align: left;
}

.camera-controls-toggle:hover,
.camera-controls-move:hover {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: var(--color-accent-text);
}

.camera-controls-toggle:focus,
.camera-controls-move:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.camera-controls-body {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

/* Collapsed state: keep a small, movable header only */
.camera-controls[data-collapsed='true'] {
  padding: var(--space-xs);
}

/* Position variants (keyboard-accessible “Move” cycles corners) */
.camera-controls[data-position='bottom-right'] {
  bottom: var(--space-md);
  right: var(--space-md);
  top: auto;
  left: auto;
}

.camera-controls[data-position='bottom-left'] {
  bottom: var(--space-md);
  left: var(--space-md);
  top: auto;
  right: auto;
}

.camera-controls[data-position='top-right'] {
  top: var(--space-md);
  right: var(--space-md);
  bottom: auto;
  left: auto;
}

.camera-controls[data-position='top-left'] {
  top: var(--space-md);
  left: var(--space-md);
  bottom: auto;
  right: auto;
}

.camera-control-group {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-xs);
}

.camera-zoom-group {
  grid-template-columns: repeat(3, 1fr);
  padding-top: var(--space-xs);
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-xs);
}

.camera-control-btn {
  width: 44px;
  height: 44px;
  min-width: 44px;
  min-height: 44px;
  padding: 0;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  font-size: var(--font-size-lg);
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--motion-base);
}

.camera-control-btn:hover {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: var(--color-accent-text);
  transform: scale(1.05);
}

.camera-control-btn:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.camera-control-btn:active {
  transform: scale(0.95);
}

/* Arrange rotation buttons in cross pattern */
.camera-control-group:first-child {
  grid-template-areas:
    '. up .'
    'left . right'
    '. down .';
}

.camera-control-group:first-child button:nth-child(1) {
  grid-area: left;
}

.camera-control-group:first-child button:nth-child(2) {
  grid-area: up;
}

.camera-control-group:first-child button:nth-child(3) {
  grid-area: down;
}

.camera-control-group:first-child button:nth-child(4) {
  grid-area: right;
}

/* Arrange pan buttons in cross pattern */
.camera-pan-group {
  grid-template-areas:
    '. up .'
    'left . right'
    '. down .';
}

.camera-pan-group button:nth-child(1) {
  grid-area: left;
}

.camera-pan-group button:nth-child(2) {
  grid-area: up;
}

.camera-pan-group button:nth-child(3) {
  grid-area: down;
}

.camera-pan-group button:nth-child(4) {
  grid-area: right;
}

/* High Contrast Mode */
[data-high-contrast='true'] .camera-controls {
  border-width: 3px;
}

[data-high-contrast='true'] .camera-control-btn {
  border-width: 3px;
  font-weight: 900;
}

/* Mobile Responsive */
@media (max-width: 767px) {
  .camera-controls {
    bottom: calc(var(--space-sm) + env(safe-area-inset-bottom, 0px));
    right: var(--space-sm);
    padding: var(--space-xs);
  }

  .camera-control-btn {
    width: 40px;
    height: 40px;
    min-width: 40px;
    min-height: 40px;
    font-size: var(--font-size-base);
  }
}

/* Hide camera controls in focus mode to avoid clutter */
.main-interface.focus-mode .camera-controls {
  bottom: calc(var(--space-lg) + env(safe-area-inset-bottom, 0px));
  right: var(--space-lg);
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .camera-control-btn {
    transition: none;
  }

  .camera-control-btn:hover {
    transform: none;
  }

  .camera-control-btn:active {
    transform: none;
  }
}

/* ========== WELCOME SCREEN FEATURES OVERVIEW ========== */

.features-overview {
  margin-top: var(--space-xl);
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  overflow: hidden;
  max-width: 100%;
  box-sizing: border-box;
}

.features-overview h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

.feature-cards {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-md);
  margin-bottom: var(--space-lg);
}

.feature-card {
  padding: var(--space-md);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  text-align: center;
  transition:
    transform var(--motion-base),
    box-shadow var(--motion-base);
}

.feature-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.feature-card-icon {
  font-size: 2.5rem;
  display: block;
  margin-bottom: var(--space-sm);
  line-height: 1;
}

.feature-card h4 {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-xs) 0;
}

.feature-card p {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  line-height: 1.5;
}

.features-overview > .btn {
  display: block;
  margin: 0 auto;
}

/* High Contrast for Feature Cards */
[data-high-contrast='true'] .features-overview {
  border-width: 2px;
}

[data-high-contrast='true'] .feature-card {
  border-width: 2px;
}

/* Responsive for feature cards */
@media (min-width: 768px) {
  .features-overview {
    padding: var(--space-lg);
  }

  .feature-cards {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .role-paths-grid {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }

  .spotlights-list {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }
}

/* ============================================================================
   Role-Based Feature Paths (Welcome Screen)
   ============================================================================
   New role-based entry points for discovering accessibility features.
   Designed for keyboard-first navigation with large touch targets.
   ============================================================================ */

.features-intro {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  text-align: center;
  margin: 0 0 var(--space-lg) 0;
}

.role-path-meta {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-xs) 0;
  line-height: 1.4;
}

.role-path-details {
  margin-top: var(--space-xs);
}

.role-path-details > summary {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
  list-style: none;
  user-select: none;
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
}

.role-path-details > summary::-webkit-details-marker {
  display: none;
}

.role-path-details > summary::before {
  content: '▸';
  display: inline-block;
  color: var(--color-text-secondary);
  transform: rotate(0deg);
  transition: transform var(--motion-base) ease;
}

.role-path-details[open] > summary::before {
  transform: rotate(90deg);
}

@media (prefers-reduced-motion: reduce) {
  .role-path-details > summary::before {
    transition: none;
  }
}

.role-paths-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-lg);
  margin-bottom: var(--space-xl);
}

.role-path-card {
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.role-path-card:focus-within {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
}

.role-path-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0;
  line-height: 1.3;
}

.role-path-description {
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
  margin: 0;
  line-height: 1.5;
  /* WCAG AA minimum contrast - text inherits from theme */
}

.role-path-tips {
  list-style: none;
  padding: 0;
  margin: var(--space-sm) 0 0 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  flex: 1;
}

.role-path-tips li {
  padding-left: var(--space-md);
  margin-bottom: var(--space-xs);
  position: relative;
  line-height: 1.5;
}

.role-path-tips li::before {
  content: '→';
  position: absolute;
  left: 0;
  color: var(--color-text-primary);
  font-weight: bold;
}

.role-path-actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  margin-top: auto;
}

.btn-role-try {
  width: 100%;
  justify-content: center;
  font-weight: 600;
  /* Force 44px even on desktop to meet WCAG 2.5.8 AAA for primary CTAs */
  min-height: 44px;
}

.btn-role-learn {
  width: 100%;
  justify-content: center;
  font-size: var(--font-size-sm);
  min-height: 36px;
}

/* Accessibility Spotlights */
.accessibility-spotlights {
  margin-top: var(--space-lg);
  padding: var(--space-lg);
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

/* Expandable (native details/summary) to reduce welcome screen surface area */
.spotlights-summary {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0;
  cursor: pointer;
  list-style: none;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: var(--space-xs);
  padding: var(--space-xs) 0;
}

/* Hide default marker and use our own chevron */
.spotlights-summary::-webkit-details-marker {
  display: none;
}

.spotlights-summary::before {
  content: '▸';
  display: inline-block;
  color: var(--color-text-secondary);
  transform: rotate(0deg);
  transition: transform var(--motion-base) ease;
}

.accessibility-spotlights[open] > .spotlights-summary::before {
  transform: rotate(90deg);
}

.spotlights-summary:focus-visible {
  outline: 3px solid var(--color-focus);
  outline-offset: 4px;
  border-radius: var(--border-radius-sm);
}

@media (prefers-reduced-motion: reduce) {
  .spotlights-summary::before {
    transition: none;
  }
}

.spotlights-body {
  margin-top: var(--space-sm);
}

.spotlights-intro {
  margin: 0 0 var(--space-md) 0;
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  line-height: 1.5;
  text-align: left;
}

.spotlights-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-sm);
}

.spotlights-list li {
  margin: 0;
}

.spotlight-link {
  display: block;
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-primary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  text-decoration: none;
  font-size: var(--font-size-sm);
  line-height: 1.4;
  min-height: 44px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: center;
  gap: var(--space-xs);
  transition:
    background-color var(--motion-base),
    border-color var(--motion-base);
}

.spotlight-title {
  font-weight: 600;
}

.spotlight-detail {
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
  line-height: 1.5;
}

.spotlight-link:hover {
  background: var(--color-bg-secondary);
  border-color: var(--color-accent);
}

.spotlight-link:focus-visible {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

@supports not selector(:focus-visible) {
  .spotlight-link:focus {
    outline: 3px solid var(--color-focus);
    outline-offset: 2px;
  }
}

@media (max-width: 767px) {
  .accessibility-spotlights {
    padding: var(--space-md);
  }
}

/* ============================================================================
   Tutorial Overlay System - Spotlight Coachmarks
   ============================================================================
   Modern tutorial system with spotlight cutouts around target elements.
   The tutorial panel positions itself near highlighted elements with an
   arrow pointing to the target. Based on Shepherd.js/Driver.js patterns.
   ============================================================================ */

/* Main overlay container - allows clicks through to spotlight area */
.tutorial-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: var(--z-index-tutorial-backdrop);
  pointer-events: none;
  animation: tutorialFadeIn var(--motion-slow) ease-out;
  contain: layout style;
}

/* SVG Spotlight overlay with mask cutout */
.tutorial-spotlight-svg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  transition: opacity var(--motion-slow) ease;
  z-index: var(--z-index-tutorial-spotlight);
  contain: strict;
}

.tutorial-backdrop {
  fill: rgba(0, 0, 0, 0.65);
}

.tutorial-spotlight-cutout {
  transition: all var(--motion-slow) ease;
}

/* Floating tutorial panel - positioned near target */
.tutorial-panel {
  position: fixed;
  background: var(--color-bg-primary);
  border: 2px solid var(--color-accent);
  border-radius: var(--border-radius-lg);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.3),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  width: min(90vw, 340px);
  max-width: calc(100vw - 32px);
  /* dvh-aware max-height with fallback for older browsers */
  max-height: calc(100vh - 32px);
  display: flex;
  flex-direction: column;
  pointer-events: auto;
  animation: tutorialPanelIn var(--motion-slow) ease-out;
  outline: none;
  z-index: var(--z-index-tutorial-panel);
  contain: layout style paint;
  content-visibility: auto;
}

/* Use dynamic viewport height on modern browsers */
@supports (max-height: 100dvh) {
  .tutorial-panel {
    max-height: calc(100dvh - 32px);
  }
}

.tutorial-panel:focus {
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.3),
    0 0 0 3px var(--color-focus);
}

.tutorial-panel.tutorial-panel-positioned {
  /* Positioned panels get a subtle entrance */
  animation: tutorialPanelSlide var(--motion-slow) ease-out;
}

/* Arrow pointing to target element */
.tutorial-arrow {
  position: absolute;
  width: 16px;
  height: 16px;
  background: var(--color-bg-primary);
  border: 2px solid var(--color-accent);
  transform: rotate(45deg);
  display: none;
}

.tutorial-arrow-top {
  top: -9px;
  border-right: none;
  border-bottom: none;
}

.tutorial-arrow-bottom {
  bottom: -9px;
  border-left: none;
  border-top: none;
}

.tutorial-arrow-left {
  left: -9px;
  border-right: none;
  border-top: none;
}

.tutorial-arrow-right {
  right: -9px;
  border-left: none;
  border-bottom: none;
}

/* Header with title and action buttons */
.tutorial-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-md) var(--space-md) var(--space-sm);
  gap: var(--space-sm);
}

.tutorial-title {
  font-size: var(--font-size-sm);
  font-weight: 500;
  color: var(--color-text-secondary);
  margin: 0;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.tutorial-header-actions {
  display: flex;
  gap: var(--space-xs);
}

.tutorial-minimize,
.tutorial-close {
  background: transparent;
  border: none;
  color: var(--color-text-secondary);
  cursor: pointer;
  padding: var(--space-xs);
  border-radius: var(--border-radius-sm);
  transition:
    background-color var(--motion-base),
    color var(--motion-base);
  min-width: 32px;
  min-height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.tutorial-minimize:hover,
.tutorial-minimize:focus,
.tutorial-close:hover,
.tutorial-close:focus {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  outline: 2px solid var(--color-focus);
  outline-offset: 1px;
}

/* Body content area */
.tutorial-body {
  flex: 1;
  overflow-y: auto;
  padding: 0 var(--space-md) var(--space-md);
}

.tutorial-content {
  color: var(--color-text-primary);
}

.tutorial-step-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

.tutorial-step-content {
  font-size: var(--font-size-sm);
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.tutorial-step-content p {
  margin: 0 0 var(--space-sm) 0;
}

.tutorial-step-content p:last-child {
  margin-bottom: 0;
}

.tutorial-step-content ul {
  margin: var(--space-xs) 0;
  padding-left: var(--space-md);
}

.tutorial-step-content li {
  margin-bottom: var(--space-xs);
}

.tutorial-step-content strong {
  color: var(--color-text-primary);
  font-weight: 600;
}

.tutorial-step-content kbd {
  display: inline-block;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  padding: var(--space-2xs) var(--space-xs);
  font-family: inherit;
  font-size: 0.85em;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Hint text styling */
.tutorial-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  opacity: 0.8;
  margin-top: var(--space-xs) !important;
}

/* Expandable "more" section for compact content */
.tutorial-more {
  margin-top: var(--space-xs);
  font-size: var(--font-size-xs);
}

.tutorial-more summary {
  cursor: pointer;
  color: var(--color-text-primary);
  font-weight: 500;
  padding: var(--space-2xs) 0;
  list-style: none;
  display: flex;
  align-items: center;
  gap: var(--space-2xs);
}

.tutorial-more summary::-webkit-details-marker {
  display: none;
}

.tutorial-more summary::before {
  content: '▸';
  transition: transform var(--motion-fast) ease;
}

.tutorial-more[open] summary::before {
  transform: rotate(90deg);
}

.tutorial-more ul {
  margin: var(--space-xs) 0 0 var(--space-sm);
  padding-left: var(--space-sm);
}

.tutorial-more li {
  margin-bottom: var(--space-2xs);
}

/* Small-height viewport adjustments for tutorial panel */
@media (max-height: 640px) {
  .tutorial-panel {
    max-height: calc(100vh - 16px);
    max-height: calc(100dvh - 16px);
  }

  .tutorial-header {
    padding: var(--space-sm) var(--space-sm) var(--space-xs);
  }

  .tutorial-body {
    padding: 0 var(--space-sm) var(--space-sm);
  }

  .tutorial-step-title {
    font-size: var(--font-size-base);
    margin-bottom: var(--space-xs);
  }

  .tutorial-step-content {
    font-size: var(--font-size-xs);
    line-height: 1.5;
  }

  .tutorial-step-content ul {
    margin: var(--space-2xs) 0;
    padding-left: var(--space-sm);
  }

  .tutorial-step-content li {
    margin-bottom: var(--space-2xs);
  }

  .tutorial-footer {
    padding: var(--space-xs) var(--space-sm);
  }

  .tutorial-keyboard-hint {
    display: none; /* Hide keyboard hints on very small viewports */
  }
}

/* Even smaller viewport - mobile portrait with zoom */
@media (max-height: 520px) {
  .tutorial-panel {
    max-height: calc(100vh - 8px);
    max-height: calc(100dvh - 8px);
    width: min(95vw, 300px);
  }

  .tutorial-header {
    padding: var(--space-xs);
  }

  .tutorial-title {
    font-size: var(--font-size-xs);
  }

  .tutorial-minimize,
  .tutorial-close {
    min-width: 28px;
    min-height: 28px;
    padding: var(--space-2xs);
  }

  .tutorial-body {
    padding: 0 var(--space-xs) var(--space-xs);
    max-height: 50vh;
    overflow-y: auto;
  }

  .tutorial-step-title {
    font-size: var(--font-size-sm);
  }

  .tutorial-nav .btn {
    padding: var(--space-2xs) var(--space-sm);
    font-size: var(--font-size-xs);
  }
}

/* Completion requirement indicator */
.tutorial-requirement {
  margin-top: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--border-radius-sm);
  background: var(--color-warning-bg, rgba(255, 193, 7, 0.1));
  border-left: 3px solid var(--color-warning);
  color: var(--color-text-secondary);
  font-size: var(--font-size-xs);
  transition: all var(--motion-base) ease;
}

.tutorial-requirement:empty {
  display: none;
}

.tutorial-requirement-done {
  background: var(--color-success-bg, rgba(40, 167, 69, 0.1));
  border-left-color: var(--color-success);
  color: var(--color-success);
}

.tutorial-requirement-pulse {
  animation: requirementPulse 0.5s ease;
}

/* Drawer reopen prompt styling */
.tutorial-requirement-action {
  background: var(--color-info-bg, rgba(23, 162, 184, 0.1));
  border-left-color: var(--color-info, #17a2b8);
}

.tutorial-drawer-prompt {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: var(--space-2xs);
}

.tutorial-reopen-drawer-btn {
  display: inline-flex;
  align-items: center;
  padding: var(--space-2xs) var(--space-xs);
  font-size: var(--font-size-xs);
  font-weight: 600;
  background: var(--color-primary);
  color: var(--color-text-on-primary, white);
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: background-color var(--motion-fast) ease;
}

.tutorial-reopen-drawer-btn:hover,
.tutorial-reopen-drawer-btn:focus {
  background: var(--color-primary-hover);
  outline: none;
}

.tutorial-reopen-drawer-btn:focus-visible {
  box-shadow: 0 0 0 2px var(--color-focus-ring);
}

/* Footer with navigation */
.tutorial-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  border-top: 1px solid var(--color-border);
  gap: var(--space-md);
}

.tutorial-progress {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-weight: 500;
}

.tutorial-nav {
  display: flex;
  gap: var(--space-sm);
}

/* Tutorial navigation buttons - MUST override reset.css button { background: none; }
   This is critical for accessibility - without explicit colors, Back button is invisible in dark theme */
.tutorial-btn-back,
.tutorial-btn-next {
  min-height: 36px;
  padding: var(--space-xs) var(--space-md);
  font-size: var(--font-size-sm);
  border-radius: var(--border-radius-sm);
  font-weight: 500;
  transition:
    background-color var(--motion-fast),
    border-color var(--motion-fast);
}

/* Back button - secondary style with explicit colors */
.tutorial-btn-back {
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-text-primary);
}

.tutorial-btn-back:hover:not(:disabled) {
  background: var(--color-hover-bg);
  border-color: var(--color-border-hover);
}

.tutorial-btn-back:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

/* Next button - primary style with explicit colors */
.tutorial-btn-next {
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: 1px solid var(--color-accent);
}

.tutorial-btn-next:hover:not(:disabled) {
  background: var(--color-accent-hover);
  border-color: var(--color-accent-hover);
}

.tutorial-btn-next:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.tutorial-btn-back:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.tutorial-btn-next:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Keyboard shortcuts hint */
.tutorial-keyboard-hint {
  margin-top: var(--space-sm);
  padding-top: var(--space-sm);
  border-top: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  text-align: center;
}

.tutorial-keyboard-hint kbd {
  display: inline-block;
  padding: 0.125rem 0.375rem;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-xs);
  background: var(--color-bg-secondary);
  font-family: var(--font-family-mono);
  font-size: 0.9em;
  line-height: 1;
}

@media (forced-colors: active) {
  .tutorial-keyboard-hint kbd {
    border: 1px solid ButtonText;
  }
}

/* During repositioning, temporarily remove containment for accurate measurements */
.tutorial-panel.measuring {
  contain: none;
  content-visibility: visible;
}

/* Minimized state - floating pill button */
.tutorial-minimized {
  position: fixed;
  bottom: var(--space-lg);
  right: var(--space-lg);
  z-index: var(--z-index-tutorial-minimized);
  pointer-events: auto;
}

.tutorial-restore {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  background: var(--color-accent);
  color: var(--color-accent-text);
  border: none;
  border-radius: var(--border-radius-pill);
  padding: var(--space-sm) var(--space-md);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  transition:
    transform var(--motion-base),
    box-shadow var(--motion-base);
  min-height: 44px;
}

.tutorial-restore:hover,
.tutorial-restore:focus {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.tutorial-minimized-text {
  font-weight: 600;
}

.tutorial-minimized-progress {
  background: rgba(255, 255, 255, 0.2);
  padding: var(--space-2xs) var(--space-sm);
  border-radius: var(--border-radius-md);
  font-size: var(--font-size-xs);
}

/* Tutorial keyboard shortcuts: icon-only, expandable */
.tutorial-keyboard-help {
  margin-left: auto;
}

.tutorial-keyboard-help > summary {
  list-style: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 44px;
  min-height: 44px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  cursor: pointer;
}

.tutorial-keyboard-help > summary::-webkit-details-marker {
  display: none;
}

.tutorial-keyboard-help[open] > summary {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.tutorial-keyboard-help-content {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-secondary);
  font-size: var(--font-size-xs);
  line-height: 1.4;
  display: grid;
  gap: var(--space-xs);
}

.tutorial-keyboard-help-content kbd {
  display: inline-block;
  padding: 0.125rem 0.375rem;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-xs);
  font-family: var(--font-mono);
  font-size: var(--font-size-xs);
  line-height: 1;
}

/* Scroll-margin for elements that can be tutorial targets */
[data-tutorial-target] {
  scroll-margin-top: calc(var(--space-lg) + env(safe-area-inset-top, 0px));
  scroll-margin-bottom: calc(
    var(--space-lg) + 60px
  ); /* Account for mobile actions bar */
}

/* Smooth scrolling during tutorial for targeted elements */
.tutorial-overlay ~ * [data-tutorial-target] {
  scroll-behavior: smooth;
}

/* Highlight ring on target element */
.tutorial-target-highlight {
  outline: 3px solid var(--color-focus) !important;
  outline-offset: 4px !important;
  position: relative;
  z-index: 10001;
  animation: tutorialTargetPulse 2s ease-in-out infinite;
}

/* Prevent scrolling in panels when tutorial is active and highlighting an element */
.tutorial-scroll-locked {
  overflow: hidden !important;
}

/* Ensure modals can appear above tutorial overlay when spotlighted */
.tutorial-target-highlight.modal {
  z-index: 10002 !important;
}

/* Features Guide Modal base styles */
#featuresGuideModal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-index-modal);
  background: rgba(0, 0, 0, 0.7);
}

/* When Features Guide modal is open during tutorial, bring it above the overlay */
#featuresGuideModal:not(.hidden) {
  z-index: 10003;
}

/* When the Features Guide content is highlighted by tutorial */
#featuresGuideModal .modal-content.tutorial-target-highlight {
  z-index: 10004 !important;
  opacity: 1 !important;
  background: var(--color-bg-primary) !important;
  box-shadow:
    0 12px 48px rgba(0, 0, 0, 0.5),
    0 0 0 4px var(--color-accent),
    0 0 24px rgba(var(--color-accent-rgb, 59, 130, 246), 0.3) !important;
  animation: tutorialModalHighlight 2s ease-in-out infinite !important;
}

/* Override the default outline for modal content - use box-shadow glow instead */
#featuresGuideModal .modal-content.tutorial-target-highlight {
  outline: none !important;
  outline-offset: 0 !important;
}

/* Make the modal overlay semi-transparent when content is spotlighted */
#featuresGuideModal:has(.modal-content.tutorial-target-highlight)
  .modal-overlay {
  background: rgba(0, 0, 0, 0.5);
}

/* Reduce tutorial backdrop when modal content is spotlighted */
body:has(#featuresGuideModal .modal-content.tutorial-target-highlight)
  .tutorial-backdrop {
  fill: rgba(0, 0, 0, 0.4);
}

/* Animation for highlighted modal */
@keyframes tutorialModalHighlight {
  0%,
  100% {
    box-shadow:
      0 12px 48px rgba(0, 0, 0, 0.5),
      0 0 0 4px var(--color-accent),
      0 0 24px rgba(var(--color-accent-rgb, 59, 130, 246), 0.3);
  }
  50% {
    box-shadow:
      0 12px 48px rgba(0, 0, 0, 0.5),
      0 0 0 6px var(--color-accent),
      0 0 32px rgba(var(--color-accent-rgb, 59, 130, 246), 0.5);
  }
}

/* Animations */
@keyframes tutorialTargetPulse {
  0%,
  100% {
    outline-color: var(--color-focus);
    outline-offset: 4px;
  }
  50% {
    outline-color: var(--color-focus);
    outline-offset: 6px;
  }
}

@keyframes tutorialFadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes tutorialPanelIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes tutorialPanelSlide {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes requirementPulse {
  0%,
  100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
    background: var(--color-warning);
    color: var(--color-accent-text);
  }
}

/* High Contrast Mode */
[data-high-contrast='true'] .tutorial-panel {
  border-width: 3px;
  box-shadow:
    0 0 0 2px var(--color-bg-primary),
    0 8px 32px rgba(0, 0, 0, 0.4);
}

[data-high-contrast='true'] .tutorial-arrow {
  border-width: 3px;
}

[data-high-contrast='true'] .tutorial-backdrop {
  fill: rgba(0, 0, 0, 0.8);
}

[data-high-contrast='true'] .tutorial-restore {
  border: 2px solid white;
}

[data-high-contrast='true'] .tutorial-target-highlight {
  outline-width: 4px !important;
}

/* High Contrast Mode - Tutorial buttons */
[data-high-contrast='true'] .tutorial-btn-back {
  background: var(--color-bg-tertiary);
  border-width: 2px;
  border-color: var(--color-text-primary);
}

[data-high-contrast='true'] .tutorial-btn-next {
  border-width: 2px;
}

/* Forced Colors Mode (Windows High Contrast) - Tutorial buttons */
@media (forced-colors: active) {
  .tutorial-btn-back,
  .tutorial-btn-next {
    border: 2px solid ButtonText !important;
    background: ButtonFace !important;
    color: ButtonText !important;
    forced-color-adjust: none;
  }

  .tutorial-btn-next {
    background: Highlight !important;
    color: HighlightText !important;
    border-color: HighlightText !important;
  }

  .tutorial-btn-back:hover:not(:disabled),
  .tutorial-btn-next:hover:not(:disabled) {
    border-color: Highlight !important;
  }

  .tutorial-btn-back:disabled,
  .tutorial-btn-next:disabled {
    opacity: 1 !important;
    background: GrayText !important;
    color: Canvas !important;
    border-color: GrayText !important;
  }

  .tutorial-spotlight-cutout {
    stroke: Highlight;
    stroke-width: 3px;
  }
}

/* Enhanced Contrast Mode (prefers-contrast: more) - Tutorial */
@media (prefers-contrast: more) {
  .tutorial-btn-back,
  .tutorial-btn-next {
    border-width: 2px;
    font-weight: 600;
  }

  .tutorial-btn-back {
    background: var(--color-bg-tertiary);
    border-color: var(--color-text-primary);
  }

  .tutorial-panel {
    border-width: 3px;
  }

  .tutorial-spotlight-cutout {
    stroke: var(--color-focus);
    stroke-width: 3px;
  }

  .tutorial-target-highlight {
    outline-width: 4px !important;
  }
}

/* Reduced Transparency Mode */
@media (prefers-reduced-transparency: reduce) {
  .tutorial-backdrop {
    backdrop-filter: none !important;
    fill: var(--color-overlay-solid, rgba(0, 0, 0, 0.85)) !important;
  }

  .tutorial-panel {
    background: var(--color-bg-primary) !important;
    border-width: 2px;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .tutorial-overlay,
  .tutorial-panel,
  .tutorial-spotlight-cutout,
  .tutorial-requirement,
  .tutorial-target-highlight {
    animation: none !important;
    transition: none !important;
  }

  .tutorial-restore {
    transition: none;
  }

  /* Disable tutorial arrow bounce */
  .tutorial-arrow {
    animation: none !important;
  }
}

/* Mobile: only dock the panel when NOT positioned near a target.
   When a target is highlighted, allow JS positioning so the panel can move
   out of the way instead of covering the control. */
@media (max-width: 600px) {
  .tutorial-panel:not(.tutorial-panel-positioned) {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    top: auto;
    width: 100%;
    max-width: 100%;
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
    transform: none;
    max-height: 50vh;
    max-height: 50dvh; /* Dynamic viewport height */
    /* Safe area padding for notched devices (iPhone X+) */
    padding-bottom: max(var(--space-md), env(safe-area-inset-bottom));
  }

  /* On very small screens, arrows tend to overlap. Hide them. */
  .tutorial-arrow {
    display: none;
  }

  .tutorial-minimized {
    bottom: max(var(--space-md), env(safe-area-inset-bottom));
    right: max(var(--space-md), env(safe-area-inset-right));
  }

  .tutorial-footer {
    flex-direction: row;
    padding: var(--space-md);
  }
}

/* Landscape on notched devices */
@media (orientation: landscape) and (max-height: 500px) {
  .tutorial-panel {
    max-width: calc(
      100vw - env(safe-area-inset-left) - env(safe-area-inset-right) -
        var(--space-lg) * 2
    );
    margin-left: max(var(--space-md), env(safe-area-inset-left));
    margin-right: max(var(--space-md), env(safe-area-inset-right));
  }
}

/* Touch device optimizations */
@media (pointer: coarse) {
  .tutorial-btn-back,
  .tutorial-btn-next {
    min-height: 44px;
    min-width: 44px;
    padding: var(--space-sm) var(--space-md);
  }

  /* Touch feedback */
  .tutorial-btn-back:active,
  .tutorial-btn-next:active {
    transform: scale(0.97);
    transition: transform var(--motion-fast) ease;
  }

  .tutorial-restore {
    min-height: 48px;
    padding: var(--space-sm) var(--space-lg);
  }
}

/* Prevent text selection during touch interactions on tutorial panel (but allow in content) */
.tutorial-panel {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

/* Body scroll locking when tutorial is active */
body.tutorial-body-locked {
  overflow: hidden;
  position: fixed;
  width: 100%;
  /* top is set dynamically via JS to preserve scroll position */
}

/* Paused tutorial visual feedback (when tab is hidden) */
.tutorial-overlay.tutorial-paused {
  opacity: 0.7;
  transition: opacity var(--motion-slow) ease;
}

.tutorial-overlay.tutorial-paused .tutorial-panel {
  pointer-events: none;
}

.tutorial-content,
.tutorial-step-content {
  -webkit-user-select: text;
  user-select: text;
}

/* Tutorial body scrollable for overflow handling */
.tutorial-body {
  overflow-y: auto;
  max-height: 50vh;
  max-height: 50dvh;
}

/* Print styles - hide tutorial completely */
@media print {
  .tutorial-overlay,
  .tutorial-backdrop,
  .tutorial-panel,
  .tutorial-spotlight-svg,
  .tutorial-minimized {
    display: none !important;
  }
}

/* Inverted colors support (iOS/macOS Smart Invert) */
@media (inverted-colors: inverted) {
  .tutorial-backdrop,
  .tutorial-panel {
    filter: invert(0); /* Prevent double-inversion */
  }
}

/* High Contrast Mode: Role Path Cards */
[data-high-contrast='true'] .role-path-card {
  border-width: 3px;
}

[data-high-contrast='true'] .role-path-card:focus-within {
  border-width: 4px;
}

[data-high-contrast='true'] .spotlight-link {
  border-width: 2px;
}

/* Responsive: Stack cards on mobile */
@media (max-width: 767px) {
  .role-paths-grid {
    grid-template-columns: 1fr;
  }

  .spotlights-list {
    grid-template-columns: 1fr;
  }
}

/* Reduced motion: Disable transitions */
@media (prefers-reduced-motion: reduce) {
  .role-path-card {
    transition: none;
  }

  .spotlight-link {
    transition: none;
  }
}

/* ============================================================================
   Forced Colors Mode Adjustments
   ============================================================================
   Component-specific overrides for Windows High Contrast and other
   OS-enforced color schemes to ensure all UI remains usable.
   ============================================================================ */

/* =========================================
   Parameter Search and Navigation (C2)
   ========================================= */

.param-search-section {
  margin-bottom: var(--space-md);
  padding: var(--space-md);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
}

.param-search-row {
  display: flex;
  gap: var(--space-sm);
  flex-wrap: wrap;
}

.param-search-input-wrapper {
  flex: 1;
  min-width: 150px;
  position: relative;
}

.param-search-input {
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  padding-right: calc(var(--space-md) + var(--size-touch-target));
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  min-height: 44px;
  transition:
    border-color var(--motion-base),
    box-shadow var(--motion-base);
}

.param-search-input:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.param-search-input::placeholder {
  color: var(--color-text-muted);
}

.param-search-clear {
  position: absolute;
  right: var(--space-sm);
  top: 50%;
  transform: translateY(-50%);
  width: var(--size-touch-target);
  height: var(--size-touch-target);
  padding: 0;
  border: none;
  background: var(--color-bg-secondary);
  color: var(--color-text-secondary);
  font-size: var(--font-size-lg);
  font-weight: 700;
  cursor: pointer;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--motion-base);
}

.param-search-clear:hover {
  background: var(--color-accent);
  color: var(--color-accent-text);
}

.param-search-clear:focus {
  outline: 2px solid var(--color-focus);
  outline-offset: 2px;
}

.param-jump-wrapper {
  flex: 0 1 180px;
  min-width: 120px;
}

.param-jump-select {
  width: 100%;
  padding: var(--space-sm) var(--space-md);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  min-height: 44px;
  cursor: pointer;
  transition: border-color var(--motion-base);
}

.param-jump-select:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.param-filter-stats {
  margin-top: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.param-filter-stats #paramFilterCount {
  font-weight: 600;
  color: var(--color-text-primary);
}

/* Parameter hidden by search */
.param-control.search-hidden {
  display: none !important;
}

/* Parameter highlight (used for guided error recovery) */
.param-control.param-highlight {
  outline: 3px solid var(--color-accent);
  outline-offset: 4px;
  box-shadow: 0 0 0 6px color-mix(in srgb, var(--color-accent) 20%, transparent);
  border-radius: var(--border-radius-md);
  animation: paramPulse 0.9s ease-in-out 0s 3;
}

@keyframes paramPulse {
  0% {
    transform: translateZ(0);
  }
  50% {
    transform: translateZ(0) scale(1.01);
  }
  100% {
    transform: translateZ(0);
  }
}

.param-group.search-empty {
  display: none !important;
}

/* Default value display */
.param-default-value {
  font-size: var(--font-size-xs);
  color: var(--color-text-primary);
  margin-left: var(--space-xs);
  font-weight: normal;
}

.param-default-value::before {
  content: '(default: ';
}

.param-default-value::after {
  content: ')';
}

/* =========================================
   Workflow Progress Indicator (C3: COGA)
   ========================================= */

.workflow-progress {
  /* Changed from fixed to sticky */
  position: sticky;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  background: var(--color-bg-primary);
  border-bottom: 2px solid var(--color-border);
  padding: var(--space-sm) var(--space-md);
  box-shadow: var(--shadow-sm);
  /* Ensure it's within the app flow, not overlaying */
  width: 100%;
  /* Flexbox layout for steps + actions */
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-md);
}

.workflow-steps {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: 0;
  margin: 0;
  padding: 0;
  list-style: none;
  flex: 1;
  max-width: 500px;
}

/* Workflow action buttons container */
.workflow-actions {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-shrink: 0;
}

.workflow-actions .btn {
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-xs);
  min-height: 32px;
}

.workflow-actions .btn-text {
  display: inline;
}

/* Hide button text on small screens, show only icons */
@media (max-width: 600px) {
  .workflow-actions .btn-text {
    display: none;
  }

  .workflow-actions .btn {
    min-width: 32px;
    padding: var(--space-xs);
  }
}

.workflow-step {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  position: relative;
  flex: 1;
  justify-content: center;
}

.workflow-step-number {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-border);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--motion-slow);
}

.workflow-step-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
  transition: color var(--motion-slow);
}

/* Active step */
.workflow-step[aria-current='step'],
.workflow-step.active {
  .workflow-step-number {
    background: var(--color-accent);
    border-color: var(--color-accent);
    color: var(--color-on-accent);
  }
  .workflow-step-label {
    color: var(--color-text-primary);
    font-weight: 600;
  }
}

/* Completed step */
.workflow-step.completed {
  .workflow-step-number {
    background: var(--color-success);
    border-color: var(--color-success);
    color: var(--color-on-success);
  }
  .workflow-step-number::after {
    content: '✓';
  }
  .workflow-step-label {
    color: var(--color-text-primary);
    font-weight: 600;
  }
}

.workflow-step.completed::after {
  background: var(--color-success);
}

/* =========================================
   Confirm Modal Styles (COGA)
   ========================================= */

.modal-small {
  max-width: 420px;
  width: min(92vw, 420px);
}

.confirm-modal-content {
  text-align: left;
}

.confirm-modal-body {
  padding: var(--space-md) 0;
}

.confirm-modal-body p {
  margin: 0 0 var(--space-sm) 0;
  line-height: 1.6;
  color: var(--color-text-primary);
}

.confirm-modal-body p:last-child {
  margin-bottom: 0;
}

.confirm-warning {
  /* Higher-contrast warning text on neutral surfaces */
  color: var(--color-warning-text) !important;
  font-weight: 500;
}

.confirm-modal-footer {
  display: flex;
  gap: var(--space-sm);
  justify-content: flex-end;
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
}

/* =========================================
   Plain Language Error Display (C3: COGA)
   ========================================= */

.error-message-friendly {
  background: var(--color-bg-secondary);
  border: 2px solid var(--color-error);
  border-radius: var(--border-radius-md);
  padding: var(--space-lg);
  margin: var(--space-md) 0;
}

.error-message-friendly .error-title {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--color-error);
  margin: 0 0 var(--space-sm) 0;
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.error-message-friendly .error-explanation {
  font-size: var(--font-size-base);
  color: var(--color-text-primary);
  margin: 0 0 var(--space-md) 0;
  line-height: 1.6;
}

.error-message-friendly .error-suggestion {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin: 0;
  padding: var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
}

.error-message-friendly .error-suggestion strong {
  color: var(--color-text-primary);
}

.error-message-friendly .error-details-toggle {
  margin-top: var(--space-md);
}

.error-message-friendly .error-details-toggle summary {
  cursor: pointer;
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  user-select: none;
}

.error-message-friendly .error-technical {
  margin-top: var(--space-sm);
  padding: var(--space-sm);
  background: var(--color-bg-tertiary);
  border-radius: var(--border-radius-sm);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  white-space: pre-wrap;
  word-break: break-word;
}

/* High Contrast for new components */
[data-high-contrast='true'] .param-search-input,
[data-high-contrast='true'] .param-jump-select {
  border-width: 3px;
}

[data-high-contrast='true'] .workflow-step-number {
  border-width: 3px;
}

[data-high-contrast='true'] .error-message-friendly {
  border-width: 3px;
}

/* Mobile responsive */
@media (max-width: 767px) {
  .param-search-row {
    flex-direction: column;
  }

  .param-jump-wrapper {
    flex: 1 1 100%;
  }

  .workflow-progress {
    padding: var(--space-xs) var(--space-sm);
    gap: var(--space-sm);
  }

  .workflow-step-label {
    display: none;
  }

  .workflow-step-number {
    width: 32px;
    height: 32px;
    font-size: var(--font-size-base);
  }

  /* Compact workflow action buttons on mobile */
  .workflow-actions {
    gap: var(--space-xs);
  }

  .workflow-actions .btn-text {
    display: none;
  }

  .workflow-actions .btn {
    min-width: 32px;
    padding: var(--space-xs);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .workflow-step-number,
  .workflow-step-label {
    transition: none;
  }
}

@media (forced-colors: active) {
  /* Skip link must be visible */
  .skip-link {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText;
  }

  .skip-link:focus {
    outline: 3px solid Highlight;
    outline-offset: 2px;
    background: Highlight;
    color: HighlightText;
  }

  /* Button states */
  .btn,
  button {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText !important;
  }

  .btn:hover,
  button:hover {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight !important;
  }

  .btn:disabled,
  button:disabled {
    opacity: 1; /* Don't use opacity in forced-colors */
    color: GrayText;
    border-color: GrayText !important;
  }

  /* Drawer toggle buttons */
  .preview-drawer-toggle-btn,
  .actions-drawer-toggle {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText !important;
  }

  .preview-drawer-toggle-btn:hover,
  .preview-drawer-toggle-btn:focus,
  .actions-drawer-toggle:hover,
  .actions-drawer-toggle:focus {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight !important;
  }

  .drawer-toggle-handle {
    background: ButtonText !important;
  }

  .actions-toggle-arrow {
    color: ButtonText;
  }

  .actions-drawer-toggle:hover .actions-toggle-arrow {
    color: HighlightText;
  }

  /* Input fields */
  input,
  select,
  textarea {
    background: Field;
    color: FieldText;
    border: 2px solid ButtonText !important;
  }

  input:focus,
  select:focus,
  textarea:focus {
    outline: 3px solid Highlight;
    outline-offset: 2px;
  }

  /* Links must be distinguishable */
  a,
  .btn-link {
    color: LinkText;
    text-decoration: underline;
  }

  a:visited {
    color: VisitedText;
  }

  /* Focus indicators - use outline instead of box-shadow */
  *:focus,
  *:focus-visible {
    outline: 3px solid Highlight !important;
    outline-offset: 2px !important;
    box-shadow: none !important;
  }

  /* Upload zone */
  .upload-zone {
    border: 3px dashed ButtonText !important;
    background: Canvas;
  }

  .upload-zone:hover,
  .upload-zone:focus {
    border-color: Highlight !important;
    background: Canvas;
  }

  /* Tooltips */
  .param-tooltip {
    background: Canvas;
    color: CanvasText;
    border: 2px solid CanvasText !important;
  }

  .param-help-button {
    background: ButtonFace;
    color: ButtonText;
    border: 2px solid ButtonText !important;
  }

  /* Toggle switch */
  .toggle-switch input[type='checkbox'] {
    background: Field;
    border: 2px solid ButtonText !important;
  }

  .toggle-switch input[type='checkbox']:checked {
    background: Highlight;
    border-color: Highlight !important;
  }

  .toggle-switch input[type='checkbox']::before {
    background: ButtonText;
  }

  .toggle-switch input[type='checkbox']:checked::before {
    background: HighlightText;
  }

  /* Range slider */
  .slider-container input[type='range'] {
    background: Field;
    border: 2px solid ButtonText;
  }

  /* Preview state indicators */
  .preview-state-indicator {
    background: Canvas;
    color: CanvasText;
    border: 2px solid CanvasText !important;
  }

  /* Modal overlays */
  .preset-modal,
  .modal {
    background: rgba(0, 0, 0, 0.8); /* Keep overlay darker */
  }

  .preset-modal-content,
  .modal-content {
    background: Canvas;
    color: CanvasText;
    border: 3px solid CanvasText !important;
  }

  /* Tutorial overlay - spotlight coachmarks */
  .tutorial-backdrop {
    fill: rgba(0, 0, 0, 0.9);
  }

  .tutorial-panel {
    border: 3px solid CanvasText !important;
    background: Canvas;
    color: CanvasText;
  }

  .tutorial-arrow {
    border-color: CanvasText !important;
    background: Canvas;
  }

  .tutorial-restore {
    background: Highlight;
    color: HighlightText;
    border: 2px solid HighlightText;
  }

  .tutorial-requirement {
    border-color: CanvasText;
    background: Canvas;
  }

  .tutorial-target-highlight {
    outline: 4px solid Highlight !important;
    animation: none !important;
  }

  /* Tutorial navigation buttons - critical for visibility in forced-colors */
  .tutorial-btn-back {
    background: ButtonFace !important;
    color: ButtonText !important;
    border: 2px solid ButtonText !important;
  }

  .tutorial-btn-next {
    background: Highlight !important;
    color: HighlightText !important;
    border: 2px solid HighlightText !important;
  }

  .tutorial-btn-back:disabled,
  .tutorial-btn-next:disabled {
    background: GrayText !important;
    color: Canvas !important;
    border-color: GrayText !important;
    opacity: 1 !important;
  }

  .tutorial-header,
  .tutorial-title,
  .tutorial-step-title {
    color: CanvasText;
  }

  .tutorial-content,
  .tutorial-step-content {
    color: CanvasText;
  }

  .tutorial-progress {
    color: CanvasText;
  }

  .tutorial-spotlight-cutout {
    stroke: Highlight;
    stroke-width: 3px;
  }

  /* File tree and code areas */
  .file-tree,
  .source-viewer-textarea,
  .params-json-textarea {
    background: Field;
    color: FieldText;
    border: 2px solid ButtonText !important;
  }

  /* Preset items */
  .preset-item {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  /* Comparison view variant cards */
  .variant-card {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  /* Library items */
  .library-item {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  .library-item:has(input:checked) {
    border-color: Highlight !important;
    background: Canvas;
  }

  /* Queue items */
  .queue-item {
    background: Canvas;
    border: 2px solid CanvasText !important;
  }

  /* Ensure all SVG icons use currentColor */
  svg,
  svg * {
    fill: currentColor !important;
    stroke: currentColor !important;
  }

  /* Color preview - show border in forced-colors */
  .color-preview,
  .color-picker {
    border: 3px solid ButtonText !important;
  }

  /* Status badges and indicators */
  .queue-badge,
  .library-badge,
  .file-tree-badge {
    background: Highlight;
    color: HighlightText;
    border: 2px solid Highlight !important;
  }

  /* Remove background-dependent visual effects */
  .spinner,
  .preview-state-indicator.state-pending,
  .preview-container.preview-rendering {
    animation: none !important;
  }

  /* Ensure progress bars are visible */
  .progress-bar {
    background: Field;
    border: 1px solid ButtonText;
  }

  .progress-fill {
    background: Highlight;
  }

  /* Details/summary elements */
  .param-group,
  .preset-controls,
  .overlay-details,
  .preview-settings-panel,
  .library-details,
  .advanced-menu {
    border: 2px solid CanvasText !important;
  }

  /* Feature cards */
  .feature-card {
    border: 2px solid CanvasText !important;
    background: Canvas;
  }

  /* Role path cards (Welcome screen) */
  .role-path-card {
    border: 2px solid CanvasText !important;
    background: Canvas;
  }

  .role-path-card:focus-within {
    border: 3px solid Highlight !important;
    box-shadow: none;
  }

  .spotlight-link {
    border: 2px solid ButtonText !important;
    background: ButtonFace;
    color: ButtonText;
  }

  .spotlight-link:hover {
    background: Highlight;
    color: HighlightText;
    border-color: Highlight !important;
  }

  /* Features guide tabs */
  .features-tab[aria-selected='true'] {
    border-bottom-color: Highlight !important;
    color: Highlight;
  }

  /* Parameter search */
  .param-search-section {
    border: 2px solid CanvasText !important;
    background: Canvas;
  }

  .param-search-input,
  .param-jump-select {
    border: 2px solid ButtonText !important;
    background: Field;
    color: FieldText;
  }

  .param-search-clear {
    background: ButtonFace;
    color: ButtonText;
    border: 1px solid ButtonText !important;
  }

  /* Workflow progress */
  .workflow-progress {
    background: Canvas;
    border-bottom: 2px solid CanvasText !important;
  }

  .workflow-step-number {
    background: Canvas;
    border: 2px solid CanvasText !important;
    color: CanvasText;
  }

  .workflow-step.active .workflow-step-number {
    background: Highlight;
    border-color: Highlight !important;
    color: HighlightText;
  }

  .workflow-step.completed .workflow-step-number {
    background: ButtonFace;
    border-color: ButtonText !important;
    color: ButtonText;
  }

  /* Confirm modal */
  .confirm-modal-content {
    background: Canvas;
    border: 3px solid CanvasText !important;
  }

  /* Friendly error display */
  .error-message-friendly {
    background: Canvas;
    border: 3px solid CanvasText !important;
  }

  .error-technical {
    background: Field;
    color: FieldText;
    border: 1px solid CanvasText !important;
  }
}

/* Hidden feature animations */
@keyframes _hfm-flash {
  0%,
  100% {
    filter: none;
  }
  50% {
    filter: brightness(1.5) contrast(1.2);
  }
}

.preview-container._hfm-unlock {
  animation: _hfm-flash var(--motion-slow) ease-in-out;
}

/* ========== STORAGE PANEL ========== */
/* Data-conscious UX - shows storage usage and management controls */

.storage-panel {
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-md);
  padding: var(--space-lg);
  margin-top: var(--space-xl);
  border: 1px solid var(--color-border);
  overflow: hidden;
  max-width: 100%;
  box-sizing: border-box;
}

.storage-panel h3 {
  font-size: var(--font-size-xl);
  font-weight: 700;
  color: var(--color-text-primary);
  margin: 0 0 var(--space-sm) 0;
}

[data-high-contrast='true'] .storage-panel {
  border-width: 2px;
}

.storage-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-top: 0;
  margin-bottom: var(--space-sm);
  line-height: 1.4;
}

/* Storage meter (progress bar) */
.storage-meter {
  height: 8px;
  background: var(--color-bg-tertiary);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: var(--space-sm);
  position: relative;
  border: 1px solid var(--color-border);
}

.storage-meter-fill {
  height: 100%;
  background: var(--color-accent);
  transition: width var(--motion-slow) ease;
  border-radius: 4px 0 0 4px;
}

/* Warning colors for high usage */
.storage-meter-fill[data-warning='medium'] {
  background: var(--color-warning, #ff9800);
}

.storage-meter-fill[data-warning='high'] {
  background: var(--color-error, #f44336);
}

/* Storage info text */
.storage-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-sm);
}

.storage-info span {
  font-variant-numeric: tabular-nums;
}

/* Clear storage button */
.storage-panel .btn {
  width: 100%;
  margin-top: var(--space-xs);
}

/* Storage not supported message */
.storage-not-supported {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-style: italic;
}

/* High Contrast Mode */
@media (prefers-contrast: more) {
  .storage-panel {
    border-width: 3px;
  }

  .storage-meter {
    border: 2px solid var(--color-border);
  }
}

/* Forced Colors Mode (Windows High Contrast) */
@media (forced-colors: active) {
  .storage-panel {
    border: 2px solid CanvasText;
  }

  .storage-meter {
    border: 1px solid CanvasText;
    background: Canvas;
  }

  .storage-meter-fill {
    background: Highlight;
  }
}

/* Mobile Responsive */
@media (max-width: 767px) {
  .storage-panel {
    padding: var(--space-sm);
  }

  .storage-info {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-xs);
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .storage-meter-fill {
    transition: none;
  }
}

/* ===================================================
   Keyboard Shortcuts Editor
   =================================================== */

.shortcuts-modal-content {
  max-width: 700px;
}

.shortcuts-modal-body {
  max-height: 60vh;
  overflow-y: auto;
}

.shortcuts-editor-intro {
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  margin-bottom: var(--space-md);
  padding: var(--space-sm);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
}

.shortcuts-editor .shortcuts-category {
  margin-bottom: var(--space-lg);
}

.shortcuts-editor .shortcuts-category h4 {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: var(--space-sm);
  padding-bottom: var(--space-xs);
  border-bottom: 1px solid var(--color-border);
}

.shortcuts-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.shortcut-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-secondary);
  border-radius: var(--border-radius-sm);
  gap: var(--space-md);
}

.shortcut-item.shortcut-customized {
  border-left: 3px solid var(--color-accent);
}

.shortcut-description {
  flex: 1;
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
}

.shortcut-key-group {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.shortcut-key-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 100px;
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-bg-tertiary);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  transition: all var(--motion-fast) ease;
}

.shortcut-key-btn:hover {
  border-color: var(--color-accent);
  background: var(--color-bg-secondary);
}

.shortcut-key-btn:focus {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.shortcut-key-btn kbd {
  font-family: var(--font-mono);
  font-size: var(--font-size-sm);
  color: var(--color-text-primary);
  background: transparent;
  padding: 0;
  border: none;
  box-shadow: none;
}

.shortcut-key-btn.capturing {
  border-color: var(--color-accent);
  background: var(--color-accent-subtle);
  animation: pulse-capture 1s ease-in-out infinite;
}

.shortcut-key-btn.conflict {
  border-color: var(--color-error);
  background: var(--color-error-subtle, rgba(220, 53, 69, 0.1));
}

@keyframes pulse-capture {
  0%,
  100% {
    box-shadow: 0 0 0 0 var(--color-accent-subtle);
  }
  50% {
    box-shadow: 0 0 0 4px var(--color-accent-subtle);
  }
}

.key-capture-prompt {
  font-size: var(--font-size-sm);
  color: var(--color-accent-fg);
  font-style: italic;
}

.key-conflict-warning {
  font-size: var(--font-size-xs);
  color: var(--color-error);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 150px;
}

.shortcut-reset-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  padding: 0;
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all var(--motion-fast) ease;
}

.shortcut-reset-btn:hover {
  color: var(--color-accent-fg);
  border-color: var(--color-accent-fg);
  background: var(--color-accent-subtle);
}

.shortcut-reset-btn:focus {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

.shortcuts-modal-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: var(--space-md);
  border-top: 1px solid var(--color-border);
}

/* Mobile Responsive */
@media (max-width: 600px) {
  .shortcut-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-sm);
  }

  .shortcut-key-group {
    width: 100%;
  }

  .shortcut-key-btn {
    flex: 1;
  }

  .shortcuts-modal-footer {
    flex-direction: column;
    gap: var(--space-sm);
  }

  .shortcuts-modal-footer .btn {
    width: 100%;
  }
}

/* High Contrast Mode */
@media (prefers-contrast: more) {
  .shortcut-key-btn {
    border-width: 3px;
  }

  .shortcut-item.shortcut-customized {
    border-left-width: 4px;
  }
}

/* Forced Colors Mode (Windows High Contrast) */
@media (forced-colors: active) {
  .shortcut-key-btn {
    border: 2px solid ButtonBorder;
  }

  .shortcut-key-btn:hover,
  .shortcut-key-btn:focus {
    border-color: Highlight;
  }

  .shortcut-key-btn.capturing {
    border-color: Highlight;
    background: Highlight;
    color: HighlightText;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .shortcut-key-btn.capturing {
    animation: none;
  }
}

/* ============================================================================
   Expert Mode (M2) - Code Editor Interface
   ============================================================================
   Two-panel layout with code editor and preview. Supports Monaco and textarea
   fallback editor. Accessibility-first design per M2 specification.
   ============================================================================ */

/* Mode toggle button in header — matches .btn .btn-sm sizing contract */
.mode-toggle-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-xs) var(--space-sm);
  min-height: var(--size-touch-target-sm);
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition:
    background-color var(--motion-base),
    border-color var(--motion-base);
}

.mode-toggle-btn:hover {
  background: var(--color-bg-tertiary);
  border-color: var(--color-accent);
}

.mode-toggle-btn:focus {
  outline: 3px solid var(--color-focus);
  outline-offset: 2px;
}

.mode-toggle-btn[aria-pressed='true'] {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: var(--color-accent-text);
}

.mode-toggle-btn .mode-icon {
  font-size: 1.1em;
}

/* Expert Mode panel container */
.expert-mode-panel {
  display: none;
  flex-direction: column;
  height: 100%;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  overflow: hidden;
}

.expert-mode-panel.active {
  display: flex;
}

.expert-mode-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  gap: var(--space-sm);
}

.expert-mode-title {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-primary);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.expert-mode-actions {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
}

.expert-mode-body {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

/* Textarea Editor Styles */
.textarea-editor {
  display: flex;
  flex-direction: column;
  height: 100%;
  font-family: var(--font-mono, 'Consolas', 'Monaco', 'Courier New', monospace);
}

.textarea-editor-wrapper {
  flex: 1;
  display: flex;
  min-height: 0;
  position: relative;
  overflow: hidden;
}

.textarea-line-numbers {
  width: 50px;
  min-width: 50px;
  padding: var(--space-sm) var(--space-xs);
  background: var(--color-bg-secondary);
  border-right: 1px solid var(--color-border);
  color: var(--color-text-secondary);
  font-size: var(--font-size-sm);
  line-height: 1.5;
  text-align: right;
  overflow: hidden;
  user-select: none;
}

.textarea-line-numbers .line-number {
  display: block;
  padding-right: var(--space-xs);
}

.textarea-line-numbers .line-number.error {
  background: var(--color-error-bg, rgba(244, 67, 54, 0.15));
  color: var(--color-error);
  font-weight: 600;
}

.textarea-editor-area {
  flex: 1;
  position: relative;
  overflow: hidden;
}

.textarea-highlight-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  padding: var(--space-sm);
  margin: 0;
  background: transparent;
  color: transparent;
  font-family: inherit;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  white-space: pre;
  word-wrap: break-word;
  overflow: auto;
  pointer-events: none;
}

.textarea-editor-input {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  padding: var(--space-sm);
  margin: 0;
  background: transparent;
  border: none;
  outline: none;
  resize: none;
  font-family: inherit;
  font-size: var(--font-size-sm);
  line-height: 1.5;
  color: var(--color-text-primary);
  caret-color: var(--color-accent);
  overflow: auto;
  white-space: pre;
  word-wrap: break-word;
}

.textarea-editor-input::placeholder {
  color: var(--color-text-muted);
}

.textarea-editor-input:focus {
  background: var(--color-bg-primary);
}

.textarea-editor.focused {
  box-shadow: inset 0 0 0 2px var(--color-focus);
}

.textarea-editor-status {
  display: flex;
  justify-content: space-between;
  padding: var(--space-xs) var(--space-sm);
  background: var(--color-bg-secondary);
  border-top: 1px solid var(--color-border);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

/* Syntax highlighting colors */
.hl-keyword {
  color: var(--color-syntax-keyword, #0000ff);
  font-weight: bold;
}

.hl-builtin {
  color: var(--color-syntax-builtin, #267f99);
}

.hl-function {
  color: var(--color-syntax-function, #795e26);
}

.hl-constant {
  color: var(--color-syntax-constant, #0070c1);
}

.hl-special {
  color: var(--color-syntax-special, #001080);
  font-style: italic;
}

.hl-comment {
  color: var(--color-syntax-comment, #008000);
  font-style: italic;
}

.hl-string {
  color: var(--color-syntax-string, #a31515);
}

.hl-number {
  color: var(--color-syntax-number, #098658);
}

.hl-error-line {
  background: var(--color-error-bg, rgba(244, 67, 54, 0.15));
  display: block;
}

/* Dark theme syntax colors */
[data-theme='dark'] .hl-keyword {
  color: #569cd6;
}

[data-theme='dark'] .hl-builtin {
  color: #4ec9b0;
}

[data-theme='dark'] .hl-function {
  color: #dcdcaa;
}

[data-theme='dark'] .hl-constant {
  color: #4fc1ff;
}

[data-theme='dark'] .hl-special {
  color: #9cdcfe;
}

[data-theme='dark'] .hl-comment {
  color: #6a9955;
}

[data-theme='dark'] .hl-string {
  color: #ce9178;
}

[data-theme='dark'] .hl-number {
  color: #b5cea8;
}

/* Monaco Editor container */
.monaco-editor-container {
  flex: 1;
  min-height: 300px;
  position: relative;
}

/* Expert Mode layout - side by side with preview */
.expert-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-md);
  height: 100%;
  min-height: 0;
}

.expert-layout.editor-only {
  grid-template-columns: 1fr;
}

.expert-editor-pane {
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

.expert-preview-pane {
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
}

/* Editor dirty indicator */
.editor-dirty-indicator {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--color-warning);
  margin-left: var(--space-xs);
  opacity: 0;
  transition: opacity var(--motion-base);
}

.editor-dirty-indicator.visible {
  opacity: 1;
}

/* Editor error badge */
.editor-error-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 18px;
  height: 18px;
  padding: 0 4px;
  font-size: var(--font-size-xs);
  font-weight: 600;
  color: white;
  background: var(--color-error);
  border-radius: var(--border-radius-pill);
}

/* Raw control for expressions */
.raw-parameter {
  border-left: 3px solid var(--color-warning);
}

.raw-value-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
}

.raw-input {
  width: 100%;
  padding: var(--space-sm);
  font-family: var(--font-mono, 'Consolas', 'Monaco', 'Courier New', monospace);
  font-size: var(--font-size-sm);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
}

.raw-input:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.raw-warning {
  font-size: var(--font-size-xs);
  color: var(--color-warning);
  font-style: italic;
}

/* Vector parameter styles */
.vector-parameter {
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  padding: var(--space-md);
  margin: 0;
}

.vector-parameter legend {
  font-weight: 600;
  padding: 0 var(--space-xs);
  color: var(--color-text-primary);
}

.vector-parameter .parameter-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-sm);
}

.vector-inputs {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-md);
}

.vector-component {
  display: flex;
  flex-direction: column;
  gap: var(--space-2xs);
  min-width: 80px;
  flex: 1;
}

.vector-component .component-label {
  font-size: var(--font-size-sm);
  font-weight: 500;
  color: var(--color-text-secondary);
}

.vector-input {
  width: 100%;
  padding: var(--space-xs) var(--space-sm);
  border: 2px solid var(--color-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-size: var(--font-size-base);
  font-variant-numeric: tabular-nums;
}

.vector-input:focus {
  outline: none;
  border-color: var(--color-accent);
  box-shadow: var(--focus-ring);
}

.range-hint {
  font-size: var(--font-size-xs);
  color: var(--color-text-muted);
}

/* High Contrast Mode */
[data-high-contrast='true'] .mode-toggle-btn {
  border-width: 3px;
}

[data-high-contrast='true'] .textarea-editor.focused {
  box-shadow: inset 0 0 0 3px var(--color-focus);
}

[data-high-contrast='true'] .vector-parameter {
  border-width: 2px;
}

[data-high-contrast='true'] .raw-parameter {
  border-left-width: 4px;
}

/* Forced Colors Mode (Windows High Contrast) */
@media (forced-colors: active) {
  .mode-toggle-btn {
    border: 2px solid ButtonText !important;
  }

  .mode-toggle-btn[aria-pressed='true'] {
    background: Highlight !important;
    color: HighlightText !important;
    border-color: Highlight !important;
  }

  .textarea-editor-input {
    background: Field;
    color: FieldText;
  }

  .textarea-line-numbers {
    background: Canvas;
    border-color: CanvasText !important;
  }

  .vector-parameter {
    border: 2px solid CanvasText !important;
  }

  .vector-input,
  .raw-input {
    border: 2px solid ButtonText !important;
    background: Field;
    color: FieldText;
  }
}

/* Mobile Responsive */
@media (max-width: 900px) {
  .expert-layout {
    grid-template-columns: 1fr;
  }

  .expert-preview-pane {
    min-height: 300px;
  }
}

@media (max-width: 600px) {
  .textarea-line-numbers {
    width: 40px;
    min-width: 40px;
    font-size: var(--font-size-xs);
  }

  .vector-inputs {
    flex-direction: column;
  }

  .vector-component {
    min-width: 100%;
  }
}

/* ============================================================
   Publish / Share Project Modal
   ============================================================ */

.publish-manifest-container {
  position: relative;
  margin-bottom: var(--spacing-md, 1rem);
}

.publish-manifest-code {
  background: var(--color-surface-raised, #1e1e2e);
  color: var(--color-text-primary, #cdd6f4);
  border: 1px solid var(--color-border, #45475a);
  border-radius: var(--radius-md, 8px);
  padding: var(--spacing-md, 1rem);
  font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  font-size: var(--font-size-sm, 0.875rem);
  line-height: 1.5;
  overflow-x: auto;
  white-space: pre;
  max-height: 280px;
  overflow-y: auto;
}

.publish-copy-btn {
  position: absolute;
  top: var(--spacing-sm, 0.5rem);
  right: var(--spacing-sm, 0.5rem);
}

.publish-instructions {
  padding-left: 1.5em;
  margin-bottom: var(--spacing-md, 1rem);
  line-height: 1.7;
}

.publish-instructions li {
  margin-bottom: var(--spacing-xs, 0.25rem);
}

.publish-instructions code {
  background: var(--color-surface-raised, #1e1e2e);
  padding: 0.1em 0.4em;
  border-radius: var(--radius-sm, 4px);
  font-size: var(--font-size-sm, 0.875rem);
}

.publish-label {
  display: block;
  font-weight: 600;
  margin-bottom: var(--spacing-xs, 0.25rem);
}

.publish-input {
  width: 100%;
  padding: var(--spacing-sm, 0.5rem);
  border: 1px solid var(--color-border, #45475a);
  border-radius: var(--radius-md, 8px);
  background: var(--color-surface, #181825);
  color: var(--color-text-primary, #cdd6f4);
  font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
  font-size: var(--font-size-sm, 0.875rem);
  box-sizing: border-box;
}

.publish-input:focus {
  outline: 2px solid var(--color-accent, #89b4fa);
  outline-offset: 2px;
}

.publish-help-text {
  font-size: var(--font-size-xs, 0.75rem);
  color: var(--color-text-secondary, #a6adc8);
  margin-top: var(--spacing-xs, 0.25rem);
  margin-bottom: var(--spacing-md, 1rem);
}

.publish-help-text code {
  background: var(--color-surface-raised, #1e1e2e);
  padding: 0.1em 0.3em;
  border-radius: var(--radius-sm, 4px);
  font-size: inherit;
}

.publish-share-link-container {
  margin-top: var(--spacing-md, 1rem);
  padding: var(--spacing-md, 1rem);
  background: var(--color-surface-raised, #1e1e2e);
  border: 1px solid var(--color-border, #45475a);
  border-radius: var(--radius-md, 8px);
}

.publish-share-link-row {
  display: flex;
  gap: var(--spacing-sm, 0.5rem);
  align-items: center;
}

.publish-share-link-row .publish-input {
  flex: 1;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .mode-toggle-btn,
  .editor-dirty-indicator {
    transition: none;
  }
}

/* ============================================================================
   Phase 8: Customizer Panel Header Row
   Mirrors desktop OpenSCAD Customizer header: Automatic Preview | Show Details | Reset
   ============================================================================ */

.customizer-header-row {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  flex-wrap: wrap;
  border-bottom: var(--border-width-thin) solid var(--color-border);
  margin-bottom: var(--space-xs);
}

.customizer-header-control {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  min-height: var(--size-touch-target);
  font-size: var(--font-size-sm);
  cursor: pointer;
  white-space: nowrap;
}

.customizer-header-control input[type='checkbox'] {
  width: var(--space-md);
  height: var(--space-md);
  cursor: pointer;
  accent-color: var(--color-accent);
}

.customizer-header-control:focus-within {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
  border-radius: var(--border-radius-sm);
}

.customizer-header-select {
  min-height: var(--size-touch-target);
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--font-size-sm);
  border: var(--border-width-thin) solid var(--color-input-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  cursor: pointer;
}

.customizer-header-select:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

/* Push Reset button to the right in the header row */
.customizer-header-row > .btn:last-child {
  margin-left: auto;
}

/* ============================================================================
   Phase 9: Preset Panel Search + Combined Actions Row
   ============================================================================ */

.preset-search {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  position: relative;
  margin-bottom: var(--space-xs);
}

.preset-search-input {
  flex: 1;
  min-width: 0;
  padding: var(--space-xs) var(--space-sm);
  padding-right: calc(var(--space-sm) * 2 + var(--size-touch-target-sm, 32px));
  min-height: var(--size-touch-target);
  border: var(--border-width-thin) solid var(--color-input-border);
  border-radius: var(--border-radius-sm);
  background: var(--color-input-bg);
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
}

.preset-search-input:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.preset-search-clear {
  position: absolute;
  right: var(--space-xs);
  top: 50%;
  transform: translateY(-50%);
  min-width: var(--size-touch-target);
  min-height: var(--size-touch-target);
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--color-text-secondary);
  font-size: var(--font-size-md);
  border-radius: var(--border-radius-sm);
}

.preset-search-clear:hover {
  background: var(--color-hover-bg);
  color: var(--color-text-primary);
}

.preset-search-clear:focus-visible {
  outline: var(--focus-ring-width) solid var(--color-focus);
  outline-offset: var(--focus-ring-offset);
}

.preset-actions-row {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-wrap: wrap;
  margin-top: var(--space-xs);
}

.preset-actions-row .preset-actions-group {
  flex-shrink: 0;
}

.preset-actions-row > .btn:last-child {
  margin-left: auto;
}

@media (prefers-reduced-motion: reduce) {
  .preset-search-input,
  .preset-search-clear {
    transition: none;
  }
}
