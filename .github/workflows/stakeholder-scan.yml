name: Stakeholder Reference Scan

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  scan:
    name: Scan for forbidden stakeholder references
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Scan for forbidden terms
        run: |
          echo "Scanning for forbidden stakeholder references..."
          
          # Define forbidden patterns
          PATTERNS="volkswitch|volksswitch|Ken's P[0-9]|Ken @|stakeholder Ken|volksswitch\.org"
          
          # Search across source, tests, docs, public, and config files
          # Exclude:
          #   - .volkswitch directory references (gitignored local testing files)
          #   - CHANGELOG entries documenting historical renames
          RESULTS=$(grep -riE "$PATTERNS" \
            --include="*.js" --include="*.html" --include="*.css" \
            --include="*.md" --include="*.json" --include="*.yml" \
            --include="*.yaml" --include="*.txt" --include="*.scad" \
            src/ tests/ docs/ public/ index.html CHANGELOG.md 2>/dev/null \
            | grep -iv "\.volkswitch" \
            | grep -iv "volkswitch-keyguard.*renamed\|volkswitch-keyguard.*becomes\|volkswitch-workflow.*renamed\|renamed.*volkswitch" \
            || true)
          
          if [ -n "$RESULTS" ]; then
            echo "::error::Forbidden stakeholder references found:"
            echo "$RESULTS"
            echo ""
            echo "Replace with generic, feature-descriptive language."
            exit 1
          fi
          
          echo "âœ“ No forbidden stakeholder references found."
